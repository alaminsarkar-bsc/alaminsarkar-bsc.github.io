
document.addEventListener('DOMContentLoaded', () => {

    // --- IndexedDB অফলাইন ডেটাবেজ হেল্পার ফাংশন START ---
    const dbName = 'IslamicProDB';
    const dbVersion = 1;
    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, dbVersion);

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                if (!db.objectStoreNames.contains('prayerTimes')) {
                    db.createObjectStore('prayerTimes');
                }
                if (!db.objectStoreNames.contains('quran')) {
                    db.createObjectStore('quran');
                }
                if (!db.objectStoreNames.contains('hadith')) {
                    db.createObjectStore('hadith');
                }
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };

            request.onerror = (event) => {
                console.error("IndexedDB error:", event.target.errorCode);
                // Resolve anyway so app doesn't crash, but db will be undefined
                resolve(null);
            };
        });
    }

    function getFromDB(storeName, key) {
        return new Promise((resolve, reject) => {
            if (!db) {
                return resolve(null); // ডেটাবেজ প্রস্তুত না হলে null রিটার্ন করবে
            }
            try {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(key);

                request.onsuccess = () => {
                    resolve(request.result);
                };

                request.onerror = (event) => {
                    console.error(`Error getting data from ${storeName}:`, event.target.error);
                    resolve(null);
                };
            } catch (e) {
                console.warn("DB Transaction Error:", e);
                resolve(null);
            }
        });
    }

    function saveToDB(storeName, key, value) {
        return new Promise((resolve, reject) => {
            if (!db) {
                console.warn("Database not ready, cannot save data.");
                return resolve();
            }
            try {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(value, key);

                request.onsuccess = () => {
                    resolve(request.result);
                };

                request.onerror = (event) => {
                    console.error(`Error saving data to ${storeName}:`, event.target.error);
                    resolve(); // Fail silently
                };
            } catch (e) {
                console.warn("DB Save Error:", e);
                resolve();
            }
        });
    }
    // --- IndexedDB অফলাইন ডেটাবেজ হেল্পার ফাংশন END ---


    const DOMElements = {
        body: document.body, 
        appContainer: document.querySelector('.app-container'),
        tabs: document.querySelectorAll('.tab'), 
        tabPanes: document.querySelectorAll('.tab-pane'),
        currentDate: document.getElementById('current-date'), 
        hijriDate: document.getElementById('hijri-date'),
        nextPrayerNameLabel: document.getElementById('next-prayer-name-label'),
        nextPrayerName: document.getElementById('next-prayer-name'), 
        nextPrayerCountdown: document.getElementById('next-prayer-countdown'),
        prayerTimesList: document.getElementById('prayer-times-list'), 
        prayerArcHolder: document.getElementById('prayer-arc-holder'),
        prayerWidgetPlaceholder: document.getElementById('prayer-widget-placeholder'),
        audioPlayerPlaceholder: document.getElementById('audio-player-placeholder'),
        menuBtn: document.getElementById('menu-btn'),
        menuDropdown: document.getElementById('menu-dropdown'),
        userGuideBtn: document.getElementById('user-guide-btn'),
        userGuideOverlay: document.getElementById('user-guide-overlay'),
    };
    
    let state = {
        currentLang: localStorage.getItem('appLang') || 'bn',
        currentCity: localStorage.getItem('appCity') || 'Dhaka',
        countdownInterval: null,
        arcInterval: null,
        isDarkMode: false,
        fontSizeMultiplier: parseFloat(localStorage.getItem('appFontSize')) || 1,
        favoriteSurahs: JSON.parse(localStorage.getItem('favoriteSurahs')) || [],
        bookmarks: JSON.parse(localStorage.getItem('bookmarks')) || [],
        hadithBookmarks: JSON.parse(localStorage.getItem('hadithBookmarks')) || [],
        quranProgress: JSON.parse(localStorage.getItem('quranProgress')) || [],
        bookmarkingEnabled: JSON.parse(localStorage.getItem('bookmarkingEnabled')) !== false,
        audioEnabled: JSON.parse(localStorage.getItem('audioEnabled')) !== false,
        currentReciter: localStorage.getItem('currentReciter') || 'ar.alafasy',
        currentlyPlayingAudio: null,
        currentlyPlayingBtn: null,
        audioPlayer: {
            audio: null,
            currentSurahNumber: null,
            isPlaying: false,
            latestRequestedSurah: null,
        },
        autoClosePlayer: JSON.parse(localStorage.getItem('autoClosePlayer')) !== false,
// এই অংশটুকু state এর ভেতরে যোগ করুন
    autoScroll: {
        isActive: false,
        speed: 1, 
        interval: null
    }
    };

    // --- START: ব্যাক বাটন নেভিগেশন হ্যান্ডলার ---
    const handlePopstate = (event) => {
        const quranTabContainer = document.getElementById('quran-tab');
        const amalTabContainer = document.getElementById('amal-tab');
        const hadithTabContainer = document.getElementById('hadith-tab');
        const namazShikkhaTabContainer = document.getElementById('namaz-shikkha-tab');

        if (event.state) {
            const { tab, view, data } = event.state;

            // যদি সঠিক ট্যাব সক্রিয় না থাকে, তবে সেটি সক্রিয় করুন
            if (!document.querySelector(`.tab[data-tab="${tab}"]`).classList.contains('active')) {
                switchTab(tab);
            }

            // স্টেট অনুযায়ী সঠিক ভিউ রেন্ডার করুন
            switch (view) {
                // Quran Tab
                case 'surahList':
                    loadSurahList();
                    break;
                case 'surahDetail':
                    loadSurahDetail(data.surahNumber);
                    break;
                 case 'bookmarks':
                    loadBookmarksView();
                    break;
                // Amal Tab
                case 'amalCategories':
                    loadDailyAmalCategories();
                    break;
                case 'amalDetail':
                    loadDailyAmalDetail(data.category);
                    break;
                // Hadith Tab
                case 'hadithBookSelection':
                    initHadithTab(hadithTabContainer);
                    break;
                case 'hadithList':
                    // যেহেতু loadHadithList initHadithTab-এর ভেতরে, তাই initHadithTab আবার কল করতে হবে
                    // এবং এটি book selection দেখাবে, যা সঠিক ব্যাক নেভিগেশন
                    initHadithTab(hadithTabContainer); 
                    break;
                case 'hadithBookmarks':
                    initHadithTab(hadithTabContainer);
                    break;
                // Namaz Shikkha Tab
                case 'genderSelection':
                     initNamazShikkhaTab(namazShikkhaTabContainer);
                     break;
                 case 'namazSteps':
                     initNamazShikkhaTab(namazShikkhaTabContainer);
                     break;

                default:
                    // কোনো নির্দিষ্ট ভিউ না থাকলে ট্যাবের মূল ভিউতে ফিরে যান
                    if(tab === 'quran') loadSurahList();
                    if(tab === 'amal') loadDailyAmalCategories();
                    if(tab === 'hadith') initHadithTab(hadithTabContainer);
                    if(tab === 'namaz-shikkha') initNamazShikkhaTab(namazShikkhaTabContainer);
                    break;
            }
        } else {
             // যদি কোনো স্টেট না থাকে (যেমন অ্যাপের শুরুতে), তাহলে প্রধান ট্যাবে ফিরে যান
             const activeTab = document.querySelector('.tab.active').dataset.tab;
             if(activeTab === 'quran') loadSurahList();
             else if(activeTab === 'amal') loadDailyAmalCategories();
             else if(activeTab === 'hadith') initHadithTab(hadithTabContainer);
             else if(activeTab === 'namaz-shikkha') initNamazShikkhaTab(namazShikkhaTabContainer);
        }
    };
    window.addEventListener('popstate', handlePopstate);
    // --- END: ব্যাক বাটন নেভিগেশন হ্যান্ডলার ---

    const surahData = {
        names: {
            bn: [ "আল-ফাতিহা", "আল-বাকারা", "আলে-ইমরান", "আন-নিসা", "আল-মায়িদাহ", "আল-আন'আম", "আল-আ'রাফ", "আল-আনফাল", "আত-তাওবাহ", "ইউনুস", "হুদ", "ইউসুফ", "আর-রা'দ", "ইব্রাহীম", "আল-হিজর", "আন-নাহল", "বনী-ইসরাঈল", "আল-কাহফ", "মারিয়াম", "ত্বোয়া-হা", "আল-আম্বিয়া", "আল-হজ্জ", "আল-মু'মিনূন", "আন-নূর", "আল-ফুরকান", "আশ-শু'আরা", "আন-নমল", "আল-কাসাস", "আল-আনকাবূত", "আর-রূম", "লুকমান", "আস-সাজদাহ", "আল-আহযاب", "সাবা", "ফাতির", "ইয়াসীন", "আস-সাফফাত", "ছোয়াদ", "আয-যুমার", "আল-মু'মিন", "হা-মীম আস-সাজদাহ", "আশ-শূরা", "আয-যুখরুফ", "আদ-দুখান", "আল-জাসিয়াহ", "আল-আহকাফ", "মুহাম্মদ", "আল-ফাতহ", "আল-হুজুরাত", "ক্বাফ", "আয-যারিয়াত", "আত-তুর", "আন-নাজম", "আল-কামার", "আর-রাহমান", "আল-ওয়াক্বিয়াহ", "আল-হাদীদ", "আল-মুজাদালাহ", "আল-হাশর", "আল-মুমতাহিনাহ", "আস-সাফ", "আল-জুমু'আহ", "আল-মুনাফিকূন", "আত-তাগাবুন", "আত-ত্বালাক", "আত-তাহরীম", "আল-মুলক", "আল-ক্বলম", "আল-হাক্কাহ", "আল-মা'আরিজ", "নূহ", "আল-জ্বিন", "আল-মুযযাম্মিল", "আল-মুদ্দাসসির", "আল-ক্বিয়ামাহ", "আদ-দাহর", "আল-মুরসালাত", "আন-নাবা", "আন-নাযি'আত", "আবাসা", "আত-তাকওয়ীর", "আল-ইনফিতার", "আল-মুতাফফিফীন", "আল-ইনশিকাক", "আল-বুরূজ", "আত-তারিক", "আল-আ'লা", "আল-গাশিয়াহ", "আল-ফাজর", "আল-বালাদ", "আশ-শামস", "আল-লাইল", "আদ-দুহা", "আল-ইনশিরাহ", "আত-তীন", "আল-আলাক", "আল-কদর", "আল-বাইয়্যินাহ", "আয-যিলযাল", "আল-'আদিয়াত", "আল-কারি'আহ", "আত-তাকাসুর", "আল-'আসর", "আল-হুমাযাহ", "আল-ফীল", "কুরাইশ", "আল-মা'ঊন", "আল-কাওসার", "আল-কাফিরূন", "আন-নাসর", "আল-লাহাব", "আল-ইখলাস", "আল-ফালাক", "আন-নাস" ],
            en: [ "Al-Fatihah", "Al-Baqarah", "Aal-E-Imran", "An-Nisa", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Tawbah", "Yunus", "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra", "Al-Kahf", "Maryam", "Taha", "Al-Anbya", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Ash-Shu'ara", "An-Naml", "Al-Qasas", "Al-'Ankabut", "Ar-Rum", "Luqman", "As-Sajdah", "Al-Ahzab", "Saba", "Fatir", "Ya-Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir", "Fussilat", "Ash-Shuraa", "Az-Zukhruf", "Ad-Dukhan", "Al-Jathiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf", "Adh-Dhariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadila", "Al-Hashr", "Al-Mumtahanah", "As-Saf", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij", "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddaththir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba", "An-Nazi'at", "Abasa", "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Inshiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghashiyah", "Al-Fajr", "Al-Balad", "Ash-Shams", "Al-Lail", "Ad-Duhaa", "Ash-Sharh", "At-Tin", "Al-'Alaq", "Al-Qadr", "Al-Bayyinah", "Az-Zalzalah", "Al-'Adiyat", "Al-Qari'ah", "At-Takathur", "Al-'Asr", "Al-Humazah", "Al-Fil", "Quraysh", "Al-Ma'un", "Al-Kawthar", "Al-Kafirun", "An-Nasr", "Al-Masad", "Al-Ikhlas", "Al-Falaq", "An-Nas" ],
            hi: [ "अल-फ़ातिहा", "अल-बक़रा", "आल-ए-इमरान", "अन-निसा", "अल-माइदा", "अल-अनआम", "अल-आराफ़", "अल-अनफ़ाल", "अत-तौबा", "यूनुস", "हूद", "यूसुफ़", "अर-राद", "इब्राहीम", "अल-हिज्र", "अन-नहल", "अल-इस्रा", "अल-कहफ़", "मरयम", "ता-हा", "अल-अंबिया", "अल-हज्ज", "अल-मुमिनून", "अन-नूर", "अल-फ़ुरक़ान", "अश-शुआरा", "अन-नम्ल", "अल-क़सस", "अल-अनकबूत", "अर-रूम", "लुक़मान", "अस-सजदा", "अल-अहज़ाब", "सबा", "फ़ातिर", "या-सीन", "अस-साफ़्फ़ात", "साद", "अज़-ज़ुमर", "ग़ाफिर", "फुस्सिलत", "अश-शूरा", "अज़-ज़ुख़रुफ़", "अद-दुख़ान", "अल-जाथिया", "अल-अहक़ाफ़", "मुहम्मद", "अल-फ़तह", "अल-हुजुरात", "क़ाफ़", "अध-धारियात", "अत-तूर", "अन-नज्म", "अल-क़मर", "अर-रहमान", "अल-वाक़िआ", "अल-हदीद", "अल-मुजादिला", "अल-हश्र", "अल-मुम्तहना", "अस-सफ़", "अल-जुमुआ", "अल-मुनाफ़िक़ून", "अत-तग़ाबुन", "अत-तलाक़", "अत-तहरीम", "अल-मुल्क", "अल-क़लम", "अल-हाक़्क़ा", "अल-मारिज", "नूह", "अल-जिन्न", "अल-मुज़्ज़म्मिल", "अल-मुद्दस्सिर", "अल-क़ियामा", "अल-इंसान", "अल-मुरसलात", "अन-नबा", "अन-नाज़िआत", "अबस", "अत-तकवीर", "अल-इन्फ़ितार", "अल-मुतफ़्फ़िफ़ीन", "अल-इन्शिक़ाक़", "अल-बुरूज", "अत-तारिक़", "अल-आला", "अल-ग़ाशिया", "अल-फ़ज्र", "अल-बलद", "अश-शम्स", "अल-लैल", "अद-दुहा", "अश-शर्ह", "अत-तीन", "अल-अलक़", "अल-क़द्र", "अल-बय्यिना", "अज़-ज़लज़ला", "अल-आदियात", "अल-क़ारिआ", "अत-तकाथुर", "अल-अस्र", "अल-हुमज़ा", "अल-फ़ील", "क़ुरैश", "अल-माऊन", "अल-कौथर", "अल-काफ़िरून", "अन-नस्र", "अल-मसद", "अल-इखलास", "अल-फ़लक़", "अन-नास" ],
            ur: [ "الفاتحہ", "البقرہ", "آل عمران", "النساء", "المائدہ", "الانعام", "الاعراف", "الانفال", "التوبہ", "یونس", "ھود", "یوسف", "الرعد", "ابراہیم", "الحجر", "النحل", "الاسراء", "الکہف", "مریم", "طہٰ", "الانبیاء", "الحج", "المؤمنون", "النور", "الفرقان", "الشعراء", "النمل", "القصص", "العنکبوت", "الروم", "لقمان", "السجدہ", "الاحزاب", "سبا", "فاطر", "یٰس", "الصافات", "ص", "الزمر", "غافر", "فصلت", "الشوریٰ", "الزخرف", "الدخان", "الجاثیہ", "الاحقاف", "محمد", "الفتح", "الحجرات", "ق", "الذاریات", "الطور", "النجم", "القمر", "الرحمٰن", "الواقعہ", "الحدید", "المجادلہ", "الحشر", "الممتحنہ", "الصف", "الجمعہ", "المنافقون", "التغابن", "الطلاق", "التحریم", "الملک", "القلم", "الحاقہ", "المعارج", "نوح", "الجن", "المزمل", "المدثر", "القیامہ", "الانسان", "المرسلات", "النباء", "النازعات", "عبس", "التکویر", "الانفطار", "المطففین", "الانشقاق", "البروج", "الطارق", "الاعلیٰ", "الغاشیہ", "الفجر", "البلد", "الشمس", "اللیل", "الضحیٰ", "الشرح", "التین", "العلق", "القدر", "البینہ", "الزلزلہ", "العادیات", "القارعہ", "التکاثر", "العصر", "الہمزہ", "الفیل", "قریش", "الماعون", "الکوثر", "الکافرون", "النصر", "المسد", "الاخلاص", "الفلق", "الناس" ]
        },
        arabicNames: [ "ٱلْفَاتِحَة", "ٱلْبَقَرَة", "آلِ عِمْرَان", "ٱلنِّسَاء", "ٱلْمَائِدَة", "ٱلْأَنْعَام", "ٱلْأَعْرَاف", "ٱلْأَنْفَال", "ٱلتَّوْبَة", "يُونُس", "هُود", "يُوسُफ़", "ٱلرَّعْد", "إِبْرَاهِيم", "ٱلْحِجْر", "ٱلنَّحْل", "ٱلْإِسْرَاء", "ٱلْكَهْف", "مَرْيَم", "طه", "ٱلْأَنْبِيَاء", "ٱلْحَجّ", "ٱلْمُؤْمِنُون", "ٱلنُّور", "ٱلْفُرْقَان", "ٱلشُّعَرَاء", "ٱلنَّمْل", "ٱلْقَصَص", "ٱلْعَنْكَبُوت", "ٱلرُّوم", "لُقْمَان", "ٱلسَّجْدَة", "ٱلْأَحْزَاب", "سَبَأ", "فَاطِر", "يس", "ٱلصَّافَّات", "ص", "ٱلزُّمَر", "غَافِر", "فُصِّلَت", "ٱلشُّورَىٰ", "ٱلزُّخْرُफ़", "ٱلدُّخَان", "ٱلْجَاثِيَة", "ٱلْأَحْقَاف", "مُحَمَّد", "ٱلْفَتْح", "ٱلْحُجُرَات", "ق", "ٱلذَّارِيَات", "ٱلطُّور", "ٱلنَّجْم", "ٱلْقَمَر", "ٱلرَّحْمَٰن", "ٱلْوَاقِعَة", "ٱلْحَدِيد", "ٱلْْمُجَادِلَة", "ٱلْحَشْر", "ٱلْْمُمْتَحَنَة", "ٱلصَّפّ", "ٱلْجُمُعَة", "ٱلْْمُنَافِقُون", "ٱلتَّغَابُن", "ٱلطَّلَاق", "ٱلتَّحْرِيم", "ٱلْْمُلْك", "ٱلْقَلَم", "ٱلْحَاقَّة", "ٱلْمَعَارِج", "نُوح", "ٱلْجِنّ", "ٱلْmuزَّمِّل", "ٱلْmuدَّثِّر", "ٱلْقِيَامَة", "ٱلْإِنْسَان", "ٱلْْمُرْسَلَات", "ٱلنَّבَأ", "ٱلنَّازِعَات", "عَبَسَ", "ٱلتَّكْوِير", "ٱلْإِنْفِطَار", "ٱلْمُطَفِّفِين", "ٱلْإِنْشِقَاق", "ٱلْْبُرُوج", "ٱلطَّارِق", "ٱلْأَعْلَىٰ", "ٱلْغَاشِيَة", "ٱلْفَجْر", "ٱلْْبَلَد", "ٱلشَّمْس", "ٱللَّيْل", "ٱلضُّحَىٰ", "ٱلشَّרْح", "ٱلتِّين", "ٱلْعَلَق", "ٱلْقَدْر", "ٱلْْبَيِّنَة", "ٱلزَّلْزَلَة", "ٱلْعَادِيَات", "ٱلْقَارِعَة", "ٱلتَّكَاتُر", "ٱلْعَصْر", "ٱلْهُمَزَة", "ٱلْفِيل", "قُرَيْش", "ٱلْمَاعُون", "ٱلْكَوْثَر", "ٱلْكَافِرُون", "ٱلنَّصْر", "ٱلْمَسَد", "ٱلْإِخْلَاص", "ٱلْفَلَق", "ٱلنَّاس" ],
        ayahs: [ 7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135, 112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85, 54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13, 14, 11, 11, 12, 12, 30, 52, 52, 44, 28, 28, 20, 56, 40, 31, 50, 40, 46, 42, 29, 19, 36, 25, 22, 17, 19, 26, 30, 20, 15, 21, 11, 8, 8, 19, 5, 8, 8, 11, 11, 8, 3, 9, 5, 4, 7, 3, 6, 3, 5, 4, 5, 6 ]
    };

    const hadithBookData = [
        { key: 'bukhari', names: { bn: 'সহিহুল বুখারি', en: 'Sahih al-Bukhari', hi: 'सहीह अल-बुखारी', ur: 'صحیح بخاری' }, subtext: 'Sahih al-Bukhari' },
        { key: 'muslim', names: { bn: 'সহিহ মুসলিম', en: 'Sahih Muslim', hi: 'सहीह मुस्लिम', ur: 'صحیح مسلم' }, subtext: 'Sahih Muslim' },
        { key: 'abudawud', names: { bn: 'সুনান আবু দাউদ', en: 'Sunan Abi Dawud', hi: 'सुनन अबू दाऊद', ur: 'سنن ابو داؤد' }, subtext: 'Sunan Abi Dawud' },
        { key: 'tirmidhi', names: { bn: 'সুনান আত-তিরমিজি', en: 'Jami\` at-Tirmidhi', hi: 'जामी अत-तिर्मिज़ी', ur: 'جامع الترمذی' }, subtext: 'Jami\` at-Tirmidhi' },
        { key: 'nasai', names: { bn: 'সুনান আন-নাসায়ী', en: 'Sunan an-Nasa\'i', hi: 'सुनन अन-नसाई', ur: 'سنن نسائی' }, subtext: 'Sunan an-Nasa\'i' },
        { key: 'ibnmajah', names: { bn: 'সুনান ইবনে মাজাহ', en: 'Sunan Ibn Majah', hi: 'सुनन इब्न माजाह', ur: 'سنن ابن ماجہ' }, subtext: 'Sunan Ibn Majah' }
    ];
    
    const dailyAmalData = {
        hadiths: [
            { arab: "إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ، وَإِنَّمَا لِكُلِّ امْرِئٍ مَا نَوَى", bn_pron: "ইন্নামাল আ’মালু বিননিয়্যাত, ওয়া ইন্নামা লিকুল্লিমরি’ইন মা নাওয়া।", bn: "সমস্ত কাজের ফলাফল নিয়তের উপর নির্ভরশীল এবং প্রত্যেক ব্যক্তি তার নিয়ত অনুযায়ী ফল পাবে।", en: "Actions are but by intentions, and every man shall have only that which he intended.", hi: "कर्म केवल इरादों से होते हैं, और हर इंसान को वही मिलेगा जिसका उसने इरादा किया है।", ur: "اعمال کا دارومدار نیتوں پر ہے، اور ہر شخص کے لئے وہی ہے جس کی اس نے نیت کی۔", ref: "সহীহ বুখারী, হাদিস: ১" },
            { arab: "مَنْ قَرَأَ آيَةَ الْكُرْسِيِّ dُبُرَ كُلِّ صَلَاةٍ مَكْتُوبَةٍ لَمْ يَمْنَعْهُ مِنْ دُخُولِ الْجَنَّةِ إِلَّا أَنْ يَمُوتَ", bn_pron: "মান ক্বারা’আ আয়াতাল কুরসিয়্যি দুবুরা কুল্লি সালাতিম মাকতুবাতิน, লাম ইয়ামনা’হু মিন দুখুলিল জান্নাতি ইল্লা আন ইয়ামুত।", bn: "যে ব্যক্তি প্রত্যেক ফরজ নামাজের পর আয়াতুল কুরসি পড়বে, তার জন্য জান্নাতে প্রবেশের পথে মৃত্যু ছাড়া আর কোনো বাধা থাকবে না।", en: "Whoever recites Ayat al-Kursi after every prescribed prayer, nothing will prevent him from entering Paradise except death.", hi: "जो कोई भी हर अनिवार्य नमाज़ के बाद आयतुल कुरसी पढ़ता है, उसे मौत के अलावा कोई चीज़ जन्नत में दाखिल होने से नहीं रोकेगी।", ur: "جو شخص ہر فرض نماز کے بعد آیت الکرسی پڑھے گا، اسے جنت میں داخل ہونے سے موت کے سوا کوئی چیز نہیں روکے گی۔", ref: "সুনানে নাসায়ী আল-কুবরা, ৯৯২৮" },
            { arab: "مَنْ قَالَ سُبْحَانَ اللَّهِ وَبِحَمْدِهِ فِي يَوْمٍ مِائَةَ مَرَّةٍ حُطَّتْ خَطَايَاهُ وَإِنْ كَانَتْ مِثْلَ زَبَدِ الْبَحْرِ", bn_pron: "মান ক্বালা সুবহানাল্লাহি ওয়া বিহামদিহি, ফী ইয়াওমিন মি’আতা মাররাতিন, হুত্বাত খাত্বায়াহু ওয়া ইন কানাত মিসলা যাবদিল বাহার।", bn: "যে ব্যক্তি দিনে একশত বার ‘সুবহানাল্লাহি ওয়া বিহামদিহি’ পাঠ করবে, তার গুনাহসমূহ ক্ষমা করে দেওয়া হবে, যদিও তা সমুদ্রের ফেনার সমতুল্যও হয়।", en: "Whoever says 'Subhanallahi wa bihamdihi' one hundred times a day, his sins will be forgiven, even if they are like the foam of the sea.", hi: "जो व्यक्ति दिन में सौ बार 'सुब्हानल्लाहि व बिहम्दिही' कहता है, उसके पाप क्षमा कर दिए जाएंगे, भले ही वे समुद्र के झाग के बराबर हों।", ur: "جو شخص دن میں سو مرتبہ 'سبحان الله وبحمده' کہے گا، اس کے گناہ معاف کر دیے جائیں گے، چاہے وہ سمندر کی جھاگ کے برابر ہی کیوں نہ ہوں۔", ref: "সহীহ বুখারী, ৬৪০৫" },
            { arab: "الطُّهُورُ شَطْرُ الإِيمَانِ", bn_pron: "আত-তুহুরু শত্রুল ঈমান।", bn: "পবিত্রতা ঈমানের অর্ধেক।", en: "Purity is half of faith.", hi: "पवित्रता आधा ईमान है।", ur: "پاکیزگی نصف ایمان ہے۔", ref: "সহীহ মুসলিম, ২২৩" },
            { arab: "لاَ يُؤْمِنُ أَحَدُكُمْ حَتَّى يُحِبَّ لأَخِيهِ مَا يُحِبُّ لِنَفْسِهِ", bn_pron: "লা ইউ'মিনু আহাদুকুম হাত্তা ইউহিব্বা লিআখিহি মা ইউহিব্বু লিনাফসিহি।", bn: "তোমাদের মধ্যে কেউ ততক্ষণ পর্যন্ত মুমিন হতে পারবে না, যতক্ষণ না সে তার ভাইয়ের জন্য তাই পছন্দ করবে যা সে নিজের জন্য পছন্দ করে।", en: "None of you will believe until you love for your brother what you love for yourself.", hi: "तुम में से कोई भी तब तक ईमानवाला नहीं हो सकता, जब तक कि वह अपने भाई के लिए वही पसंद न करे जो वह अपने लिए पसंद करता है।", ur: "تم میں سے کوئی اس وقت तक مومن نہیں ہو سکتا جب तक کہ وہ اپنے بھائی کے لیے وہی پسند نہ کرے جو وہ اپنے لیے پسند کرتا ہے۔", ref: "সহীহ বুখারী, ১৩" },
            { arab: "مَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا سَهَّلَ اللَّهُ لَهُ بِهِ طَرِيقًا إِلَى الْجَنَّةِ", bn_pron: "মান সালাকা ত্বারিকান ইয়ালতামিসু ফীহি ইলমান সাহ্হালাল্লাহু লাহু বিহী ত্বারিকান ইলাল জান্নাহ।", bn: "যে ব্যক্তি জ্ঞানার্জনের জন্য কোনো পথ অবলম্বন করে, আল্লাহ তার বিনিময়ে তার জন্য জান্নাতের পথ সহজ করে দেন।", en: "Whoever follows a path to seek knowledge therein, Allah will make easy for him a path to Paradise.", hi: "जो व्यक्ति ज्ञान प्राप्त करने के लिए कोई रास्ता अपनाता है, अल्लाह उसके लिए जन्नत का रास्ता आसान कर देता है।", ur: "جو شخص علم حاصل کرنے کے لیے کوئی راستہ اختیار کرتا ہے، اللہ اس کے لیے جنت کا راستہ آسان کر دیتا ہے۔", ref: "সহীহ মুসলিম, ২৬৯৯" },
            { arab: "الْحَيَاءُ مِنَ الإِيمَانِ", bn_pron: "আল-হায়া'উ মিনাল ঈমান।", bn: "লজ্জা ঈমানের অঙ্গ।", en: "Modesty is part of faith.", hi: "हया (शर्म) ईमान का हिस्सा है।", ur: "حیا ایمان کا حصہ ہے۔", ref: "সহীহ বুখারী, ২৪" },
            { arab: "خَيْرُكُمْ مَنْ تَعَلَّمَ الْقُرْآنَ وَعَلَّمَهُ", bn_pron: "খাইরুকুম মান তা'আল্লামাল কুরআ-না ওয়া আল্লামাহু।", bn: "তোমাদের মধ্যে সর্বোত্তম সে ব্যক্তি, যে নিজে কুরআন শিখে ও অন্যকে তা শিক্ষা দেয়।", en: "The best of you are those who learn the Qur'an and teach it.", hi: "तुममें से सबसे अच्छा वह है जो क़ुरान सीखता है और उसे सिखाता है।", ur: "تم میں سے بہترین وہ ہے جو قرآن سیکھے اور اسے سکھائے۔", ref: "সহীহ বুখারী, ৫০২৭" },
            { arab: "تَبَسُّمُكَ فِي وَجْهِ أَخِيكَ لَكَ صَدَقَةٌ", bn_pron: "তাবাস্সুমুকা ফী ওয়াজহি আখীকা লাকা সাদাকাহ।", bn: "তোমার ভাইয়ের চেহারার দিকে তাকিয়ে মুচকি হাসা তোমার জন্য একটি সাদাকাহ।", en: "Your smiling in the face of your brother is a charity.", hi: "अपने भाई के चेहरे पर मुस्कुराना तुम्हारे लिए एक सदक़ा है।", ur: "اپنے بھائی کے چہرے پر مسکرانا تمہارے لیے ایک صدقہ ہے۔", ref: "জামে তিরমিজি, ১৯৫৬" },
            { arab: "مَنْ لَمْ يَرْحَمْ صَغِيرَنَا وَيَعْرِيفْ حَقَّ كَبِيرِنَا فَلَيْسَ مِنَّا", bn_pron: "মান লাম ইয়ারহাম সাগীরানা ওয়া ইয়া'রিফ হাক্কা কাবীরানা ফালাইসা মিন্না।", bn: "যে আমাদের ছোটদের স্নেহ করে না এবং বড়দের অধিকার চেনে না, সে আমাদের দলভুক্ত নয়।", en: "He is not one of us who does not have mercy on our young and does not recognize the right of our elder.", hi: "जो हमारे छोटों पर दया नहीं करता और हमारे बड़ों का हक़ नहीं पहचानता, वह हम में से नहीं है।", ur: "جو ہمارے چھوٹوں پر رحم نہیں کرتا اور ہمارے بڑوں کا حق نہیں پہچانتا، وہ ہم میں سے نہیں ہے۔", ref: "সুনানে আবু দাউদ, ৪৯৪৩" },
            { arab: "لاَ تَحْقِرَنَّ مِنَ الْمَعْرُوفِ شَيْئًا وَلَوْ أَنْ تَلْقَى أَخَاكَ بِوَجْهٍ طَلْقٍ", bn_pron: "লা তাহক্বিরান্না মিনাল মা'রুফি শাই'আন ওয়া লাও আন তালক্বা আখা-কা বিওয়াজহิน ত্বলক্ব।", bn: "কোনো ভালো কাজকেই তুচ্ছ মনে করবে না, এমনকি তা ভাইয়ের সঙ্গে হাসিমুখে সাক্ষাৎ করাও হোক না কেন।", en: "Do not belittle any good deed, even if it is meeting your brother with a cheerful face.", hi: "किसी भी अच्छे काम को छोटा न समझो, चाहे वह अपने भाई से मुस्कुराते हुए मिलना ही क्यों न हो।", ur: "کسی بھی نیکی کو حقیر نہ سمجھو، چاہے وہ اپنے بھائی سے مسکراتے ہوئے چہرے سے ملنا ہی کیوں نہ ہو۔", ref: "সহীহ মুসলিম, ২৬২৬" },
            { arab: "مَنْ كَانَ يُؤْمِنُ بِاللَّهِ وَالْيَوْمِ الآخِرِ فَلْيَقُلْ خَيْرًا أَوْ لِيَصْمُتْ", bn_pron: "মান কানা ইউ'মিনু বিল্লাহি ওয়াল ইয়াওমিল আ-খিরি ফালইয়াকুল খাইরান আও লিয়াসমুত।", bn: "যে ব্যক্তি আল্লাহ ও শেষ দিনের উপর ঈমান রাখে, সে যেন ভালো কথা বলে অথবা চুপ থাকে।", en: "Whoever believes in Allah and the Last Day, let him speak good or remain silent.", hi: "जो अल्लाह और आख़िरत के दिन पर ईमान रखता है, उसे अच्छी बात कहनी चाहिए या चुप रहना चाहिए।", ur: "جو اللہ اور یوم آخرت پر ایمان رکھتا ہے، اسے اچھی بات کہنی چاہیے یا خاموش رہنا چاہیے۔", ref: "সহীহ বুখারী, ৬০১৮" },
            { arab: "الْمُسْلِمُ مَنْ سَلِمَ الْمُسْلِمُونَ مِنْ لِسَانِهِ وَيَدِهِ", bn_pron: "আল মুসলিমু মান সালিমাল মুসলিমুনা মিন লিসানিহি ওয়া ইয়াদিহি।", bn: "প্রকৃত মুসলিম সে-ই, যার জিহ্বা ও হাত থেকে অন্য মুসলিম নিরাপদ থাকে।", en: "A Muslim is the one from whose tongue and hands the Muslims are safe.", hi: "एक मुसलमान वह है जिसकी ज़बान और हाथ से दूसरे मुसलमान सुरक्षित रहें।", ur: "مسلمان وہ ہے جس کی زبان اور ہاتھ سے دوسرے مسلمان محفوظ رہیں۔", ref: "সহীহ বুখারী, ১০" },
            { arab: "إِذَا مَاتَ الإِنْسَانُ انْقَطَعَ عَنْهُ عَمَلُهُ إِلاَّ مِنْ ثَلاَثَةٍ...", bn_pron: "ইযা মা-তাল ইনসা-নু ইনক্বাত্বা'আ 'আনহু 'আমালুহু ইল্লা মিন সালা-সাহ...", bn: "মানুষ যখন মারা যায়, তখন তিনটি জিনিস ছাড়া তার সমস্ত আমল বন্ধ হয়ে যায়: সাদকায়ে জারিয়া, এমন জ্ঞান যা দ্বারা উপকৃত হওয়া যায় এবং এমন নেক সন্তান যে তার জন্য দোয়া করে।", en: "When a man dies, his deeds come to an end except for three things: Sadaqah Jariyah (ceaseless charity); a knowledge which is beneficial, or a virtuous descendant who prays for him.", hi: "जब कोई इंसान मर जाता है, तो उसके कर्म तीन चीजों को छोड़कर समाप्त हो जाते हैं: सदक़ा-ए-जारिया (निरंतर दान); एक ज्ञान जिससे लाभ हो, या एक नेक संतान जो उसके लिए दुआ करे।", ur: "جب انسان مر جاتا ہے تو اس کے اعمال تین چیزوں کے علاوہ ختم ہو جاتے ہیں: صدقہ جاریہ، ایسا علم جس سے فائدہ اٹھایا جائے، اور نیک اولاد جو اس کے لیے دعا کرے۔", ref: "সহীহ মুসলিম, ১৬৩১" },
            { arab: "مَنْ غَشَّنَا فَلَيْسَ مِنَّا", bn_pron: "মান গাশ্শানা ফালাইসা মিন্না।", bn: "যে আমাদের সাথে প্রতারণা করে, সে আমাদের অন্তর্ভুক্ত নয়।", en: "Whoever deceives us is not one of us.", hi: "जो हमें धोखा देता है, वह हम में से नहीं है।", ur: "جو ہمیں دھوکہ دیتا ہے، وہ ہم میں سے نہیں ہے۔", ref: "সহীহ মুসলিম, ১০১" },
            { arab: "كُلُّ مَعْرُوفٍ صَدَقَةٌ", bn_pron: "কুল্লু মা'রুফিন সাদাকাহ।", bn: "প্রতিটি ভালো কাজই একটি সাদাকাহ।", en: "Every good deed is a charity.", hi: "हर अच्छा काम एक सदक़ा है।", ur: "ہر نیکی صدقہ ہے۔", ref: "সহীহ বুখারী, ৬০২১" },
            { arab: "لاَ تَغْضَبْ", bn_pron: "লা তাগদ্বব।", bn: "রাগ করো না।", en: "Do not get angry.", hi: "गुस्सा मत करो।", ur: "غصہ نہ کرو۔", ref: "সহীহ বুখারী, ৬১১৬" },
            { arab: "إِنَّ اللَّهَ يُحِبُّ إِذَا عَمِلَ أَحَدُكُمْ عَمَلاً أَنْ يُتْقِنَهُ", bn_pron: "ইন্নাল্লা-হা ইউহিব্বু ইযা 'আমিলা আহাদুকুম 'আমালান আন ইউতক্বินাহু।", bn: "আল্লাহ এটা পছন্দ করেন যে, তোমাদের কেউ যখন কোনো কাজ করে, তখন সে তা নিখুঁতভাবে করে।", en: "Allah loves that when one of you does a job, he does it with proficiency.", hi: "अल्लाह यह पसंद करता है कि जब तुम में से कोई कोई काम करे, तो उसे निपुणता से करे।", ur: "اللہ یہ پسند کرتا ہے کہ جب تم میں سے کوئی کوئی کام کرے، تو اسے مہارت سے کرے۔", ref: "আল-বায়হাকী, শু'আবুল ঈমান, ৪/৩৩৪" },
            { arab: "أَحَبُّ الْكَلاَمِ إِلَى اللَّهِ أَرْبَعٌ...", bn_pron: "আহাব্বুল কালা-মি ইলাল্লা-হি আরবা'...", bn: "আল্লাহর নিকট সবচেয়ে প্রিয় বাক্য চারটি: সুবহানাল্লাহ, আলহামদুলিল্লাহ, লা ইলাহা ইল্লাল্লাহ, আল্লাহু আকবার।", en: "The most beloved words to Allah are four: Subhanallah (Glory be to Allah), Alhamdulillah (Praise be to Allah), La ilaha illallah (There is no god but Allah), and Allahu Akbar (Allah is the Greatest).", hi: "अल्लाह को सबसे प्रिय चार शब्द हैं: सुभानअल्लाह, अल्हम्दुलिल्लाह, ला इलाहा इल्लल्लाह, और अल्लाहु अकबर।", ur: "اللہ کو سب سے زیادہ پسندیدہ کلمات چار ہیں: سبحان اللہ، الحمدللہ، لا الہ الا اللہ، اور اللہ اکبر۔", ref: "সহীহ মুসলিম, ২১৩৭" },
            { arab: "مَا مِنْ مُسْلِمٍ يَغْرِسُ غَرْسًا أَوْ يَزْرَعُ زَرْعًا فَيَأْكُلُ مِنْهُ طَيْرٌ أَوْ إِنْسَانٌ أَوْ بَهِيمَةٌ إِلاَّ كَانَ لَهُ بِهِ صَدَقَةٌ", bn_pron: "মা মিন মুসলিমিন ইয়াগরিসু গারসান আও ইয়াযরা'উ যার'আন ফা ইয়া'কুলু মিনহু ত্বাইরুন আও ইনসা-নুন আও বাহীমাতুন ইল্লা কা-না লাহু বিহী সাদাকাহ।", bn: "কোনো মুসলিম যদি একটি গাছ লাগায় বা কোনো ফসল ফলায়, আর তা থেকে কোনো পাখি, মানুষ বা চতুষ্পদ জন্তু খায়, তবে তা তার জন্য সাদাকাহ হিসেবে গণ্য হবে।", en: "There is no Muslim who plants a tree or sows seeds, and then a bird, or a person or an animal eats from it, but is regarded as a charitable gift for him.", hi: "कोई भी मुसलमान जो एक पेड़ लगाता है या बीज बोता है, और फिर कोई पक्षी, या कोई व्यक्ति या कोई जानवर उसमें से खाता है, तो यह उसके लिए एक दान माना जाता है।", ur: "کوئی بھی مسلمان جو ایک درخت لگاتا ہے یا بیج بوتا ہے، اور پھر کوئی پرندہ، یا کوئی شخص یا کوئی جانور اس میں سے کھاتا ہے، تو यह उसके لیے ایک صدقہ شمار ہوتا ہے۔", ref: "সহীহ বুখারী, ২৩২০" }
        ],
        duas: [
            { title: { bn: "ঘরে প্রবেশের দোয়া", en: "Dua for entering the house", hi: "घर में प्रवेश करने की दुआ", ur: "گھر میں داخل ہونے کی دعا" }, arab: "بِسْمِ اللهِ وَلَجْنَا، وَبِسْمِ اللهِ خَرَجْنَا، وَعَلَى رَبِّנָא تَوَكَّلْنَا", bn_pron: "বিসমিল্লাহি ওয়ালাজনা, ওয়া বিসমিল্লাহি খারাজনা, ওয়া ‘আলা রাব্বিনা তাওয়াক্কালনা।", bn: "আল্লাহর নামে আমরা প্রবেশ করলাম এবং আল্লাহর নামেই বের হলাম এবং আমাদের প্রতিপালকের ওপরই আমরা ভরসা করলাম।", en: "In the name of Allah we enter, and in the name of Allah we leave, and upon our Lord we rely.", hi: "अल्लाह के नाम से हम दाखिल हुए, और अल्लाह के नाम से हम निकले, और अपने रब पर ही हमने भरोसा किया।", ur: "اللہ کے نام سے ہم داخل ہوئے، اور اللہ کے نام سے ہم نکلے، اور اپنے رب پر ہی ہم نے بھروسہ کیا۔" },
            { title: { bn: "ঘর থেকে বের হওয়ার দোয়া", en: "Dua for leaving the house", hi: "घर से निकलने की दुआ", ur: "گھر سے نکلنے کی دعا" }, arab: "بِسْمِ اللهِ، تَوَكَّلْتُ عَلَى اللهِ، وَلَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللهِ", bn_pron: "বিসমিল্লাহি, তাওয়াক্কালতু আলাল্লাহি, ওয়া লা হাওলা ওয়ালা কুওয়াতা ইল্লা বিল্লাহ।", bn: "আল্লাহর নামে (বের হচ্ছি), আমি আল্লাহর উপর ভরসা করলাম, আল্লাহ ছাড়া কোনো উপায় ও শক্তি নেই।", en: "In the name of Allah, I have placed my trust in Allah, there is no might and no power except with Allah.", hi: "अल्लाह के नाम से, मैंने अल्लाह पर भरोसा किया, अल्लाह के सिवा कोई शक्ति और कोई बल नहीं है।", ur: "اللہ کے نام سے، میں نے اللہ پر بھروسہ کیا، اللہ کے سوا کوئی طاقت اور کوئی قوت نہیں ہے۔" },
            { title: { bn: "ঘুমানোর দোয়া", en: "Dua before sleeping", hi: "सोने से पहले की दुआ", ur: "سونے سے پہلے کی دعا" }, arab: "بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا", bn_pron: "বিস্মিকাল্লা-হুম্মা আমূতু ওয়া আহ্ইয়া।", bn: "হে আল্লাহ! আপনার নামেই আমি মৃত্যুবরণ করি এবং জীবিত হই।", en: "In Your name, O Allah, I die and I live.", hi: "हे अल्लाह! तेरे ही नाम से मैं मरता और जीता हूँ।", ur: "اے اللہ! تیرے ہی نام سے میں مرتا اور جیتا ہوں۔" },
            { title: { bn: "ঘুম থেকে ওঠার দোয়া", en: "Dua after waking up", hi: "जागने के बाद की दुआ", ur: "جاگنے کے بعد کی دعا" }, arab: "اَلْحَمْدُ لِلّٰهِ الَّذِيْ أَحْيَانَا bَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُوْرُ", bn_pron: "আলহামদু লিল্লা-হিল্লাযী আহ্ইয়ানা বা'দা মা আমা-তানা ওয়া ইলাইহิน্ নুশূর।", bn: "সমস্ত প্রশংসা সেই আল্লাহর জন্য যিনি আমাদেরকে মৃত্যুর পর জীবন দান করেছেন এবং তাঁরই দিকে আমাদের পুনরুত্থান।", en: "All praise is for Allah who gave us life after having taken it from us and unto Him is the resurrection.", hi: "सारी प्रशंसा उस अल्लाह के लिए है जिसने हमें मौत के बाद जीवन दिया और उसी की ओर हमें लौटना है।", ur: "تمام تعریفیں اس اللہ کے لیے ہیں جس نے ہمیں मौत کے बाद زندگی دی اور اسی کی طرف ہمیں لوٹنا ہے۔" },
            { title: { bn: "খাবার খাওয়ার আগের দোয়া", en: "Dua before eating", hi: "खाने से पहले की दुआ", ur: "کھانے سے پہلے کی دعا" }, arab: "بِسْمِ اللهِ", bn_pron: "বিসমিল্লাহ।", bn: "আল্লাহর নামে শুরু করছি।", en: "In the name of Allah.", hi: "अल्लाह के नाम से।", ur: "اللہ کے نام سے۔" },
            { title: { bn: "খাবার খাওয়ার পরের দোয়া", en: "Dua after eating", hi: "खाने के बाद की दुआ", ur: "کھانے کے بعد کی دعا" }, arab: "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنِي هَذَا وَرَזَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلَا قُوَّةٍ", bn_pron: "আলহামদু লিল্লা-হিল্লাযী আত্ব'আমানী হা-যা ওয়া রাযাক্বানীহি মিন গাইরি হাওলিম মিন্নী ওয়ালা কুওয়্যাহ।", bn: "সকল প্রশংসা আল্লাহর জন্য, যিনি আমাকে এই খাদ্য খাওয়ালেন এবং রিযিক দান করলেন আমার কোনো চেষ্টা ও শক্তি ছাড়া।", en: "Praise is to Allah Who has fed me this and provided it for me without any might nor power from myself.", hi: "सभी प्रशंसा अल्लाह के लिए है जिसने मुझे यह खिलाया और मुझे बिना किसी प्रयास और शक्ति के यह प्रदान किया।", ur: "تمام تعریفیں اللہ کے لیے ہیں جس نے مجھے यह کھلایا اور مجھے بغیر کسی کوشش اور طاقت کے यह فراہم کیا۔" },
            { title: { bn: "মসজিদে প্রবেশের দোয়া", en: "Dua for entering the mosque", hi: "मस्जिद में प्रवेश करने की दुआ", ur: "مسجد میں داخل ہونے کی دعا" }, arab: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ", bn_pron: "আল্লা-হুম্মাফতাহ লী আবওয়া-বা রাহমাতিক।", bn: "হে আল্লাহ! আমার জন্য আপনার রহমতের দরজাসমূহ খুলে দিন।", en: "O Allah, open for me the gates of Your mercy.", hi: "हे अल्लाह! मेरे लिए अपनी रहमत के दरवाज़े खोल दे।", ur: "اے اللہ! میرے لیے اپنی رحمت کے دروازے کھول دے۔" },
            { title: { bn: "মসজিদ থেকে বের হওয়ার দোয়া", en: "Dua for leaving the mosque", hi: "मस्जिद से निकलने की दुआ", ur: "مسجد سے نکلنے کی دعا" }, arab: "اللَّهُمَّ إِنِّي أَسْأَلُكَ مِنْ فَضْلِكَ", bn_pron: "আল্লা-হুম্মা ইন্নী আস'আলুকা মিন ফাদ্বলিক।", bn: "হে আল্লাহ! আমি আপনার কাছে আপনার অনুগ্রহ প্রার্থনা করছি।", en: "O Allah, I ask You from Your bounty.", hi: "हे अल्लाह! मैं तुझसे तेरे फज़्ल का सवाल करता हूँ।", ur: "اے اللہ! میں تجھ سے تیرے فضل کا سوال کرتا ہوں۔" },
            { title: { bn: "বাথরুমে প্রবেশের দোয়া", en: "Dua for entering the toilet", hi: "शौचालय में प्रवेश करने की दुआ", ur: "بیت الخلا میں داخل ہونے کی دعا" }, arab: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْخُbُثِ وَالْخَبَائِثِ", bn_pron: "আল্লা-হুম্মা ইন্নী আ'উযু বিকা মিনাল খুবুসি ওয়াল খাবা-ইস।", bn: "হে আল্লাহ! আমি আপনার কাছে পুরুষ ও নারী শয়তানের অনিষ্ট থেকে আশ্রয় চাই।", en: "O Allah, I seek refuge in you from the male and female evil spirits.", hi: "हे अल्लाह! मैं तुझसे नर और मादा शैतानों से पनाह मांगता हूँ।", ur: "اے اللہ! میں تجھ سے نر اور مادہ شیطانوں سے پناہ مانگتا ہوں۔" },
            { title: { bn: "বাথরুম থেকে বের হওয়ার দোয়া", en: "Dua for leaving the toilet", hi: "शौचालय से निकलने की दुआ", ur: "بیت الخلا سے نکلنے کی دعا" }, arab: "غُفْرَانَكَ", bn_pron: "গুফরা-নাকা।", bn: "(হে আল্লাহ) আমি আপনার ক্ষমা প্রার্থনা করছি।", en: "I seek Your forgiveness.", hi: "मैं तेरी क्षमा चाहता हूँ।", ur: "میں تیری بخشش چاہتا ہوں۔" },
            { title: { bn: "জ্ঞান বৃদ্ধির দোয়া", en: "Dua for knowledge", hi: "ज्ञान के लिए दुआ", ur: "علم میں اضافے کی دعا" }, arab: "رَبِّ زِدْنِي عِلْمًا", bn_pron: "রব্বি যিদনী ইলমা।", bn: "হে আমার প্রতিপালক! আমার জ্ঞান বৃদ্ধি করে দিন।", en: "My Lord, increase me in knowledge.", hi: "हे मेरे रब! मुझे ज्ञान में वृद्धि दे।", ur: "اے میرے رب! میرے علم میں اضافہ فرما۔" },
            { title: { bn: "পিতা-মাতার জন্য দোয়া", en: "Dua for parents", hi: "माता-पिता के लिए दुआ", ur: "والدین کے لیے دعا" }, arab: "رَبِّ ارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا", bn_pron: "রব্বির হামহুমা কামা রব্বাইয়া-নী সগীরা।", bn: "হে আমার প্রতিপালক! তাদের উভয়ের প্রতি রহম করুন, যেমনভাবে তারা আমাকে শৈশবে লালন-পালন করেছেন।", en: "My Lord, have mercy upon them as they brought me up when I was small.", hi: "हे मेरे रब! उन दोनों पर रहम कर, जैसा कि उन्होंने मुझे बचपन में पाला था।", ur: "اے میرے رب! ان دونوں پر رحم فرما جیسا کہ انہوں نے مجھے بچپن میں پالا تھا۔" },
            { title: { bn: "যানবাহনে আরোহণের দোয়া", en: "Dua for traveling", hi: "यात्रा के लिए दुआ", ur: "سفر کی دعا" }, arab: "سُbْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَى رَبِّنَا لَمُنْقَلِبُونَ", bn_pron: "সুবহা-নাল্লাযী সাখখারা লানা হা-যা ওয়া মা কুন্না লাহূ মুক্বরিনীন, ওয়া ইন্না ইলা রব্বিনা লামুনক্বালিবূন।", bn: "পবিত্র সেই সত্তা, যিনি এটিকে আমাদের বশীভূত করে দিয়েছেন, অথচ আমরা একে বশীভূত করতে সক্ষম ছিলাম না। আর আমরা অবশ্যই আমাদের প্রতিপালকের দিকে প্রত্যাবর্তনকারী।", en: "Glory is to Him Who has subjected this to us, and we were not able to do it. And surely, to our Lord we are to return.", hi: "पवित्र है वह जिसने इसे हमारे अधीन कर दिया, और हम इसे करने में सक्षम नहीं थे। और निश्चय ही, हम अपने रब की ओर लौटने वाले हैं।", ur: "پاک ہے وہ ذات جس نے اسے ہمارے تابع کر دیا، اور ہم اسے کرنے کے قابل نہیں تھے۔ اور یقیناً، ہم اپنے رب کی طرف لوٹنے वाले ہیں۔" },
            { title: { bn: "বিপদ থেকে মুক্তির দোয়া", en: "Dua for protection from calamities", hi: "संकट से सुरक्षा की दुआ", ur: "مصیبت سے حفاظت کی دعا" }, arab: "لَا إِلَهَ إِلَّا أَنْتَ سُbْحَانَكَ إِنِّي كُنْتُ مِنَ الظَّالِمِينَ", bn_pron: "লা ইলা-হা ইল্লা আনতা সুবহা-নাকা ইন্নী কুনতু মিনায্ যোয়া-লিমীন।", bn: "আপনি ছাড়া কোনো উপাস্য নেই, আপনি পবিত্র। নিশ্চয়ই আমি জালিমদের অন্তর্ভুক্ত ছিলাম।", en: "There is no deity except You; exalted are You. Indeed, I have been of the wrongdoers.", hi: "तेरे सिवा कोई माबूद नहीं, तू पाक है। बेशक, मैं ज़ालिमों में से था।", ur: "تیرے سوا کوئی معبود نہیں، تو پاک ہے۔ بے شک، میں ظالموں میں سے تھا۔" },
            { title: { bn: "রোগী দেখার দোয়া", en: "Dua when visiting the sick", hi: "बीमार से मिलने की दुआ", ur: "بیمار کی عیادت کی دعا" }, arab: "لَا بَأْسَ طَهُورٌ إِنْ شَاءَ اللَّهُ", bn_pron: "লা বা'সা, ত্বহুরুন ইনশা-আল্লাহ।", bn: "কোনো ক্ষতি নেই, ইনশাআল্লাহ এটা (রোগ) পবিত্রকারী।", en: "Do not worry, it will be a purification (for you), God willing.", hi: "कोई बात नहीं, यह (बीमारी) पाक करने वाली है, इंशाअल्लाह।", ur: "کوئی حرج نہیں، यह (بیماری) پاک کرنے والی ہے، انشاءاللہ۔" },
            { title: { bn: "বৃষ্টি দেখলে পড়ার দোয়া", en: "Dua upon seeing rain", hi: "बारिश देखने पर दुआ", ur: "بارش دیکھنے پر دعا" }, arab: "اللَّهُمَّ صَيِّbًا نَافِعًا", bn_pron: "আল্লা-হুম্মা সায়্যিবান না-ফি'আ।", bn: "হে আল্লাহ! এ বৃষ্টিকে উপকারী ও কল্যাণকর করে দিন।", en: "O Allah, may it be a beneficial rain.", hi: "हे अल्लाह! इसे एक लाभदायक बारिश बना।", ur: "اے اللہ! اسے ایک فائدہ مند بارش بنا۔" },
            { title: { bn: "ইফতারের দোয়া", en: "Dua for breaking the fast", hi: "रोज़ा खोलने की दुआ", ur: "روزہ کھولنے کی دعا" }, arab: "ذَهَبَ الظَّمَأُ وَابْتَلَّتِ الْعُرُوقُ وَثَبَتَ الأَجْرُ إِنْ شَاءَ اللَّهُ", bn_pron: "যাহাবায্ যমাউ, ওয়াবতাল্লাতিল উরূকু, ওয়া সাবাতাল আজরু ইনশা-আল্লাহ।", bn: "তৃষ্ণা দূর হলো, শিরা-উপশিরা সিক্ত হলো এবং পুরস্কার নির্ধারিত হলো, ইনশাআল্লাহ।", en: "The thirst is gone, the veins are moistened, and the reward is confirmed, if Allah wills.", hi: "प्यास चली गई, नसें तर हो गईं, और इनाम पक्का हो गया, इंशाअल्लाह।", ur: "پیاس چلی گئی، رگیں تر ہو گئیں، اور اجر ثابت ہو گیا، انشاءاللہ۔" },
            { title: { bn: "কাপড় পরিধানের দোয়া", en: "Dua for wearing a garment", hi: "कपड़े पहनने की दुआ", ur: "کپڑے پہننے کی دعا" }, arab: "الْحَمْدُ لِلَّهِ الَّذِي كَسَانِي هَذَا وَرَזَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلَا قُوَّةٍ", bn_pron: "আলহামদু লিল্লা-হিল্লাযী কাসানী হা-যা ওয়া রাযাক্বানীহি মিন গাইরি হাওলিম মিন্নী ওয়ালা কুওয়্যাহ।", bn: "সকল প্রশংসা আল্লাহর জন্য, যিনি আমাকে এই পোশাক পরিধান করিয়েছেন এবং রিযিক দান করেছেন আমার কোনো চেষ্টা ও শক্তি ছাড়া।", en: "Praise is to Allah Who has clothed me with this and provided it for me without any might nor power from myself.", hi: "सभी प्रशंसा अल्लाह के लिए है जिसने मुझे यह पहनाया और मुझे बिना किसी प्रयास और शक्ति के यह प्रदान किया।", ur: "تمام تعریفیں اللہ کے لیے ہیں جس نے مجھے यह پہنایا اور مجھے بغیر کسی کوشش اور طاقت کے यह فراہم کیا۔" },
            { title: { bn: "ক্ষমা প্রার্থনার শ্রেষ্ঠ দোয়া", en: "The master of forgiveness", hi: "क्षमा की सर्वश्रेष्ठ दुआ", ur: "استغفار کی سردار دعا" }, arab: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ خَلَقْتَنِي وَأَنَا عَبْدُكَ وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ وَأَبُوءُ لَكَ بِذَنْbِي فَاغْفِرْ لِي فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ", bn_pron: "আল্লা-হুম্মা আনতা রব্বী, লা ইলা-হা ইল্লা আনতা, খলাক্বতানী ওয়া আনা ‘আবদুকা, ওয়া আনা ‘আলা ‘আহদিকা ওয়া ওয়া‘দিকা মাসতাত্বা‘তু। আ‘ঊযু বিকা মিন শাররি মা সানা‘তু, আবূউ লাকা বিনি‘মাতিকা ‘আলাইয়্যা, ওয়া আবূউ লাকা বিযাম্বী। ফাগফির লী, ফা ইন্নাহূ লা ইয়াগফিরুয যুনূবা ইল্লা আনতা।", bn: "হে আল্লাহ! আপনি আমার প্রতিপালক। আপনি ছাড়া কোনো উপাস্য নেই। আপনি আমাকে সৃষ্টি করেছেন এবং আমি আপনার বান্দা। আমি আপনার প্রতিশ্রুতি ও অঙ্গীকারের উপর যথাসাধ্য প্রতিষ্ঠিত আছি। আমি যা করেছি, তার মন্দ থেকে আপনার আশ্রয় চাই। আমার উপর আপনার যে নিয়ামত আছে, তা আমি স্বীকার করছি এবং আমার অপরাধও স্বীকার করছি। সুতরাং, আপনি আমাকে ক্ষমা করে দিন। কেননা, আপনি ছাড়া আর কেউ অপরাধ ক্ষমা করতে পারে না।", en: "O Allah, You are my Lord, there is none worthy of worship but You. You created me and I am your servant. I abide by Your covenant and promise as much as I can. I seek refuge in You from the evil of what I have done. I acknowledge Your favor upon me and I acknowledge my sin, so forgive me, for verily none can forgive sins except You.", hi: "हे अल्लाह! तू मेरा रब है, तेरे सिवा कोई माबूद नहीं। तूने मुझे पैदा किया और मैं तेरा बंदा हूँ। मैं अपनी क्षमता के अनुसार तेरे वादे और प्रतिज्ञा पर कायम हूँ। मैंने जो कुछ किया है, उसकी बुराई से तेरी पनाह चाहता हूँ। मैं तुझ पर तेरी नेमतों को स्वीकार करता हूँ और अपने गुनाहों को स्वीकार करता हूँ, इसलिए मुझे माफ कर दे, क्योंकि तेरे सिवा कोई गुनाहों को माफ नहीं कर सकता।", ur: "اے اللہ! تو میرا رب ہے، تیرے سوا کوئی معبود نہیں۔ تو نے مجھے پیدا کیا اور میں تیرا بندہ ہوں۔ میں اپنی استطاعت کے مطابق تیرے عہد اور وعدے پر قائم ہوں۔ میں نے جو کچھ کیا ہے، اس کے شر سے تیری پناہ चाहता ہوں۔ میں مجھ پر تیری نعمتوں کا اقرار کرتا ہوں اور اپنے گناہوں کا اقرار کرتا ہوں، پس مجھے معاف فرما دے، کیونکہ تیرے سوا کوئی گناہوں کو معاف نہیں کر सकता۔" },
            { title: { bn: "দুনিয়া ও আখেরাতের কল্যাণের দোয়া", en: "Dua for good in this world and the hereafter", hi: "दुनिया और आख़िरत की भलाई की दुआ", ur: "دنیا اور آخرت کی بھلائی کی دعا" }, arab: "رَبَّנָא آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ", bn_pron: "রব্বানা আ-তিনা ফিদ্ দুনইয়া হাসানাতাও ওয়া ফিল আ-খিরাতি হাসানাতাও ওয়া ক্বিনা ‘আযা-বান্ না-র।", bn: "হে আমাদের প্রতিপালক! আমাদেরকে দুনিয়াতে কল্যাণ দান করুন এবং আখেরাতেও কল্যাণ দান করুন এবং আমাদেরকে জাহান্নামের আগুন থেকে রক্ষা করুন।", en: "Our Lord, give us in this world [that which is] good and in the Hereafter [that which is] good and protect us from the punishment of the Fire.", hi: "ऐ हमारे रब! हमें दुनिया में भलाई दे और आख़िरत में भी भलाई दे और हमें आग के अज़ाब से बचा।", ur: "اے ہمارے رب! ہمیں دنیا میں بھلائی دے اور آخرت میں بھی بھلائی دے اور ہمیں آگ کے عذاب سے بچا۔" }
        ],
        asmaulHusna: [
            { name: "الرحمن", bn_pron: "আর-রহমান", meaning: { bn: "পরম দয়ালু", en: "The All-Compassionate", hi: "अत्यंत दयालु", ur: "بڑا مہربان" } },
            { name: "الرحيم", bn_pron: "আর-রহীম", meaning: { bn: "অতিশয়-মেহেরবান", en: "The All-Merciful", hi: "असीम कृपालु", ur: "نہایت رحم والا" } },
            { name: "الملك", bn_pron: "আল-মালিক", meaning: { bn: "সর্বকর্তৃত্বময়", en: "The Absolute Ruler", hi: "संप्रभु", ur: "بادشاہ" } },
            { name: "القدوس", bn_pron: "আল-কুদ্দুস", meaning: { bn: "অতি পবিত্র", en: "The Pure One", hi: "पवित्रतम", ur: "نہایت مقدس" } },
            { name: "السلام", bn_pron: "আস-সালাম", meaning: { bn: "শান্তিদানকারী", en: "The Source of Peace", hi: "शांति का स्रोत", ur: "سلامتی والا" } },
            { name: "المؤمن", bn_pron: "আল-মু'মিন", meaning: { bn: "নিরাপত্তাদানকারী", en: "The Inspirer of Faith", hi: "विश्वास का प्रेरक", ur: "امن دینے والا" } },
            { name: "المهيمن", bn_pron: "আল-মুহাইমিন", meaning: { bn: "রক্ষণাবেক্ষণকারী", en: "The Guardian", hi: "संरक्षक", ur: "نگہبان" } },
            { name: "العزيز", bn_pron: "আল-আযীয", meaning: { bn: "সর্বশক্তিমান", en: "The Victorious", hi: "सर्वशक्तिमान", ur: "غالب" } },
            { name: "الجبار", bn_pron: "আল-জাব্বার", meaning: { bn: "দুর্নিবার", en: "The Compeller", hi: "प्रबल", ur: "زبردست" } },
            { name: "المتكبر", bn_pron: "আল-মুতাকাব্বির", meaning: { bn: "সর্বশ্রেষ্ঠ", en: "The Greatest", hi: "सर्वोच्च", ur: "بڑائی والا" } },
            { name: "الخالق", bn_pron: "আল-খালিক", meaning: { bn: "সৃষ্টিকর্তা", en: "The Creator", hi: "निर्माता", ur: "پیدا کرنے والا" } },
            { name: "البارئ", bn_pron: "আল-বারী", meaning: { bn: "উদ্ভাবনকারী", en: "The Maker of Order", hi: "विकसित करनेवाला", ur: "بنانے والا" } },
            { name: "المصور", bn_pron: "আল-মুছাওভির", meaning: { bn: "আকৃতিদানকারী", en: "The Shaper of Beauty", hi: "रूप देनेवाला", ur: "صورت بنانے والا" } },
            { name: "الغفار", bn_pron: "আল-গাফফার", meaning: { bn: "পরম ক্ষমাশীল", en: "The Forgiving", hi: "क्षमा करनेवाला", ur: "بہت بخشنے والا" } },
            { name: "القهار", bn_pron: "আল-কাহহার", meaning: { bn: "কঠোর", en: "The Subduer", hi: "वश में करनेवाला", ur: "سب پر غالب" } },
            { name: "الوهاب", bn_pron: "আল-ওয়াহহাব", meaning: { bn: "মহাদাতা", en: "The Giver of All", hi: "सब कुछ देनेवाला", ur: "بہت عطا کرنے والا" } },
            { name: "الرزاق", bn_pron: "আর-রাজ্জাক", meaning: { bn: "রিযিকদাতা", en: "The Sustainer", hi: "पालनकर्ता", ur: "رزق دینے والا" } },
            { name: "الفتاح", bn_pron: "আল-ফাত্তাহ", meaning: { bn: "উন্মোচনকারী", en: "The Opener", hi: "खोलनेवाला", ur: "کھولنے والا" } },
            { name: "العليم", bn_pron: "আল-আলীম", meaning: { bn: "সর্বজ্ঞ", en: "The Knower of All", hi: "सर्वज्ञ", ur: "سب کچھ جاننے والا" } },
            { name: "القابض", bn_pron: "আল-কাবিদ", meaning: { bn: "সংকোচনকারী", en: "The Constrictor", hi: "संकुचित करनेवाला", ur: "تنگ کرنے والا" } },
            { name: "الباسط", bn_pron: "আল-বাসিত", meaning: { bn: "সম্প্রসারণকারী", en: "The Reliever", hi: "विस्तार करनेवाला", ur: "فراخ کرنے والا" } },
            { name: "الخافض", bn_pron: "আল-খাফিদ", meaning: { bn: "অবিশ্বাসীদের অপমানকারী", en: "The Abaser", hi: "अपमानित करनेवाला", ur: "پست करने वाला" } },
            { name: "الرافع", bn_pron: "আর-রাফি", meaning: { bn: "উন্নতকারী", en: "The Exalter", hi: "ऊँचा करनेवाला", ur: "بلند کرنے والا" } },
            { name: "المعز", bn_pron: "আল-মু'ইয", meaning: { bn: "সম্মানদানকারী", en: "The Bestower of Honors", hi: "सम्मान देनेवाला", ur: "عزت دینے والا" } },
            { name: "المذل", bn_pron: "আল-মুযিল", meaning: { bn: "অপমানকারী", en: "The Humiliator", hi: "अपमानित करनेवाला", ur: "ذلت دینے والا" } },
            { name: "السميع", bn_pron: "আস-সামী'", meaning: { bn: "সর্বশ্রোতা", en: "The Hearer of All", hi: "सब कुछ सुननेवाला", ur: "سب کچھ सुनने वाला" } },
            { name: "البصير", bn_pron: "আল-বাছীর", meaning: { bn: "সর্বদ্রষ্টা", en: "The Seer of All", hi: "सब कुछ देखनेवाला", ur: "سب کچھ دیکھنے والا" } },
            { name: "الحكم", bn_pron: "আল-হাকাম", meaning: { bn: "মহান বিচারক", en: "The Judge", hi: "न्यायाधीश", ur: "فیصلہ کرنے والا" } },
            { name: "العدل", bn_pron: "আল-আদল", meaning: { bn: "ন্যায়পরায়ণ", en: "The Just", hi: "न्यायप्रिय", ur: "انصاف کرنے والا" } },
            { name: "اللطيف", bn_pron: "আল-লাতীফ", meaning: { bn: "সূক্ষ্মদর্শী", en: "The Subtle One", hi: "सूक्ष्म", ur: "مہربان" } },
            { name: "الخبير", bn_pron: "আল-খবীর", meaning: { bn: "সর্ববিষয়ে অবগত", en: "The All-Aware", hi: "सर्व-जागरूक", ur: "خبر रखने والا" } },
            { name: "الحليم", bn_pron: "আল-হালীম", meaning: { bn: "অত্যন্ত ধৈর্যশীল", en: "The Forebearing", hi: "सहनशील", ur: "بردبار" } },
            { name: "العظيم", bn_pron: "আল-আযীম", meaning: { bn: "সুমহান", en: "The Magnificent", hi: "महान", ur: "عظمت والا" } },
            { name: "الغفور", bn_pron: "আল-গফুর", meaning: { bn: "পরম ক্ষমাশীল", en: "The Forgiver and Hider of Faults", hi: "क्षमाशील", ur: "بخشنے والا" } },
            { name: "الشكور", bn_pron: "আশ-شکুর", meaning: { bn: "গুণগ্রাহী", en: "The Rewarder of Thankfulness", hi: "कृतज्ञता का प्रतिफल देनेवाला", ur: "قدردان" } },
            { name: "العلي", bn_pron: "আল-আলী", meaning: { bn: "অত্যুচ্চ", en: "The Highest", hi: "सर्वोच्च", ur: "بہت بلند" } },
            { name: "الكبير", bn_pron: "আল- কাবীর", meaning: { bn: "সুমহান", en: "The Greatest", hi: "सबसे बड़ा", ur: "بہت بڑا" } },
            { name: "الحفيظ", bn_pron: "আল-হাফীয", meaning: { bn: "সংরক্ষণকারী", en: "The Preserver", hi: "संरक्षक", ur: "حفاظت کرنے والا" } },
            { name: "المقيت", bn_pron: "আল-মুকীত", meaning: { bn: "আহার্যদাতা", en: "The Nourisher", hi: "पालन-पोषण करनेवाला", ur: "روزی دینے والا" } },
            { name: "الحسيب", bn_pron: "আল-হাসীব", meaning: { bn: "হিসাব গ্রহণকারী", en: "The Accounter", hi: "हिसाब लेनेवाला", ur: "حساب لینے والا" } },
            { name: "الجليل", bn_pron: "আল-জালীল", meaning: { bn: "মহিমান্বিত", en: "The Mighty", hi: "शक्तिशाली", ur: "بزرگی والا" } },
            { name: "الكريم", bn_pron: "আল-কারীম", meaning: { bn: "সুমহান দাতা", en: "The Generous", hi: "उदार", ur: "کرم کرنے والا" } },
            { name: "الرقيب", bn_pron: "আর-রকীব", meaning: { bn: "তত্ত্বাবধায়ক", en: "The Watchful One", hi: "निगरानी रखनेवाला", ur: "نگرانی کرنے والا" } },
            { name: "المجيب", bn_pron: "আল-মুজীব", meaning: { bn: "সাড়া দানকারী", en: "The Responder to Prayer", hi: "प्रार्थना का उत्तर देनेवाला", ur: "دعا قبول کرنے والا" } },
            { name: "الواسع", bn_pron: "আল-ওয়াসি", meaning: { bn: "সর্বব্যাপী", en: "The All-Comprehending", hi: "सर्व-व्यापी", ur: "وسعت والا" } },
            { name: "الحكيم", bn_pron: "আল-হাকীম", meaning: { bn: "পরম প্রজ্ঞাময়", en: "The Perfectly Wise", hi: "पूर्णतः बुद्धिमान", ur: "حکمت والا" } },
            { name: "الودود", bn_pron: "আল-ওয়াদুদ", meaning: { bn: "প্রেমময়", en: "The Loving One", hi: "प्रेम करनेवाला", ur: "محبت करने والا" } },
            { name: "المجيد", bn_pron: "আল-মাজীদ", meaning: { bn: "মহিমান্বিত", en: "The Majestic One", hi: "शानदार", ur: "بزرگی والا" } },
            { name: "الباعث", bn_pron: "আল-বাইস", meaning: { bn: "পুনরুত্থানকারী", en: "The Resurrector", hi: "पुनर्जीवित करनेवाला", ur: "اٹھانے والا" } },
            { name: "الشهيد", bn_pron: "আশ-শাহীদ", meaning: { bn: "সর্বজ্ঞ সাক্ষী", en: "The Witness", hi: "गवाह", ur: "گواہ" } },
            { name: "الحق", bn_pron: "আল-হক", meaning: { bn: "পরম সত্য", en: "The Truth", hi: "सत्य", ur: "حق" } },
            { name: "الوكيل", bn_pron: "আল-ওয়াকীল", meaning: { bn: "পরম নির্ভরযোগ্য", en: "The Trustee", hi: "भरोसेमंद", ur: "کارساز" } },
            { name: "القوي", bn_pron: "আল-ক্বাওয়িয়্যু", meaning: { bn: "পরম শক্তিশালী", en: "The Possessor of All Strength", hi: "सर्वशक्तिमान", ur: "قوت والا" } },
            { name: "المتين", bn_pron: "আল-মাতীন", meaning: { bn: "সুদৃঢ়", en: "The Firm", hi: "दृढ़", ur: "مضبوط" } },
            { name: "الولي", bn_pron: "আল-ওয়ালী", meaning: { bn: "বন্ধু", en: "The Friend", hi: "मित्र", ur: "دوست" } },
            { name: "الحميد", bn_pron: "আল-হামীদ", meaning: { bn: "প্রশংসার্হ", en: "The Praised One", hi: "प्रशंसनीय", ur: "تعریف والا" } },
            { name: "المحصي", bn_pron: "আল-মুহসী", meaning: { bn: "হিসাব সংরক্ষণকারী", en: "The Appraiser", hi: "मूल्यांकन करनेवाला", ur: "شمار करने वाला" } },
            { name: "المبدئ", bn_pron: "আল-মুবদী", meaning: { bn: "প্রথম সৃষ্টিকারী", en: "The Originator", hi: "उत्पन्न करनेवाला", ur: "پہلی بار پیدا کرنے والا" } },
            { name: "المعيد", bn_pron: "আল-মুঈদ", meaning: { bn: "পুনঃসৃষ্টিকারী", en: "The Restorer", hi: "पुनः स्थापित करनेवाला", ur: "دوبارہ پیدا کرنے والا" } },
            { name: "المحيي", bn_pron: "আল-মুহ্যী", meaning: { bn: "জীবনদানকারী", en: "The Giver of Life", hi: "जीवन देनेवाला", ur: "زندگی دینے والا" } },
            { name: "المميت", bn_pron: "আল-মুমীত", meaning: { bn: "মৃত্যুদানকারী", en: "The Taker of Life", hi: "जीवन लेनेवाला", ur: "موت دینے والا" } },
            { name: "الحي", bn_pron: "আল-হাই", meaning: { bn: "চিরঞ্জীব", en: "The Ever Living One", hi: "सदा जीवित रहनेवाला", ur: "زندہ" } },
            { name: "القيوم", bn_pron: "আল-কাইয়ুম", meaning: { bn: "চিরস্থায়ী", en: "The Self-Existing One", hi: "स्व-विद्यमान", ur: "قائم رکھنے والا" } },
            { name: "الواجد", bn_pron: "আল-ওয়াজিদ", meaning: { bn: "একক", en: "The Finder", hi: "अद्वितीय", ur: "پانے والا" } },
            { name: "الماجد", bn_pron: "আল-মাজিদ", meaning: { bn: "মহিমান্বিত", en: "The Glorious", hi: "गौरवशाली", ur: "بزرگی والا" } },
            { name: "الواحد", bn_pron: "আল-ওয়াহিদ", meaning: { bn: "একক", en: "The One, the All Inclusive, The Indivisible", hi: "एक, अद्वितीय", ur: "ایک" } },
            { name: "الأحد", bn_pron: "আল-আহাদ", meaning: { bn: "এক ও অদ্বিতীয়", en: "The Unique, The One", hi: "अद्वितीय, एक", ur: "یکتا" } },
            { name: "الصمد", bn_pron: "আস-সামাদ", meaning: { bn: "অমুখাপেক্ষী", en: "The Satisfier of All Needs", hi: "आत्मनिर्भर", ur: "بے نیاز" } },
            { name: "القادر", bn_pron: "আল-কাদির", meaning: { bn: "সর্বশক্তিমান", en: "The All Powerful", hi: "सर्वशक्तिमान", ur: "قدرت والا" } },
            { name: "المقتدر", bn_pron: "আল-মুকতাদির", meaning: { bn: "প্রভাবশালী", en: "The Creator of All Power", hi: "सर्वशक्तिमान निर्माता", ur: "سب پر قادر" } },
            { name: "المقدم", bn_pron: "আল-মুকাদ্দিম", meaning: { bn: "অগ্রসারক", en: "The Expediter", hi: "आगे बढ़ानेवाला", ur: "آگے کرنے والا" } },
            { name: "المؤخر", bn_pron: "আল-মুআখখির", meaning: { bn: "অবকাশ দানকারী", en: "The Delayer", hi: "विलंब करनेवाला", ur: "پیچھے کرنے والا" } },
            { name: "الأول", bn_pron: "আল-আউয়াল", meaning: { bn: "অনাদি", en: "The First", hi: "प्रथम", ur: "سب سے پہلا" } },
            { name: "الآخر", bn_pron: "আল-आखिर", meaning: { bn: "অনন্ত", en: "The Last", hi: "अंतिम", ur: "سب سے آخری" } },
            { name: "الظاهر", bn_pron: "আয-যাহির", meaning: { bn: "প্রকাশ্য", en: "The Manifest One", hi: "प्रकट", ur: "ظاہر" } },
            { name: "الباطن", bn_pron: "আল-বাতิน", meaning: { bn: "গোপন", en: "The Hidden One", hi: "छिपा हुआ", ur: "پوشیدہ" } },
            { name: "الوالي", bn_pron: "আল-ওয়ালী", meaning: { bn: "কার্যনির্বাহক", en: "The Protecting Friend", hi: "रक्षा करनेवाला मित्र", ur: "مالک" } },
            { name: "المتعالي", bn_pron: "আল-মুতা'আলী", meaning: { bn: "সুমহান", en: "The Supreme One", hi: "सर्वोच्च", ur: "بہت بلند" } },
            { name: "البر", bn_pron: "আল-বার্", meaning: { bn: "কল্যাণময়", en: "The Doer of Good", hi: "अच्छा करनेवाला", ur: "نیکی کرنے والا" } },
            { name: "التواب", bn_pron: "আত-তাওয়াব", meaning: { bn: "তওবা কবুলকারী", en: "The Guide to Repentance", hi: "तौबा स्वीकार करनेवाला", ur: "توبہ قبول करने والا" } },
            { name: "المنتقم", bn_pron: "আল-মুনতাকিম", meaning: { bn: "প্রতিশোধ গ্রহণকারী", en: "The Avenger", hi: "बदला लेनेवाला", ur: "انتقام لینے والا" } },
            { name: "العفو", bn_pron: "আল-আফু", meaning: { bn: "ক্ষমাকারী", en: "The Forgiver", hi: "क्षमा करनेवाला", ur: "معاف کرنے والا" } },
            { name: "الرؤوف", bn_pron: "আর-রউফ", meaning: { bn: "পরম স্নেহশীল", en: "The Clement", hi: "अत्यंत दयालु", ur: "بہت مہربان" } },
            { name: "مالك الملك", bn_pron: "মালিকুল-মুলক", meaning: { bn: "সমগ্র জগতের বাদশাহ", en: "The Owner of All", hi: "सबका मालिक", ur: "بادشاہی کا مالک" } },
            { name: "ذو الجلال والإكرام", bn_pron: "যুল-জালালি ওয়াল-ইকরাম", meaning: { bn: "মহিমান্বিত ও মহানুভব সত্তা", en: "The Lord of Majesty and Bounty", hi: "महिमा और उदारता का स्वामी", ur: "جلال اور اکرام والا" } },
            { name: "المقسط", bn_pron: "আল-মুকসিত", meaning: { bn: "ন্যায়পরায়ণ", en: "The Equitable One", hi: "न्याय करनेवाला", ur: "انصاف کرنے والا" } },
            { name: "الجامع", bn_pron: "আল-জামি", meaning: { bn: "একত্রকারী", en: "The Gatherer", hi: "इकट्ठा करनेवाला", ur: "جمع کرنے والا" } },
            { name: "الغني", bn_pron: "আল-গনী", meaning: { bn: "ঐশ্বর্যবান", en: "The Rich One", hi: "धनवान", ur: "بے پرواہ" } },
            { name: "المغني", bn_pron: "আল-মুগনী", meaning: { bn: "ঐশ্বর্যদানকারী", en: "The Enricher", hi: "समृद्ध करनेवाला", ur: "غنی کرنے والا" } },
            { name: "المانع", bn_pron: "আল-মানি", meaning: { bn: "প্রতিরোধকারী", en: "The Preventer of Harm", hi: "नुकसान रोकनेवाला", ur: "روکنے والا" } },
            { name: "الضار", bn_pron: "আদ-দার", meaning: { bn: "ক্ষতিসাধনকারী", en: "The Creator of The Harmful", hi: "हानिकारक का निर्माता", ur: "نقصان پہنچانے والا" } },
            { name: "النافع", bn_pron: "আন-নাফি", meaning: { bn: "কল্যাণকারী", en: "The Creator of Good", hi: "अच्छा करनेवाला", ur: "نفع دینے والا" } },
            { name: "النور", bn_pron: "আন-নূর", meaning: { bn: "জ্যোতি", en: "The Light", hi: "प्रकाश", ur: "روشنی" } },
            { name: "الهادي", bn_pron: "আল-হাদী", meaning: { bn: "পথ প্রদর্শনকারী", en: "The Guide", hi: "मार्गदर्शक", ur: "ہدایت دینے والا" } },
            { name: "البديع", bn_pron: "আল-বাদী", meaning: { bn: "অতুলনীয়", en: "The Incomparable", hi: "अतुलनीय", ur: "بے مثال" } },
            { name: "الباقي", bn_pron: "আল-বাকী", meaning: { bn: "চিরস্থায়ী", en: "The Everlasting One", hi: "सदा रहनेवाला", ur: "باقی رہنے والا" } },
            { name: "الوارث", bn_pron: "আল-ওয়ারিস", meaning: { bn: "উত্তরাধিকারী", en: "The Inheritor of All", hi: "सबका उत्तराधिकारी", ur: "وارث" } },
            { name: "الرشيد", bn_pron: "আর-রশীদ", meaning: { bn: "সঠিক পথ প্রদর্শনকারী", en: "The Righteous Teacher", hi: "सही मार्गदर्शक", ur: "سیدھی راہ دکھانے والا" } },
            { name: "الصبور", bn_pron: "আস-সবুর", meaning: { bn: "অত্যন্ত ধৈর্যশীল", en: "The Patient One", hi: "धैर्यवान", ur: "صبر کرنے والا" } }
        ]
    };

    const translations = {
        bn: {
            appName: "ইসলামিক প্রো", tabPrayer: "নামাজ", tabQuran: "কুরআন", tabAudioQuran: "অডিও কুরআন", tabAmal: "আমল", tabTasbih: "তাসবিহ", tabNamazShikkha: "নামাজ শিক্ষা", tabHadith: "হাদিস", tabSettings: "সেটিংস", userGuideTitle: "ইউজার গাইড",
            nextPrayerLabel: "পরবর্তী নামাজ", backToSurahList: "সূরার তালিকায় ফিরে যান", dailyAmalTitle: "দৈনিক আমল", selectedHadiths: "নির্বাচিত হাদিস", 
            essentialDuas: "প্রয়োজনীয় দোয়া", asmaulHusna: "আল্লাহর ৯৯টি নাম", hadith: "হাদিস", back: "ফিরে যান", reset: "রিসেট", previous: "পূর্ববর্তী", next: "পরবর্তী", 
            changeCity: "শহর পরিবর্তন করুন", save: "সেভ", language: "ভাষা", appAppearance: "অ্যাপের ধরণ", darkMode: "ডার্ক মোড", textSize: "লেখার আকার", 
            notifications: "নোটিফিকেশন",
            cityUpdated: `শহর "%s"-তে পরিবর্তন করা হয়েছে।`, ayahs: "আয়াত", 
            loadingSurah: "সূরা লোড হচ্ছে...", surahLoadError: `সূরা %s লোড করা সম্ভব হয়নি।`, timeUp: "সময় হয়েছে!", cityNotFound: "শহরটি খুঁজে পাওয়া যায়নি।", 
            apiError: "API থেকে তথ্য আনা সম্ভব হয়নি।", noInternet: "কোনো ইন্টারনেট সংযোগ নেই।", graphError: "গ্রাফ লোড করা সম্ভব হয়নি।", error: "ত্রুটি",
            loadingAudio: "অডিও লোড হচ্ছে...", audioLoadError: "অডিও লোড করা যায়নি",
            hadithCollectionTitle: "হাদিস গ্রন্থ", selectBook: "গ্রন্থ নির্বাচন করুন", loadingHadiths: "হাদিস লোড হচ্ছে...", hadithLoadError: "হাদিস লোড করা সম্ভব হয়নি।", searchHadithPlaceholder: "হাদিস খুঁজুন (নম্বর বা শব্দ)...",
            mensPrayer: "পুরুষের নামাজ", womensPrayer: "নারীর নামাজ",
            quranEdition: 'bn.bengali', viewBookmarks: "বুকমার্ক দেখুন", loadingBookmarks: "বুকমার্ক লোড হচ্ছে...", noBookmarks: "কোনো বুকমার্ক খুঁজে পাওয়া যায়নি।",
            bookmarksTitle: "সংরক্ষিত বুকমার্ক", 
            viewHadithBookmarks: "হাদিস বুকমার্ক দেখুন", loadingHadithBookmarks: "বুকমার্ক লোড হচ্ছে...", noHadithBookmarks: "কোনো হাদিস বুকমার্ক খুঁজে পাওয়া যায়নি।", hadithBookmarksTitle: "সংরক্ষিত হাদিস বুকমার্ক",
            permissions: "পারমিশন", enableBookmarking: "বুকমার্ক চালু করুন",
            audioSettings: "অডিও সেটিংস", enableAudio: "অডিও চালু করুন", reciter: "ক্বারী", autoClosePlayerLabel: "প্লেয়ার অটো ক্লোজ",
            devInfo: "ডেভেলপার তথ্য", devName: "নাম", devEmail: "ইমেইল", devWhatsApp: "হোয়াটসঅ্যাপ", devTitle: "অ্যাপ ডেভেলপার",
            devNameValue: "MD Al Amin Sarkar", devEmailValue: "alaminsarkar.bsc@gmail.com", devWhatsAppValue: "01989170955",
            donationTitle: "সার্ভার রক্ষণাবেক্ষণে সহায়তা করুন", donationDesc: "এই অ্যাপটি সম্পূর্ণ বিনামূল্যে পরিচালনা করতে এবং সার্ভারের খরচ মেটাতে আপনার সামান্য অনুদান আমাদের জন্য অনেক বড় অনুপ্রেরণা। নিচের নম্বরে বা ব্যাংক একাউন্টে অনুদান পাঠাতে পারেন।", 
            bankAccountTitle: "ব্যাংক একাউন্ট", copyBtn: "কপি", copiedBtn: "কপি হয়েছে!",
            zakatCalculator: "যাকাত ক্যালকুলেটর",
            totalCash: "মোট নগদ অর্থ",
            goldValue: "সোনার বর্তমান মূল্য",
            silverValue: "রুপার বর্তমান মূল্য",
            businessAssets: "ব্যবসার সম্পদ",
            savingsDeposits: "সঞ্চয় ও ডিপোজিট",
            propertyIncome: "ভাড়া/বিনিয়োগ থেকে আয়",
            totalLiabilities: "মোট দায়/ঋণ",
            calculateZakat: "হিসাব করুন",
            zakatResultTitle: "যাকাতের হিসাব",
            calculationSummary: "যাকাতের সারাংশ",
            totalAssets: "মোট যাকাতযোগ্য সম্পদ",
            netAssets: "নেট যাকাতযোগ্য সম্পদ",
            nisabThreshold: "নিসাব পরিমাণ",
            payableZakat: "প্রদেয় যাকাত",
            zakatNotApplicable: "আপনার উপর যাকাত ফরজ হয়নি।",
            marketPriceNote: "দ্রষ্টব্য: রুপার নিসাব আনুমানিক। যাকাত দেওয়ার আগে আপনার স্থানীয় বাজার দর যাচাই করে নিন।",
            quranProgressTitle: "কুরআন পড়ার অগ্রগতি", markAsReadTitle: "পড়া হয়েছে হিসেবে চিহ্নিত করুন", quranProgressText: "%s3% সম্পন্ন (%s1/114)",
            addEditNote: "নোট যুক্ত/সম্পাদনা করুন", notePlaceholder: "আপনার ব্যক্তিগত নোট এখানে লিখুন...",
            guide: {
                title: "ইউজার গাইড",
                welcome: "<strong>ইসলামিক প্রো</strong> অ্যাপে আপনাকে স্বাগতম! নিচে অ্যাপের বিভিন্ন ফিচার এবং সেগুলো কিভাবে ব্যবহার করবেন তার একটি সংক্ষিপ্ত বিবরণ দেওয়া হলো।",
                prayer: { title: "নামাজ ট্যাব", text: "এই ট্যাবে আপনার শহরের জন্য নামাজের সময়সূচি দেখতে পাবেন। পরবর্তী নামাজের জন্য কাউন্টডাউন টাইমার এবং দিনের প্রার্থনা চক্রের একটি সুন্দর গ্রাফ রয়েছে। আপনি কাউন্টডাউন উইজেটটি স্ক্রিনের যেকোনো জায়গায় টেনে নিয়ে যেতে পারবেন।" },
                quran: { title: "কুরআন ট্যাব", text: "এখানে আপনি সম্পূর্ণ কুরআন পড়তে পারবেন। প্রতিটি আয়াতের আরবি, উচ্চারণ ও অনুবাদ দেওয়া আছে। আয়াতের পাশে থাকা বুকমার্ক (<i class='far fa-bookmark' style='font-size: 0.9em;'></i>) আইকনে ক্লিক করে আয়াত সংরক্ষণ করতে পারেন এবং প্লে (<i class='fas fa-play' style='font-size: 0.8em;'></i>) বাটনে ক্লিক করে নির্দিষ্ট আয়াতের অডিও শুনতে পারেন।" },
                audio: { title: "অডিও কুরআন ট্যাব", text: "যেকোনো সূরা সম্পূর্ণ অডিওতে শোনার জন্য এই ট্যাব ব্যবহার করুন। সূরাতে ক্লিক করলে একটি ছোট, ভাসমান অডিও প্লেয়ার চালু হবে যা আপনি স্ক্রিনের যেকোনো জায়গায় রাখতে পারবেন এবং অ্যাপ ব্যবহারের পাশাপাশি তিলাওয়াত শুনতে পারবেন।" },
                amal: { title: "আমল ট্যাব", text: "দৈনন্দিন জীবনের জন্য প্রয়োজনীয় দোয়া, নির্বাচিত হাদিস, আল্লাহর ৯৯টি নাম এবং যাকাত ক্যালকুলেটর এখানে পাবেন।" },
                tasbih: { title: "তাসবিহ ট্যাব", text: "ডিজিটাল তাসবিহ গণনার জন্য এটি ব্যবহার করুন। বড় পুঁতির মতো অংশে ক্লিক করে গণনা করুন এবং নিচের বাটন দিয়ে তাসবিহ পরিবর্তন বা রিসেট করুন।" },
                namaz: { title: "নামাজ শিক্ষা ট্যাব", text: "পুরুষ ও মহিলাদের জন্য আলাদাভাবে सचित्र নামাজ পড়ার নিয়মাবলী এখানে ধাপে ধাপে বর্ণনা করা হয়েছে।" },
                hadith: { title: "হাদিস ট্যাব", text: "এখানে সিহাহ সিত্তাহসহ গুরুত্বপূর্ণ হাদিস গ্রন্থগুলো থেকে হাদিস পড়তে ও অনুসন্ধান করতে পারবেন। প্রতিটি হাদিস বুকমার্ক করে রাখার সুবিধাও রয়েছে।" },
                settings: { title: "সেটিংস ট্যাব", text: "অ্যাপের ভাষা, শহর, ডার্ক মোড, লেখার আকার এবং অডিওসহ বিভিন্ন বিষয় এখান থেকে নিয়ন্ত্রণ করুন।" }
            }
        },
        en: {
            appName: "Islamic Pro", tabPrayer: "Prayer", tabQuran: "Quran", tabAudioQuran: "Audio Quran", tabAmal: "Deeds", tabTasbih: "Tasbih", tabNamazShikkha: "Prayer Guide", tabHadith: "Hadith", tabSettings: "Settings", userGuideTitle: "User Guide",
            nextPrayerLabel: "Next Prayer", backToSurahList: "Back to Surah List", dailyAmalTitle: "Daily Deeds", selectedHadiths: "Selected Hadiths", 
            essentialDuas: "Essential Duas", asmaulHusna: "99 Names of Allah", hadith: "Hadith", back: "Back", reset: "Reset", previous: "Previous", next: "Next", 
            changeCity: "Change City", save: "Save", language: "Language", appAppearance: "Appearance", darkMode: "Dark Mode", textSize: "Text Size", 
            notifications: "Notifications",
            cityUpdated: `City changed to "%s".`, ayahs: "Ayahs", 
            loadingSurah: "Loading Surah...", surahLoadError: `Could not load Surah %s.`, timeUp: "Time's Up!", cityNotFound: "City not found.", 
            apiError: "Failed to fetch data from API.", noInternet: "No internet connection.", graphError: "Could not load graph.", error: "Error",
            loadingAudio: "Loading audio...", audioLoadError: "Failed to load audio",
            hadithCollectionTitle: "Hadith Collections", selectBook: "Select a Book", loadingHadiths: "Loading Hadiths...", hadithLoadError: "Could not load Hadiths.", searchHadithPlaceholder: "Search Hadith (number or word)...",
            mensPrayer: "Men's Prayer", womensPrayer: "Women's Prayer",
            quranEdition: 'en.sahih', viewBookmarks: "View Bookmarks", loadingBookmarks: "Loading bookmarks...", noBookmarks: "No bookmarks found.",
            bookmarksTitle: "Saved Bookmarks",
            viewHadithBookmarks: "View Hadith Bookmarks", loadingHadithBookmarks: "Loading bookmarks...", noHadithBookmarks: "No Hadith bookmarks found.", hadithBookmarksTitle: "Saved Hadith Bookmarks",
            permissions: "Permissions", enableBookmarking: "Enable Bookmarking",
            audioSettings: "Audio Settings", enableAudio: "Enable Audio", reciter: "Reciter", autoClosePlayerLabel: "Auto-close Player",
            devInfo: "Developer Info", devName: "Name", devEmail: "Email", devWhatsApp: "WhatsApp", devTitle: "App Developer",
            devNameValue: "MD Al Amin Sarkar", devEmailValue: "alaminsarkar.bsc@gmail.com", devWhatsAppValue: "01989170955",
            donationTitle: "Support Server Maintenance", donationDesc: "Your small donation is a great inspiration for us to operate this app completely free of charge and to cover the server costs. You can send donations to the number or bank account below.", 
            bankAccountTitle: "Bank Account", copyBtn: "Copy", copiedBtn: "Copied!",
            zakatCalculator: "Zakat Calculator",
            totalCash: "Total Cash",
            goldValue: "Current Value of Gold",
            silverValue: "Current Value of Silver",
            businessAssets: "Business Assets",
            savingsDeposits: "Savings & Deposits",
            propertyIncome: "Income from Rent/Investments",
            totalLiabilities: "Total Liabilities/Debt",
            calculateZakat: "Calculate",
            zakatResultTitle: "Zakat Calculation",
            calculationSummary: "Zakat Summary",
            totalAssets: "Total Zakatable Assets",
            netAssets: "Net Zakatable Assets",
            nisabThreshold: "Nisab Threshold",
            payableZakat: "Payable Zakat",
            zakatNotApplicable: "Zakat is not applicable for you.",
            marketPriceNote: "Note: The Silver Nisab is approximate. Please verify with your local market rates before paying Zakat.",
            quranProgressTitle: "Quran Reading Progress", markAsReadTitle: "Mark as read", quranProgressText: "%s3% Complete (%s1/114)",
            addEditNote: "Add/Edit Note", notePlaceholder: "Write your personal note here...",
            guide: {
                title: "User Guide",
                welcome: "Welcome to the <strong>Islamic Pro</strong> app! Below is a brief overview of the app's various features and how to use them.",
                prayer: { title: "Prayer Tab", text: "In this tab, you will find the prayer schedule for your city. There is a countdown timer for the next prayer and a beautiful graph of the day's prayer cycle. You can drag the countdown widget anywhere on the screen." },
                quran: { title: "Quran Tab", text: "Here you can read the entire Quran. Each verse provides the Arabic text, transliteration, and translation. You can save verses by clicking the bookmark (<i class='far fa-bookmark' style='font-size: 0.9em;'></i>) icon and listen to the audio of a specific verse by clicking the play (<i class='fas fa-play' style='font-size: 0.8em;'></i>) button." },
                audio: { title: "Audio Quran Tab", text: "Use this tab to listen to any Surah in full audio. Clicking on a Surah will launch a small, floating audio player that you can place anywhere on the screen and listen to the recitation while using the app." },
                amal: { title: "Deeds Tab", text: "Here you will find essential duas for daily life, selected hadiths, the 99 names of Allah, and a Zakat calculator." },
                tasbih: { title: "Tasbih Tab", text: "Use this for digital Tasbih counting. Click on the large bead-like area to count, and use the buttons below to change or reset the Tasbih." },
                namaz: { title: "Prayer Guide Tab", text: "Illustrated step-by-step instructions on how to perform the prayer are described here separately for men and women." },
                hadith: { title: "Hadith Tab", text: "Here you can read and search hadiths from important hadith collections, including the Sihah Sitta. There is also a facility to bookmark each hadith." },
                settings: { title: "Settings Tab", text: "Control various aspects of the app from here, including language, city, dark mode, text size, and audio settings." }
            }
        },
        hi: {
            appName: "इस्लामिक प्रो", tabPrayer: "नमाज़", tabQuran: "क़ुरान", tabAudioQuran: "ऑडियो कुरान", tabAmal: "कर्म", tabTasbih: "तस्बीह", tabNamazShikkha: "नमाज़ गाइड", tabHadith: "हदीस", tabSettings: "सेटिंग्स", userGuideTitle: "उपयोगकर्ता गाइड",
            nextPrayerLabel: "अगली नमाज़", backToSurahList: "सूरह सूची पर वापस जाएं", dailyAmalTitle: "दैनिक कर्म", selectedHadiths: "चयनित हदीसें", 
            essentialDuas: "आवश्यक दुआएं", asmaulHusna: "अल्लाह के 99 नाम", hadith: "हदीस", back: "वापस", reset: "रीसेट", previous: "पिछला", next: "अगला", 
            changeCity: "शहर बदलें", save: "सेव", language: "भाषा", appAppearance: "ऐप दिखावट", darkMode: "डार्क मोड", textSize: "टेक्स्ट का आकार", 
            notifications: "सूचनाएं",
            cityUpdated: `शहर "%s" में बदल गया है।`, ayahs: "आयतें", 
            loadingSurah: "सूरह लोड हो रहा है...", surahLoadError: `सूरह %s लोड नहीं हो सका।`, timeUp: "समय समाप्त!", cityNotFound: "शहर नहीं मिला।", 
            apiError: "API से डेटा प्राप्त करने में विफल।", noInternet: "कोई इंटरनेट कनेक्शन नहीं है।", graphError: "ग्राफ लोड नहीं हो सका।", error: "त्रुटि",
            loadingAudio: "ऑडियो लोड हो रहा है...", audioLoadError: "ऑडियो लोड करने में विफल",
            hadithCollectionTitle: "हदीस संग्रह", selectBook: "एक किताब चुनें", loadingHadiths: "हदीस लोड हो रही हैं...", hadithLoadError: "हदीस लोड नहीं हो सकी।", searchHadithPlaceholder: "हदीस खोजें (संख्या या शब्द)...",
            mensPrayer: "पुरुषों की नमाज़", womensPrayer: "महिलाओं की नमाज़",
            quranEdition: 'hi.hindi', viewBookmarks: "बुकमार्क देखें", loadingBookmarks: "बुकमार्क लोड हो रहे हैं...", noBookmarks: "कोई बुकमार्क नहीं मिला।",
            bookmarksTitle: "सहेजे गए बुकमार्क",
            viewHadithBookmarks: "हदीस बुकमार्क देखें", loadingHadithBookmarks: "बुकमार्क लोड हो रहे हैं...", noHadithBookmarks: "कोई हदीस बुकमार्क नहीं मिला।", hadithBookmarksTitle: "सहेजे गए हदीस बुकमार्क",
            permissions: "अनुमतियाँ", enableBookmarking: "बुकमार्किंग सक्षम करें",
            audioSettings: "ऑडियो सेटिंग्स", enableAudio: "ऑडियो सक्षम करें", reciter: "कारी", autoClosePlayerLabel: "प्लेयर ऑटो-क्लोज",
            devInfo: "डेवलपर जानकारी", devName: "नाम", devEmail: "ईमेल", devWhatsApp: "व्हाट्सएप", devTitle: "ऐप डेवलपर",
            devNameValue: "MD Al Amin Sarkar", devEmailValue: "alaminsarkar.bsc@gmail.com", devWhatsAppValue: "01989170955",
            donationTitle: "सर्वर रखरखाव में सहायता करें", donationDesc: "इस ऐप को पूरी तरह से नि: शुल्क संचालित करने और सर्वर की लागतों को कवर करने के लिए आपका छोटा सा दान हमारे लिए एक बड़ी प्रेरणा है। आप नीचे दिए गए नंबर या बैंक खाते पर दान भेज सकते हैं।", 
            bankAccountTitle: "बैंक खाता", copyBtn: "कॉपी", copiedBtn: "कॉपी हो गया!",
            zakatCalculator: "ज़कात कैलकुलेटर",
            totalCash: "कुल नकद",
            goldValue: "सोने का वर्तमान मूल्य",
            silverValue: "चांदी का वर्तमान मूल्य",
            businessAssets: "व्यावसायिक संपत्ति",
            savingsDeposits: "बचत और जमा",
            propertyIncome: "किराए/निवेश से आय",
            totalLiabilities: "कुल देनदारियां/ऋण",
            calculateZakat: "गणना करें",
            zakatResultTitle: "ज़कात की गणना",
            calculationSummary: "ज़कात का सारांश",
            totalAssets: "कुल ज़कात योग्य संपत्ति",
            netAssets: "शुद्ध ज़कात योग्य संपत्ति",
            nisabThreshold: "निसाब की सीमा",
            payableZakat: "देय ज़कात",
            zakatNotApplicable: "आप पर ज़कात अनिवार्य नहीं है।",
            marketPriceNote: "ध्यान दें: चांदी का निसाब अनुमानित है। ज़कात देने से पहले कृपया अपने स्थानीय बाजार दरों से सत्यापित करें।",
            quranProgressTitle: "क़ुरान पढ़ने की प्रगति", markAsReadTitle: "पढ़ा हुआ चिह्नित करें", quranProgressText: "%s3% पूर्ण (%s1/114)",
            addEditNote: "नोट जोड़ें/संपादित करें", notePlaceholder: "अपना व्यक्तिगत नोट यहां लिखें...",
            guide: {
                title: "उपयोगकर्ता गाइड",
                welcome: "<strong>इस्लामिक प्रो</strong> ऐप में आपका स्वागत है! नीचे ऐप की विभिन्न विशेषताओं और उनका उपयोग करने के तरीके का संक्षिप्त विवरण दिया गया है।",
                prayer: { title: "नमाज़ टैब", text: "इस टैब में, आपको अपने शहर के लिए नमाज़ का समय मिलेगा। अगली नमाज़ के लिए एक काउंटडाउन टाइमर और दिन के प्रार्थना चक्र का एक सुंदर ग्राफ है। आप काउंटडाउन विजेट को स्क्रीन पर कहीं भी खींच सकते हैं।" },
                quran: { title: "क़ुरान टैब", text: "यहां आप पूरा क़ुरान पढ़ सकते हैं। प्रत्येक आयत में अरबी पाठ, लिप्यंतरण और अनुवाद प्रदान किया गया है। आप बुकमार्क (<i class='far fa-bookmark' style='font-size: 0.9em;'></i>) आइकन पर क्लिक करके आयतों को सहेज सकते हैं और प्ले (<i class='fas fa-play' style='font-size: 0.8em;'></i>) बटन पर क्लिक करके किसी विशिष्ट आयत का ऑडियो सुन सकते हैं।" },
                audio: { title: "ऑडियो क़ुरान टैब", text: "किसी भी सूरह को पूर्ण ऑडियो में सुनने के लिए इस टैब का उपयोग करें। एक सूरह पर क्लिक करने से एक छोटा, फ्लोटिंग ऑडियो प्लेयर लॉन्च होगा जिसे आप स्क्रीन पर कहीं भी रख सकते हैं और ऐप का उपयोग करते समय तिलावत सुन सकते हैं।" },
                amal: { title: "कर्म टैब", text: "यहां आपको दैनिक जीवन के लिए आवश्यक दुआएं, चयनित हदीसें, अल्लाह के 99 नाम और एक ज़कात कैलकुलेटर मिलेगा।" },
                tasbih: { title: "तस्बीह टैब", text: "इसका उपयोग डिजिटल तस्बीह गिनने के लिए करें। गिनने के लिए बड़े मोती जैसे क्षेत्र पर क्लिक करें, और तस्बीह को बदलने या रीसेट करने के लिए नीचे दिए गए बटन का उपयोग करें।" },
                namaz: { title: "नमाज़ गाइड टैब", text: "नमाज़ अदा करने के तरीके पर सचित्र चरण-दर-चरण निर्देश यहाँ पुरुषों और महिलाओं के लिए अलग-अलग वर्णित हैं।" },
                hadith: { title: "हदीस टैब", text: "यहां आप सिहा सित्ता सहित महत्वपूर्ण हदीस संग्रहों से हदीस पढ़ और खोज सकते हैं। प्रत्येक हदीस को बुकमार्क करने की सुविधा भी है।" },
                settings: { title: "सेटिंग्स टैब", text: "यहां से ऐप के विभिन्न पहलुओं को नियंत्रित करें, जिसमें भाषा, शहर, डार्क मोड, टेक्स्ट का आकार और ऑडियो सेटिंग्स शामिल हैं।" }
            }
        },
        ur: {
            appName: "اسلامک پرو", tabPrayer: "نماز", tabQuran: "قرآن", tabAudioQuran: "آڈیو قرآن", tabAmal: "اعمال", tabTasbih: "تسبیح", tabNamazShikkha: "نماز گائیڈ", tabHadith: "حدیث", tabSettings: "ترتیبات", userGuideTitle: "صارف گائیڈ",
            nextPrayerLabel: "اگلی نماز", backToSurahList: "سورہ فہرست پر واپس جائیں", dailyAmalTitle: "روزانہ کے اعمال", selectedHadiths: "منتخب احادیث",
            essentialDuas: "ضروری دعائیں", asmaulHusna: "اللہ کے 99 نام", hadith: "حدیث", back: "واپس", reset: "ری سیٹ", previous: "پچھلا", next: "اگلا",
            changeCity: "شہر تبدیل کریں", save: "محفوظ کریں", language: "زبان", appAppearance: "ایپ کی شکل", darkMode: "ڈارک موڈ", textSize: "متن کا سائز",
            notifications: "اطلاعات",
            cityUpdated: `شہر کو "%s" میں تبدیل کر دیا گیا ہے۔`, ayahs: "آیات",
            loadingSurah: "سورہ لوڈ ہو رہی ہے...", surahLoadError: `سورہ %s لوڈ نہیں ہو سکی۔`, timeUp: "وقت ختم!", cityNotFound: "شہر نہیں ملا۔",
            apiError: "API سے ڈیٹا لانے میں ناکامی۔", noInternet: "کوئی انٹرنیٹ کنکشن نہیں ہے۔", graphError: "گراف لوڈ نہیں ہو سکا۔", error: "خرابی",
            loadingAudio: "آڈیو لوڈ ہو رہا ہے...", audioLoadError: "آڈیو لوڈ کرنے میں ناکام",
            hadithCollectionTitle: "حدیث کے مجموعے", selectBook: "ایک کتاب منتخب کریں", loadingHadiths: "احادیث لوڈ ہو رہی ہیں...", hadithLoadError: "احادیث لوڈ نہیں ہو سکیں۔", searchHadithPlaceholder: "حدیث تلاش کریں (نمبر یا لفظ)...",
            mensPrayer: "مردوں کی نماز", womensPrayer: "خواتین کی نماز",
            quranEdition: 'ur.jalandhry', viewBookmarks: "بک مارکس دیکھیں", loadingBookmarks: "بک مارکس لوڈ ہو رہے ہیں...", noBookmarks: "کوئی بک مارک نہیں ملا۔",
            bookmarksTitle: "محفوظ کردہ بک مارکس",
            viewHadithBookmarks: "حدیث کے بک مارکس دیکھیں", loadingHadithBookmarks: "بک مارکس لوڈ ہو رہے ہیں...", noHadithBookmarks: "کوئی حدیث بک مارک نہیں ملا۔", hadithBookmarksTitle: "محفوظ کردہ حدیث بک مارکس",
            permissions: "اجازتیں", enableBookmarking: "بک مارکنگ فعال کریں",
            audioSettings: "آڈیو ترتیبات", enableAudio: "آڈیو فعال کریں", reciter: "قاری", autoClosePlayerLabel: "پلیئر آٹو کلوز",
            devInfo: "ڈیولپر کی معلومات", devName: "نام", devEmail: "ای میل", devWhatsApp: "واٹس ایپ", devTitle: "ایپ ڈیولپر",
            devNameValue: "MD Al Amin Sarkar", devEmailValue: "alaminsarkar.bsc@gmail.com", devWhatsAppValue: "01989170955",
            donationTitle: "سرور کی بحالی میں مدد کریں", donationDesc: "آپ کا چھوٹا سا عطیہ ہمارے لیے اس ایپ کو مکمل طور پر مفت چلانے اور سرور کے اخراجات پورے کرنے کے لیے ایک بڑی تحریک ہے۔ آپ نیچے دیے گئے نمبر یا بینک اکاؤنٹ پر عطیات بھیج سکتے ہیں۔",
            bankAccountTitle: "بینک اکاؤنٹ", copyBtn: "کاپی", copiedBtn: "کاپی ہو گیا!",
            zakatCalculator: "زکوٰۃ کیلکولیٹر",
            totalCash: "کل نقد رقم",
            goldValue: "سونے کی موجودہ قیمت",
            silverValue: "چاندی کی موجودہ قیمت",
            businessAssets: "کاروباری اثاثے",
            savingsDeposits: "بچت اور ڈیپازٹس",
            propertyIncome: "کرایہ/سرمایہ کاری سے آمدنی",
            totalLiabilities: "کل واجبات/قرض",
            calculateZakat: "حساب لگائیں",
            zakatResultTitle: "زکوٰۃ کا حساب",
            calculationSummary: "زکوٰۃ کا خلاصہ",
            totalAssets: "کل قابلِ زکوٰۃ اثاثے",
            netAssets: "خالص قابلِ زکوٰۃ اثاثے",
            nisabThreshold: "نصاب کی حد",
            payableZakat: "قابلِ ادا زکوٰۃ",
            zakatNotApplicable: "آپ پر زکوٰۃ فرض نہیں ہے۔",
            marketPriceNote: "نوٹ: चांदी का निसाब अनुमानित है। زکوٰۃ ادا کرنے سے پہلے براہ کرم اپنے مقامی بازار کے نرخوں سے تصدیق کر لیں۔",
            quranProgressTitle: "قرآن پڑھنے کی پیشرفت", markAsReadTitle: "پڑھا ہوا نشان زد کریں", quranProgressText: "%s3% مکمل (%s1/114)",
            addEditNote: "نوٹ شامل/ترمیم کریں", notePlaceholder: "اپنا ذاتی نوٹ یہاں لکھیں...",
            guide: {
                title: "صارف گائیڈ",
                welcome: "<strong>اسلامک پرو</strong> ایپ میں خوش آمدید! ذیل میں ایپ کی مختلف خصوصیات اور ان کے استعمال کے طریقے کا مختصر جائزہ دیا گیا ہے۔",
                prayer: { title: "نماز ٹیب", text: "اس ٹیب میں، آپ کو اپنے شہر کے لیے نماز کے اوقات ملیں گے۔ اگلی نماز کے لیے ایک کاؤنٹ ڈاؤن ٹائمر اور دن کے نماز کے چکر کا ایک خوبصورت گراف ہے۔ آپ کاؤنٹ ڈاؤن ویجیٹ کو اسکرین پر کہیں بھی گھسیٹ سکتے ہیں۔" },
                quran: { title: "قرآن ٹیب", text: "یہاں آپ پورا قرآن پڑھ سکتے ہیں۔ ہر آیت عربی متن، نقل حرفی، اور ترجمہ فراہم کرتی ہے۔ آپ بک مارک (<i class='far fa-bookmark' style='font-size: 0.9em;'></i>) آئیکن پر کلک کرکے آیات کو محفوظ کرسکتے ہیں اور پلے (<i class='fas fa-play' style='font-size: 0.8em;'></i>) بٹن پر کلک کرکے کسی مخصوص آیت کی آڈیو سن سکتے ہیں۔" },
                audio: { title: "آڈیو قرآن ٹیب", text: "کسی بھی سورت کو مکمل آڈیو میں سننے کے لیے اس ٹیب کا استعمال کریں۔ کسی سورت پر کلک کرنے سے ایک چھوٹا، تیرتا ہوا آڈیو پلیئر شروع ہو جائے گا جسے آپ اسکرین پر کہیں بھی رکھ سکتے ہیں اور ایپ استعمال کرتے ہوئے تلاوت سن سکتے ہیں۔" },
                amal: { title: "اعمال ٹیب", text: "یہاں آپ کو روزمرہ کی زندگی کے لیے ضروری دعائیں، منتخب احادیث، اللہ کے 99 نام، اور ایک زکوٰۃ کیلکولیটর ملے گا۔" },
                tasbih: { title: "تسبیح ٹیب", text: "اسے ڈیجیٹل تسبیح گننے کے لیے استعمال کریں۔ گننے کے لیے بڑے موتی جیسے حصے پر کلک کریں، اور تسبیح کو تبدیل کرنے یا دوبارہ ترتیب دینے کے لیے نیچے دیے گئے بٹنوں کا استعمال کریں۔" },
                namaz: { title: "نماز گائیڈ ٹیب", text: "نماز ادا کرنے کے طریقے پر تصویری مرحلہ وار ہدایات یہاں مردوں اور عورتوں کے لیے الگ الگ بیان کی گئی ہیں۔" },
                hadith: { title: "حدیث ٹیب", text: "یہاں آپ صحاح ستہ سمیت اہم حدیث کے مجموعوں سے احادیث پڑھ اور تلاش کر سکتے ہیں۔ ہر حدیث کو بک مارک کرنے کی سہولت بھی موجود ہے۔" },
                settings: { title: "ترتیبات ٹیب", text: "یہاں سے ایپ کے مختلف پہلوؤں کو کنٹرول کریں، بشمول زبان، شہر، ڈارک موڈ، متن کا سائز، اور آڈیو ترتیبات۔" }
            }
        }
    };

    const getNoteKey = (type, id1, id2) => `islamic-pro-note-${type}-${id1}-${id2}`;

    const setupNoteEventListeners = (container) => {
        container.querySelectorAll('.toggle-note-btn').forEach(button => {
            const noteSection = button.closest('.personal-note-section');
            const editor = noteSection.querySelector('.note-editor');

            button.addEventListener('click', () => {
                const isVisible = editor.style.display === 'block';
                editor.style.display = isVisible ? 'none' : 'block';
                if (!isVisible) {
                    editor.querySelector('.note-textarea').focus();
                }
            });
        });

        container.querySelectorAll('.note-textarea').forEach(textarea => {
            const noteSection = textarea.closest('.personal-note-section');
            const display = noteSection.querySelector('.note-display');
            const noteKey = textarea.dataset.noteKey;

            const savedNote = localStorage.getItem(noteKey);
            if (savedNote) {
                textarea.value = savedNote;
                display.textContent = savedNote;
            }

            textarea.addEventListener('input', () => {
                const noteText = textarea.value;
                if (noteText) {
                    localStorage.setItem(noteKey, noteText);
                    display.textContent = noteText;
                } else {
                    localStorage.removeItem(noteKey);
                    display.textContent = '';
                }
            });
        });
    };
    
    const showUserGuide = () => {
        DOMElements.menuDropdown.style.display = 'none';
        const t = translations[state.currentLang].guide;
        const guideHTML = `
            <div class="page-header">
                <button class="back-btn"><i class="fas fa-arrow-left"></i></button>
                <h1>${t.title}</h1>
            </div>
            <div class="page-content">
                <div class="info-note"><p>${t.welcome}</p></div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-mosque"></i></div>
                    <div class="guide-text"><h4>${t.prayer.title}</h4><p>${t.prayer.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-book-quran"></i></div>
                    <div class="guide-text"><h4>${t.quran.title}</h4><p>${t.quran.text}</p></div>
                </div>
                 <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-headphones"></i></div>
                    <div class="guide-text"><h4>${t.audio.title}</h4><p>${t.audio.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-star-and-crescent"></i></div>
                    <div class="guide-text"><h4>${t.amal.title}</h4><p>${t.amal.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-hand-dots"></i></div>
                    <div class="guide-text"><h4>${t.tasbih.title}</h4><p>${t.tasbih.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-person-praying"></i></div>
                    <div class="guide-text"><h4>${t.namaz.title}</h4><p>${t.namaz.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-book-bookmark"></i></div>
                    <div class="guide-text"><h4>${t.hadith.title}</h4><p>${t.hadith.text}</p></div>
                </div>
                <div class="guide-section">
                    <div class="guide-icon"><i class="fa-solid fa-cog"></i></div>
                    <div class="guide-text"><h4>${t.settings.title}</h4><p>${t.settings.text}</p></div>
                </div>
            </div>`;
        DOMElements.userGuideOverlay.innerHTML = guideHTML;
        DOMElements.userGuideOverlay.classList.add('visible');
        DOMElements.userGuideOverlay.querySelector('.back-btn').addEventListener('click', () => {
            DOMElements.userGuideOverlay.classList.remove('visible');
        });
    };

    const applyTheme = (isDark) => { state.isDarkMode = isDark; DOMElements.appContainer.classList.toggle('dark-mode', isDark); };
    const applyFontSize = (multiplier) => { state.fontSizeMultiplier = multiplier; DOMElements.body.style.setProperty('--font-size-multiplier', multiplier); };
    
    applyTheme(localStorage.getItem('appTheme') === 'dark');
    applyFontSize(state.fontSizeMultiplier);

    const showLoader = (container, text = '') => { container.innerHTML = `<div class="loader"><div class="spinner"></div><p>${text}</p></div>`; };
    const showError = (container, message) => { container.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i><p>${message}</p></div>`; };
    const formatTime12Hour = (timeStr) => { const [h, m] = timeStr.split(':'); const hour = parseInt(h, 10); return `${hour % 12 || 12}:${m} ${hour >= 12 ? 'PM' : 'AM'}`; };
    
    const copyToClipboard = (text, callback) => {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => {
                if (callback) callback();
            }).catch(err => { console.error('Failed to copy text: ', err); });
        } else {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "absolute"; textArea.style.left = "-999999px";
            document.body.prepend(textArea);
            textArea.select();
            try { document.execCommand('copy'); if (callback) callback(); } 
            catch (err) { console.error('Fallback: Oops, unable to copy', err); } 
            finally { textArea.remove(); }
        }
    };

    const shareContent = async (shareData) => {
        const t = translations[state.currentLang];
        const fullText = `${shareData.title}\n\n${shareData.text.replace(/<br>/g, "\n")}`;
        
        if (navigator.share && navigator.canShare(shareData)) {
            try {
                await navigator.share(shareData);
            } catch (err) {
                console.error('Error sharing:', err);
            }
        } else {
            copyToClipboard(fullText, () => {
                const alertMessages = {
                    bn: 'শেয়ার করার অপশন নেই। লেখাটি ক্লিপবোর্ডে কপি করা হয়েছে।',
                    en: 'Share option not available. The text has been copied to the clipboard.',
                    hi: 'शेयर विकल्प उपलब्ध नहीं है। टेक्स्ट क्लिपबोर्ड पर कॉपी कर लिया गया है।',
                    ur: 'شیئر کا آپشن دستیاب نہیں ہے۔ متن کلپ بورڈ پر کاپی کر لیا گیا ہے۔'
                };
                alert(alertMessages[state.currentLang] || alertMessages['bn']);
            });
        }
    };

    const stopAllAudio = () => {
        if (state.currentlyPlayingAudio) {
            state.currentlyPlayingAudio.pause();
            if(state.currentlyPlayingBtn) state.currentlyPlayingBtn.innerHTML = '<i class="fas fa-play"></i>';
            state.currentlyPlayingAudio = null;
            state.currentlyPlayingBtn = null;
        }
        if (state.audioPlayer.audio && !state.audioPlayer.audio.paused) {
            state.audioPlayer.audio.pause();
            state.audioPlayer.isPlaying = false;
            const playBtn = document.getElementById('audio-player-play-btn');
            if (playBtn) playBtn.innerHTML = '<i class="fas fa-play"></i>';
            if ('mediaSession' in navigator) {
                navigator.mediaSession.playbackState = 'paused';
            }
        }
    };

    const switchTab = (tabId) => {
        const targetPane = document.getElementById(`${tabId}-tab`);
        DOMElements.tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabId));
        DOMElements.tabPanes.forEach(p => p.classList.toggle('active', p.id === `${tabId}-tab`));
        
        const prayerWidget = document.getElementById('prayer-widget-container');
        if (prayerWidget) {
            prayerWidget.style.display = (tabId === 'prayer') ? 'block' : 'none';
        }
        
        if (!targetPane.dataset.loaded) {
            // --- START: ব্যাক বাটন পরিবর্তন ---
            // ট্যাব কন্টেন্ট লোড করার আগে তার প্রাথমিক স্টেট সেট করুন
            switch (tabId) {
                case 'quran':
                    history.replaceState({ tab: 'quran', view: 'surahList' }, '', '#quran');
                    break;
                case 'amal':
                    history.replaceState({ tab: 'amal', view: 'amalCategories' }, '', '#amal');
                    break;
                case 'hadith':
                    history.replaceState({ tab: 'hadith', view: 'hadithBookSelection' }, '', '#hadith');
                    break;
                case 'namaz-shikkha':
                    history.replaceState({ tab: 'namaz-shikkha', view: 'genderSelection' }, '', '#namaz-shikkha');
                    break;
            }
            // --- END: ব্যাক বাটন পরিবর্তন ---
            loadTabContent(tabId, targetPane);
            targetPane.dataset.loaded = 'true';
        }
    };

    const loadTabContent = (tabId, container) => { 
        const isPrayerTab = tabId === 'prayer';
        const firstCard = container.querySelector('.card');
        if (isPrayerTab && firstCard) {
            firstCard.style.marginTop = '15px';
        }
        if (document.querySelector('.tab-pane.active').id !== 'prayer-tab') {
             const prayerTabFirstCard = document.querySelector('#prayer-tab .card');
             if(prayerTabFirstCard) prayerTabFirstCard.style.marginTop = '15px';
        }

        switch (tabId) { 
            case 'quran': showLoader(container); loadSurahList(); break; 
            case 'audio-quran': initAudioQuranTab(container); break;
            case 'amal': loadDailyAmalCategories(); break; 
            case 'tasbih': initTasbih(); break; 
            case 'namaz-shikkha': initNamazShikkhaTab(container); break; 
            case 'hadith': initHadithTab(container); break; 
            case 'settings': initSettings(); break; 
        }
    };

    const positionPrayerWidget = () => {
        const arcContainer = document.getElementById('prayer-arc-container');
        const widget = document.getElementById('prayer-widget-container');

        if (arcContainer && widget) {
            const arcRect = arcContainer.getBoundingClientRect();
            const widgetRect = widget.getBoundingClientRect();
            const appContainerRect = DOMElements.appContainer.getBoundingClientRect();

            const arcTopInApp = arcRect.top - appContainerRect.top;
            
            let newTop = arcTopInApp + (arcRect.height / 2) - (widgetRect.height / 2);
            let newLeft = (appContainerRect.width / 2) - (widgetRect.width / 2);

            newTop = Math.max(0, newTop);
            newLeft = Math.max(0, newLeft);

            widget.style.top = `${newTop}px`;
            widget.style.left = `${newLeft}px`;
        }
    };
    
    const getPrayerTimes = async () => { 
        const t = translations[state.currentLang];
        const today = new Date().toISOString().slice(0, 10); 
        const dbKey = `${state.currentCity}_${today}`;

        const cachedData = await getFromDB('prayerTimes', dbKey);
        if (cachedData) {
            displayPrayerData(cachedData);
            return;
        }
        
        if (!navigator.onLine) {
            showError(DOMElements.prayerTimesList, t.noInternet);
            showError(DOMElements.prayerArcHolder, t.noInternet);
            const nextPrayerNameEl = document.getElementById('next-prayer-name');
            const nextPrayerCountdownEl = document.getElementById('next-prayer-countdown');
            if(nextPrayerNameEl) nextPrayerNameEl.textContent = 'N/A';
            if(nextPrayerCountdownEl) nextPrayerCountdownEl.textContent = t.noInternet;
            return;
        }
        
        try { 
            const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${state.currentCity}&country=Bangladesh&method=1`); 
            if (!res.ok) throw new Error(t.cityNotFound); 
            const data = await res.json(); 
            if (data.code !== 200) throw new Error(t.apiError); 
            
            await saveToDB('prayerTimes', dbKey, data.data); 
            displayPrayerData(data.data);

        } catch (error) { 
            showError(DOMElements.prayerTimesList, error.message); 
            showError(DOMElements.prayerArcHolder, t.graphError);
            const nextPrayerNameEl = document.getElementById('next-prayer-name');
            const nextPrayerCountdownEl = document.getElementById('next-prayer-countdown');
            if(nextPrayerNameEl) nextPrayerNameEl.textContent = t.error;
            if(nextPrayerCountdownEl) nextPrayerCountdownEl.textContent = ':-('; 
        } 
    };

    const displayPrayerData = (prayerData) => {
        const t = translations[state.currentLang];
        const hijriDateEl = document.getElementById('hijri-date');
        if(hijriDateEl) hijriDateEl.textContent = `${prayerData.date.hijri.day} ${prayerData.date.hijri.month.en}, ${prayerData.date.hijri.year} ${state.currentLang === 'ur' ? 'هجری' : 'হিজরি'}`; 
        
        const prayerOrder = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha']; 
        const prayerNames = {
            bn: { Fajr: 'ফজর', Dhuhr: 'যোহর', Asr: 'আসর', Maghrib: 'মাগরিব', Isha: 'ইশা' },
            en: { Fajr: 'Fajr', Dhuhr: 'Dhuhr', Asr: 'Asr', Maghrib: 'Maghrib', Isha: 'Isha' },
            hi: { Fajr: 'फज्र', Dhuhr: 'जोहर', Asr: 'असर', Maghrib: 'मगरिब', Isha: 'ईशा' },
            ur: { Fajr: 'فجر', Dhuhr: 'ظہر', Asr: 'عصر', Maghrib: 'مغرب', Isha: 'عشاء' }
        };
        const prayerNamesCurrentLang = prayerNames[state.currentLang];
        let nextPrayerName = null; const now = new Date(); 
        for (const name of prayerOrder) { const [h, m] = prayerData.timings[name].split(':'); const prayerDate = new Date(); prayerDate.setHours(h, m, 0, 0); if (prayerDate > now) { nextPrayerName = name; break; } } 
        if (!nextPrayerName) { nextPrayerName = prayerOrder[0]; } 
        
        DOMElements.prayerTimesList.innerHTML = prayerOrder.map(p => `<div class="prayer-item ${p === nextPrayerName ? 'next-prayer' : ''}"><span class="item-name-bn">${prayerNamesCurrentLang[p]}</span><span class="item-time">${formatTime12Hour(prayerData.timings[p])}</span></div>`).join(''); 
        startCountdown(prayerData.timings, prayerOrder, prayerNamesCurrentLang);
        renderPrayerArc(prayerData.timings, prayerNamesCurrentLang);
        
        setTimeout(positionPrayerWidget, 100);
    };

    
    const startCountdown = (timings, order, names) => {
        if (state.countdownInterval) clearInterval(state.countdownInterval);
        const timerFunction = () => {
            let nextPrayer = null;
            const now = new Date();

            for (const name of order) {
                const [h, m] = timings[name].split(':');
                const prayerDate = new Date();
                prayerDate.setHours(h, m, 0, 0);
                if (prayerDate > now) {
                    nextPrayer = { name, date: prayerDate };
                    break;
                }
            }

            if (!nextPrayer) {
                const [h, m] = timings[order[0]].split(':');
                const tomorrow = new Date();
                tomorrow.setDate(now.getDate() + 1);
                tomorrow.setHours(h, m, 0, 0);
                nextPrayer = { name: order[0], date: tomorrow };
            }

            const nextPrayerNameEl = document.getElementById('next-prayer-name');
            const nextPrayerCountdownEl = document.getElementById('next-prayer-countdown');

            if(nextPrayerNameEl) nextPrayerNameEl.textContent = names[nextPrayer.name];
            
            const diff = nextPrayer.date - now;
            
            if (diff <= 1000 && diff > 0) {
                clearInterval(state.countdownInterval);
                setTimeout(getPrayerTimes, 60000); 
                return;
            }
            
            const h = Math.floor(diff / 3600000).toString().padStart(2, '0');
            const m = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
            const s = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
            if(nextPrayerCountdownEl) nextPrayerCountdownEl.textContent = `${h}:${m}:${s}`;
        };
        
        timerFunction();
        state.countdownInterval = setInterval(timerFunction, 1000);
    };
    
    const renderPrayerArc = (timings, prayerNamesLang) => {
        if (state.arcInterval) clearInterval(state.arcInterval);

        const width = 320, height = 160, center_x = width / 2, center_y = height - 20, radius = 130;
        const timeToMinutes = (timeStr) => timeStr.split(':').map(Number).reduce((h, m) => h * 60 + m);
        const timeToAngle = (timeStr) => -180 + (timeToMinutes(timeStr) / 1440) * 180;
        const angleToCoords = (angle, r) => ({ x: center_x + r * Math.cos(angle * Math.PI / 180), y: center_y + r * Math.sin(angle * Math.PI / 180) });
        
        const describeArc = (x, y, r, startAngle, endAngle) => {
            const start = angleToCoords(startAngle, r);
            const end = angleToCoords(endAngle, r);
            return `M ${start.x} ${start.y} A ${r} ${r} 0 0 1 ${end.x} ${end.y}`;
        };

        const prayerData = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'].map(name => ({
            name,
            bnName: prayerNamesLang[name],
            icon: { Fajr: '🌅', Dhuhr: '☀️', Asr: '🌥️', Maghrib: '🌇', Isha: '🌙' }[name],
            color: { Fajr: '#87CEEB', Dhuhr: '#FFD700', Asr: '#FFA500', Maghrib: '#FF4500', Isha: '#483D8B' }[name],
            time: timings[name],
            angle: timeToAngle(timings[name]),
            startTimeMinutes: timeToMinutes(timings[name]),
        }));
        
        const periods = [];
        for(let i = 0; i < prayerData.length; i++) {
            const p = prayerData[i];
            if (p.name === 'Isha') {
                periods.push({ ...p, endAngle: 0, endTimeMinutes: 1440 });
                periods.push({ ...p, angle: -180, startTimeMinutes: 0, endAngle: prayerData[0].angle, endTimeMinutes: prayerData[0].startTimeMinutes });
            } else {
                const nextPrayer = prayerData[i + 1];
                periods.push({ ...p, endAngle: nextPrayer.angle, endTimeMinutes: nextPrayer.startTimeMinutes });
            }
        }

        const svgHTML = `
            <svg id="prayer-arc-svg" viewBox="0 0 ${width} ${height}">
                <path d="${describeArc(center_x, center_y, radius, -180, 0)}" class="arc-track" />
                <g id="prayer-arcs"></g>
                <g id="prayer-labels"></g>
                <g id="current-time-indicator" class="current-time-indicator">
                    <circle cx="0" cy="0" r="8" />
                    <circle cx="0" cy="0" r="4" fill="${state.isDarkMode ? '#121212' : '#FFFFFF'}"/>
                    <text y="20"></text>
                </g>
            </svg>`;
        DOMElements.prayerArcHolder.innerHTML = svgHTML;

        const updateArc = () => {
            const now = new Date();
            const nowInMinutes = now.getHours() * 60 + now.getMinutes();
            
            let currentPeriodName = null;
            const ishaData = prayerData.find(p => p.name === 'Isha');
            const fajrData = prayerData.find(p => p.name === 'Fajr');

            if (nowInMinutes >= ishaData.startTimeMinutes || nowInMinutes < fajrData.startTimeMinutes) {
                currentPeriodName = 'Isha';
            } else {
                for (let i = 0; i < prayerData.length - 1; i++) {
                    if (nowInMinutes >= prayerData[i].startTimeMinutes && nowInMinutes < prayerData[i+1].startTimeMinutes) {
                        currentPeriodName = prayerData[i].name;
                        break;
                    }
                }
            }

            document.getElementById('prayer-arcs').innerHTML = periods.map(p =>
                `<path d="${describeArc(center_x, center_y, radius, p.angle, p.endAngle)}" 
                       class="prayer-period-arc ${currentPeriodName === p.name ? 'current-prayer-period' : ''}" 
                       style="stroke: ${p.color};" />`
            ).join('');

            document.getElementById('prayer-labels').innerHTML = prayerData.map(p => {
                const iconPos = angleToCoords(p.angle, radius);
                const labelPos = angleToCoords(p.angle, radius + 20);
                return `<text x="${iconPos.x}" y="${iconPos.y}" class="prayer-icon">${p.icon}</text>
                        <text x="${labelPos.x}" y="${labelPos.y}" class="prayer-label">${p.bnName}</text>`;
            }).join('');

            const indicator = document.getElementById('current-time-indicator');
            if (indicator) {
                const currentAngle = timeToAngle(now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' }));
                const indicatorPos = angleToCoords(currentAngle, radius);
                indicator.setAttribute('transform', `translate(${indicatorPos.x}, ${indicatorPos.y})`);
                indicator.querySelector('text').textContent = now.toLocaleTimeString('bn-BD', { hour: '2-digit', minute: '2-digit' });
            }
        };

        updateArc();
        state.arcInterval = setInterval(updateArc, 60000);
    };
    
    const saveFavorites = () => localStorage.setItem('favoriteSurahs', JSON.stringify(state.favoriteSurahs));
    const saveBookmarks = () => localStorage.setItem('bookmarks', JSON.stringify(state.bookmarks));
    const saveHadithBookmarks = () => localStorage.setItem('hadithBookmarks', JSON.stringify(state.hadithBookmarks));
    const saveQuranProgress = () => localStorage.setItem('quranProgress', JSON.stringify(state.quranProgress));

    const updateQuranProgressDisplay = () => {
        const totalSurahs = 114;
        const completedCount = state.quranProgress.length;
        const percentage = totalSurahs > 0 ? (completedCount / totalSurahs) * 100 : 0;
        
        const progressBar = document.getElementById('quran-progress-bar');
        const progressText = document.getElementById('quran-progress-text');
        
        if (progressBar) progressBar.style.width = `${percentage}%`;
        if (progressText) {
            const t = translations[state.currentLang];
            progressText.textContent = t.quranProgressText
                .replace('%s1', completedCount)
                .replace('%s2', totalSurahs)
                .replace('%s3', Math.round(percentage));
        }
    };

    const loadSurahList = () => {
        const container = document.getElementById('quran-tab');
        const t = translations[state.currentLang];
        const allSurahs = surahData.names[state.currentLang].map((name, index) => ({ number: index + 1, name, arabicName: surahData.arabicNames[index], ayahs: surahData.ayahs[index] }));
        allSurahs.sort((a, b) => (state.favoriteSurahs.includes(b.number) - state.favoriteSurahs.includes(a.number)));
        
        const surahListHTML = allSurahs.map(surah => { 
            const isFavorite = state.favoriteSurahs.includes(surah.number);
            const isCompleted = state.quranProgress.includes(surah.number);
            return `<div class="list-item">
                        <div class="item-number">${surah.number}</div>
                        <div class="item-details" data-surah-number="${surah.number}">
                            <p class="item-name-ar">${surah.arabicName}</p>
                            <p class="item-name-bn">${surah.name}</p>
                        </div>
                        <div class="item-info" style="display: flex; align-items: center; gap: 1rem; margin-left: auto;">
                            <i class="favorite-star ${isFavorite ? 'fas' : 'far'} fa-star" data-surah-number="${surah.number}"></i>
                            <input type="checkbox" class="quran-progress-checkbox" data-surah-number="${surah.number}" ${isCompleted ? 'checked' : ''} title="${t.markAsReadTitle}">
                        </div>
                    </div>`; 
        }).join('');

        const headerActionsHTML = state.bookmarkingEnabled ? `<div class="quran-header-actions"><button id="view-bookmarks-btn" class="btn btn-primary" style="width:100%;"><i class="fas fa-bookmark"></i> ${t.viewBookmarks}</button></div>` : '';
        const progressCardHTML = `
            <div class="card" id="quran-progress-card" style="margin-top: 15px;">
                <h3 data-translate-key="quranProgressTitle" style="text-align: center; margin-bottom: 0.5rem;">${t.quranProgressTitle}</h3>
                <div class="progress-container" style="margin: 10px 0;">
                    <div class="progress-bar" id="quran-progress-bar"></div>
                </div>
                <p class="progress-text" id="quran-progress-text">0%</p>
            </div>
        `;
        
        container.innerHTML = `${headerActionsHTML}${progressCardHTML}<div class="card" style="padding:0;">${surahListHTML}</div>`;
        
        // --- START: ব্যাক বাটন পরিবর্তন ---
        container.querySelectorAll('.item-details').forEach(item => {
            item.addEventListener('click', () => {
                const surahNumber = item.dataset.surahNumber;
                history.pushState({ tab: 'quran', view: 'surahDetail', data: { surahNumber } }, '', `#quran/surah/${surahNumber}`);
                loadSurahDetail(surahNumber);
            });
        });
        // --- END: ব্যাক বাটন পরিবর্তন ---

        container.querySelectorAll('.favorite-star').forEach(star => { star.addEventListener('click', (e) => { e.stopPropagation(); const surahNumber = parseInt(star.dataset.surahNumber, 10); const index = state.favoriteSurahs.indexOf(surahNumber); if (index > -1) state.favoriteSurahs.splice(index, 1); else state.favoriteSurahs.push(surahNumber); saveFavorites(); loadSurahList(); }); });
        
        container.querySelectorAll('.quran-progress-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                const surahNumber = parseInt(e.target.dataset.surahNumber, 10);
                if (e.target.checked) {
                    if (!state.quranProgress.includes(surahNumber)) state.quranProgress.push(surahNumber);
                } else {
                    const index = state.quranProgress.indexOf(surahNumber);
                    if (index > -1) state.quranProgress.splice(index, 1);
                }
                saveQuranProgress();
                updateQuranProgressDisplay();
            });
        });

        if (state.bookmarkingEnabled) {
            // --- START: ব্যাক বাটন পরিবর্তন ---
            document.getElementById('view-bookmarks-btn').addEventListener('click', () => {
                history.pushState({ tab: 'quran', view: 'bookmarks' }, '', '#quran/bookmarks');
                loadBookmarksView();
            });
            // --- END: ব্যাক বাটন পরিবর্তন ---
        }
        
        updateQuranProgressDisplay();
    };

    const loadSurahDetail = async (surahNumber) => {
        const container = document.getElementById('quran-tab');
        const t = translations[state.currentLang];
        const dbKey = `quran_detail_${surahNumber}_${state.currentLang}_${state.currentReciter}`;

        showLoader(container, t.loadingSurah);

        const cachedData = await getFromDB('quran', dbKey);
        if (cachedData) {
            renderSurahDetail(surahNumber, cachedData);
            return;
        }

        if (!navigator.onLine) {
            showError(container, t.noInternet);
            return;
        }

        try {
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/editions/quran-uthmani,${t.quranEdition},en.sahih,${state.currentReciter}`);
            if (!res.ok) throw new Error('API Error');
            const data = await res.json();
            if (data.code !== 200) throw new Error('API Error');

            await saveToDB('quran', dbKey, data.data); 
            renderSurahDetail(surahNumber, data.data);
        } catch(e) {
            console.error(e);
            showError(container, t.surahLoadError.replace('%s', surahNumber));
        }
    };
    
    const renderSurahDetail = (surahNumber, data) => {
        const container = document.getElementById('quran-tab');
        const t = translations[state.currentLang];
        const isBookmarked = (s, a) => state.bookmarks.some(bm => bm.surah == s && bm.ayah == a);

        const [arabicData, translationData, transliterationData, audioData] = data;
        
        const ayahsHTML = arabicData.ayahs.map((ayah, index) => { 
            const ayahNum = ayah.numberInSurah; 
            const bookmarkedClass = isBookmarked(surahNumber, ayahNum) ? 'fas bookmarked' : 'far'; 
            
            const arabicText = ayah.text.replace(/"/g, '&quot;');
            const translationText = translationData.ayahs[index].text.replace(/"/g, '&quot;');
            
            const bookmarkIconHTML = state.bookmarkingEnabled ? `<i class="bookmark-icon ${bookmarkedClass} fa-bookmark" data-surah="${surahNumber}" data-ayah="${ayahNum}"></i>` : ''; 
            const audioBtnHTML = state.audioEnabled ? `<button class="audio-play-btn" data-audio-src="${audioData.ayahs[index].audio}"><i class="fas fa-play"></i></button>` : ''; 
            
            const shareBtnHTML = `<i class="fas fa-share-alt share-btn" 
                                     data-type="quran"
                                     data-surah-name="${surahData.names[state.currentLang][surahNumber - 1]}"
                                     data-surah-num="${surahNumber}"
                                     data-ayah-num="${ayahNum}"
                                     data-arabic-text="${arabicText}"
                                     data-translation-text="${translationText}"
                                     title="Share"></i>`;
            
            const noteKey = getNoteKey('quran', surahNumber, ayahNum);
            const noteHTML = `
                <div class="personal-note-section">
                    <div class="note-display"></div>
                    <button class="toggle-note-btn"><i class="fas fa-pencil-alt"></i> ${t.addEditNote}</button>
                    <div class="note-editor" style="display: none;">
                        <textarea class="note-textarea" data-note-key="${noteKey}" placeholder="${t.notePlaceholder}"></textarea>
                    </div>
                </div>
            `;

            return `<div class="content-card" id="ayah-${ayahNum}">
                        <div style="position: absolute; top: 0.5rem; display: flex; gap: 0.5rem; align-items: center; left: 0.5rem; right: 0.5rem; justify-content: space-between;">
                            <div style="position:relative; width: 35px; height: 35px;">${bookmarkIconHTML}</div>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                ${shareBtnHTML}
                                <div style="position:relative; width: 35px; height: 35px;">${audioBtnHTML}</div>
                            </div>
                        </div>
                        <p class="arabic-text" style="padding-top: 2rem;">${ayah.text} ﴿${ayahNum}﴾</p>
                        <p class="transliteration-text">${transliterationData.ayahs[index].text}</p>
                        <p class="translation-text">${translationData.ayahs[index].text}</p>
                        ${noteHTML}
                    </div>`; 
        }).join('');
        
        container.innerHTML = `<div class="quran-header-actions" style="margin-top:15px;"><button id="back-to-surah-list" class="btn btn-primary" style="width:100%"><i class="fas fa-arrow-left"></i> ${t.backToSurahList}</button></div><h2 style="text-align:center; margin-bottom:1rem; color:var(--primary);">${arabicData.name} (${surahData.names[state.currentLang][surahNumber - 1]})</h2>${ayahsHTML}`;
        
// --- Auto Scroll Panel for Quran ---
    const scrollControlsHTML = `
        <div id="quran-auto-scroll-panel" class="auto-scroll-panel visible">
            <button class="scroll-btn" id="scroll-speed-down"><i class="fas fa-minus"></i></button>
            <span class="scroll-speed-display" id="scroll-speed-val">1x</span>
            <button class="scroll-btn" id="scroll-speed-up"><i class="fas fa-plus"></i></button>
            <div style="width:1px; height:20px; background:rgba(255,255,255,0.3); margin:0 5px;"></div>
            <button class="scroll-btn main-toggle" id="scroll-toggle-btn">
                <i class="fas fa-play"></i>
            </button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', scrollControlsHTML);

    // বাটনগুলোতে ক্লিক ইভেন্ট যোগ করা
    document.getElementById('scroll-toggle-btn').addEventListener('click', toggleAutoScroll);
    document.getElementById('scroll-speed-up').addEventListener('click', () => changeScrollSpeed(0.5));
    document.getElementById('scroll-speed-down').addEventListener('click', () => changeScrollSpeed(-0.5));
    
    // রিসেট
    state.autoScroll.speed = 1;
    stopAutoScroll();

    // ব্যাক বাটন চাপলে যেন স্ক্রল বন্ধ হয়
    const backBtn = document.getElementById('back-to-surah-list');
    // পুরনো লিসেনার থাকলে সেটা রিপ্লেস করার জন্য ক্লোন করা হলো (সেফটি)
    const newBackBtn = backBtn.cloneNode(true);
    backBtn.parentNode.replaceChild(newBackBtn, backBtn);
    
    newBackBtn.addEventListener('click', () => {
        stopAutoScroll();
        history.back();
    });




        // --- START: ব্যাক বাটন পরিবর্তন ---
        document.getElementById('back-to-surah-list').addEventListener('click', () => {
            history.back();
        });
        // --- END: ব্যাক বাটন পরিবর্তন ---

        if (state.bookmarkingEnabled) setupBookmarkListeners(container); 
        if (state.audioEnabled) setupAudioListeners(container);
        setupShareListeners(container);
        setupNoteEventListeners(container);
    };


    const setupBookmarkListeners = (container) => { container.querySelectorAll('.bookmark-icon').forEach(icon => { icon.addEventListener('click', () => { const surah = parseInt(icon.dataset.surah, 10); const ayah = parseInt(icon.dataset.ayah, 10); const bookmarkIndex = state.bookmarks.findIndex(bm => bm.surah === surah && bm.ayah === ayah); if (bookmarkIndex > -1) { state.bookmarks.splice(bookmarkIndex, 1); icon.classList.remove('fas', 'bookmarked'); icon.classList.add('far'); } else { state.bookmarks.push({ surah, ayah }); icon.classList.remove('far'); icon.classList.add('fas', 'bookmarked'); } saveBookmarks(); }); }); };
    const setupAudioListeners = (container) => { container.querySelectorAll('.audio-play-btn').forEach(btn => { btn.addEventListener('click', () => playAyahAudio(btn, btn.dataset.audioSrc)); }); };
    
    const setupShareListeners = (container) => {
        container.querySelectorAll('.share-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const target = e.currentTarget;
                const type = target.dataset.type;
                let shareData = {};

                if (type === 'quran') {
                    const surahName = target.dataset.surahName;
                    const surahNum = target.dataset.surahNum;
                    const ayahNum = target.dataset.ayahNum;
                    shareData = {
                        title: `Quran: ${surahName} (${surahNum}:${ayahNum})`,
                        text: `📖 ইসলামিক প্রো থেকে\n\nসূরা: ${surahName} (${surahNum}), আয়াত: ${ayahNum}\n\nআরবি:\n${target.dataset.arabicText}\n\nঅর্থ:\n${target.dataset.translationText}`,
                        url: window.location.href
                    };
                } else if (type === 'hadith') {
                    const bookName = target.dataset.bookName;
                    const hadithNum = target.dataset.hadithNum;
                    shareData = {
                        title: `Hadith: ${bookName} (${hadithNum})`,
                        text: `📜 ইসলামিক প্রো থেকে\n\nগ্রন্থ: ${bookName}, হাদিস: ${hadithNum}\n\nআরবি:\n${target.dataset.arabicText}\n\nঅর্থ:\n${target.dataset.translationText}`,
                        url: window.location.href
                    };
                }
                
                shareContent(shareData);
            });
        });
    };

    const playAyahAudio = (btn, audioSrc) => {
        if (state.currentlyPlayingBtn === btn) {
            if (state.currentlyPlayingAudio && !state.currentlyPlayingAudio.paused) {
                state.currentlyPlayingAudio.pause();
                btn.innerHTML = '<i class="fas fa-play"></i>';
            } else if (state.currentlyPlayingAudio) {
                state.currentlyPlayingAudio.play();
                btn.innerHTML = '<i class="fas fa-pause"></i>';
            }
            return;
        }

        stopAllAudio();

        btn.innerHTML = '<i class="fas fa-pause"></i>';
        const audio = new Audio(audioSrc);
        state.currentlyPlayingAudio = audio;
        state.currentlyPlayingBtn = btn;
        audio.play().catch(e => console.error("Single Ayah Play Error:", e));
        audio.addEventListener('ended', () => {
            btn.innerHTML = '<i class="fas fa-play"></i>';
            if (state.currentlyPlayingBtn === btn) {
                state.currentlyPlayingAudio = null;
                state.currentlyPlayingBtn = null;
            }
        });
    };
    
    const loadBookmarksView = async () => {
        const container = document.getElementById('quran-tab'); 
        const t = translations[state.currentLang]; 
        
        showLoader(container, t.loadingBookmarks);
        if (state.bookmarks.length === 0) { container.innerHTML = `<button id="back-to-surah-list" class="btn btn-primary" style="margin-top:15px; margin-bottom:1rem;"><i class="fas fa-arrow-left"></i> ${t.backToSurahList}</button><div class="card"><p style="text-align:center;">${t.noBookmarks}</p></div>`; document.getElementById('back-to-surah-list').addEventListener('click', () => history.back()); return; }
        try {
            const bookmarksBySurah = state.bookmarks.reduce((acc, bm) => { if (!acc[bm.surah]) acc[bm.surah] = []; acc[bm.surah].push(bm.ayah); return acc; }, {});
            let bookmarksHTML = '';
            for (const surahNum in bookmarksBySurah) {
                const dbKey = `quran_detail_${surahNum}_${state.currentLang}_${state.currentReciter}`;
                let surahEditions = await getFromDB('quran', dbKey);

                if (!surahEditions && navigator.onLine) {
                     const res = await fetch(`https://api.alquran.cloud/v1/surah/${surahNum}/editions/quran-uthmani,${t.quranEdition}`);
                     const data = await res.json();
                     if (data.code === 200) {
                         surahEditions = data.data;
                     }
                } else if (!surahEditions && !navigator.onLine) {
                    continue; 
                }

                if (surahEditions) {
                    const translationData = surahEditions.find(ed => ed.edition.identifier === t.quranEdition);
                    if (translationData) {
                        const surahName = translationData.name;
                        bookmarksBySurah[surahNum].forEach(ayahNum => {
                            const ayahData = translationData.ayahs.find(a => a.numberInSurah === ayahNum);
                            if (ayahData) {
                                bookmarksHTML += `<div class="bookmark-item"><p class="bookmark-info">${surahName} : ${ayahNum}</p><p class="bookmark-text">"${ayahData.text}"</p></div>`;
                            }
                        });
                    }
                }
            }
            container.innerHTML = `<button id="back-to-surah-list" class="btn btn-primary" style="margin-top:15px; margin-bottom:1rem;"><i class="fas fa-arrow-left"></i> ${t.backToSurahList}</button><h2 style="text-align:center; margin-bottom:1rem;">${t.bookmarksTitle}</h2><div class="card" style="padding:0;">${bookmarksHTML}</div>`; 
            // --- START: ব্যাক বাটন পরিবর্তন ---
            document.getElementById('back-to-surah-list').addEventListener('click', () => history.back());
            // --- END: ব্যাক বাটন পরিবর্তন ---
        } catch (error) { showError(container, t.error); }
    };
    
    const initAudioQuranTab = (container) => {
        const t = translations[state.currentLang];
        const playlistHTML = surahData.names[state.currentLang].map((name, index) => { const surahNumber = index + 1; return `<div class="list-item playlist-item" data-surah-number="${surahNumber}"><div class="item-number">${surahNumber}</div><div class="item-details"><p class="item-name-ar">${surahData.arabicNames[index]}</p><p class="item-name-bn">${name}</p></div></div>`; }).join('');
        container.innerHTML = `<div class="card" style="padding:0; margin-top: 15px;" id="audio-quran-playlist">${playlistHTML}</div>`;
        container.querySelectorAll('.playlist-item').forEach(item => { item.addEventListener('click', () => { const surahNumber = parseInt(item.dataset.surahNumber, 10); playFullSurah(surahNumber); }); });
    };
    
    const createAudioPlayer = () => {
         if (document.getElementById('audio-player-container')) return;
         
         const playerHTML = `
            <div class="audio-player-container" id="audio-player-container">
                <div class="audio-player-header" id="audio-player-header">
                     <p class="player-surah-name" id="player-surah-name">--</p>
                     <button id="audio-player-close-btn" title="Close Player"><i class="fas fa-times"></i></button>
                </div>
                <div class="player-body">
                    <div class="player-progress-bar-container" id="player-progress-container">
                        <div class="player-progress-bar" id="player-progress-bar"></div>
                    </div>
                    <div class="player-main">
                        <p class="player-time"><span id="player-current-time">0:00</span> / <span id="player-duration">0:00</span></p>
                        <div class="player-controls">
                            <button id="audio-player-prev-btn"><i class="fas fa-step-backward"></i></button>
                            <button id="audio-player-play-btn"><i class="fas fa-play"></i></button>
                            <button id="audio-player-next-btn"><i class="fas fa-step-forward"></i></button>
                        </div>
                    </div>
                </div>
            </div>`;

        DOMElements.audioPlayerPlaceholder.innerHTML = playerHTML;
        document.getElementById('audio-player-play-btn').addEventListener('click', togglePlayPauseFullSurah);
        document.getElementById('audio-player-next-btn').addEventListener('click', playNextFullSurah);
        document.getElementById('audio-player-prev-btn').addEventListener('click', playPrevFullSurah);
        document.getElementById('player-progress-container').addEventListener('click', seekFullSurah);
        document.getElementById('audio-player-close-btn').addEventListener('click', closeFullSurahPlayer);
        
        makePlayerDraggable();
    };

    const makePlayerDraggable = () => {
        const player = document.getElementById('audio-player-container');
        const header = document.getElementById('audio-player-header');
        const appContainer = DOMElements.appContainer;
        let isDragging = false;
        let offsetX, offsetY;

        const startDrag = (e) => {
            if (e.target.closest('#audio-player-close-btn')) return;
            isDragging = true;
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            offsetX = event.clientX - player.offsetLeft;
            offsetY = event.clientY - player.offsetTop;
            if (e.type === 'touchstart') e.preventDefault();
        };

        const drag = (e) => {
            if (!isDragging) return;
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            let newX = event.clientX - offsetX;
            let newY = event.clientY - offsetY;
            const max_X = appContainer.clientWidth - player.offsetWidth;
            const max_Y = appContainer.clientHeight - player.offsetHeight;
            newX = Math.max(0, Math.min(newX, max_X));
            newY = Math.max(0, Math.min(newY, max_Y));
            player.style.left = `${newX}px`;
            player.style.top = `${newY}px`;
        };

        const stopDrag = () => { isDragging = false;positionPrayerWidget(); };

        header.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', stopDrag);
        header.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('touchend', stopDrag);
    };

    const createPrayerWidget = () => {
        const t = translations[state.currentLang];
        const widgetHTML = `
            <div class="prayer-widget-container" id="prayer-widget-container">
                <div class="prayer-widget-header" id="prayer-widget-header">
                    <p>${t.nextPrayerLabel}</p>
                </div>
                <div class="prayer-widget-body" id="next-prayer-card">
                    <p><span id="next-prayer-name">--</span></p>
                    <h2 id="next-prayer-countdown">--:--:--</h2>
                    <p id="hijri-date"></p>
                </div>
            </div>`;
        
        DOMElements.prayerWidgetPlaceholder.innerHTML = widgetHTML;
    };

    const makePrayerWidgetDraggable = () => {
        const widget = document.getElementById('prayer-widget-container');
        const appContainer = DOMElements.appContainer;
        let isDragging = false;
        let offsetX, offsetY;

        const startDrag = (e) => {
            isDragging = true;
            const event = e.type === 'touchstart' ? e.touches[0] : e;
            offsetX = event.clientX - widget.offsetLeft;
            offsetY = event.clientY - widget.offsetTop;
            if (e.type === 'touchstart') e.preventDefault();
        };

        const drag = (e) => {
            if (!isDragging) return;
            const event = e.type === 'touchmove' ? e.touches[0] : e;
            let newX = event.clientX - offsetX;
            let newY = event.clientY - offsetY;
            const max_X = appContainer.clientWidth - widget.offsetWidth;
            const max_Y = appContainer.clientHeight - widget.offsetHeight;
            newX = Math.max(0, Math.min(newX, max_X));
            newY = Math.max(0, Math.min(newY, max_Y));
            widget.style.left = `${newX}px`;
            widget.style.top = `${newY}px`;
        };

        const stopDrag = () => { isDragging = false; };

        widget.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', stopDrag);
        widget.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('touchend', stopDrag);
    };

    const updateMediaSession = (surahNumber, surahName) => {
        if ('mediaSession' in navigator) {
            const reciterName = { 'ar.alafasy': 'Mishary Rashid Alafasy', 'ar.hudhaify': 'Ali Abdur-Rahman al-Hudhaify', 'ar.sudais': 'Abdur-Rahman as-Sudais' }[state.currentReciter] || 'Quran Recitation';
            navigator.mediaSession.metadata = new MediaMetadata({
                title: `সূরা ${surahName}`, artist: reciterName, album: 'ইসলামিক প্রো',
                artwork: [
                    { src: 'https://i.ibb.co/3cYg3jB/islamic-pro-logo-192.png', sizes: '192x192', type: 'image/png' },
                    { src: 'https://i.ibb.co/GvxYv14/islamic-pro-logo-512.png', sizes: '512x512', type: 'image/png' },
                ]
            });
            navigator.mediaSession.setActionHandler('play', () => { togglePlayPauseFullSurah(); });
            navigator.mediaSession.setActionHandler('pause', () => { togglePlayPauseFullSurah(); });
            navigator.mediaSession.setActionHandler('nexttrack', () => { playNextFullSurah(); });
            navigator.mediaSession.setActionHandler('previoustrack', () => { playPrevFullSurah(); });
        }
    };

    const closeFullSurahPlayer = () => {
        const playerContainer = document.getElementById('audio-player-container');
        if (playerContainer) {
            playerContainer.style.display = 'none';
        }
        if (state.audioPlayer.audio) {
            state.audioPlayer.audio.pause();
            state.audioPlayer.audio.src = ''; 
            state.audioPlayer.audio = null;
        }
        state.audioPlayer.isPlaying = false;
        state.audioPlayer.currentSurahNumber = null;
        state.audioPlayer.latestRequestedSurah = null;
        if ('mediaSession' in navigator) {
            navigator.mediaSession.playbackState = 'none';
            navigator.mediaSession.metadata = null;
        }
        const activeItem = document.querySelector('#audio-quran-playlist .list-item.active');
        if (activeItem) {
            activeItem.classList.remove('active');
        }
    };
    
    const playFullSurah = (surahNumber) => {
        stopAllAudio();
        state.audioPlayer.latestRequestedSurah = surahNumber;

        const playerContainer = document.getElementById('audio-player-container');
        if (!navigator.onLine) {
            alert(translations[state.currentLang].noInternet);
            return;
        }

        if (playerContainer.style.display !== 'block') {
            playerContainer.style.display = 'block';
        }
        
        const playBtn = document.getElementById('audio-player-play-btn');
        const surahNameEl = document.getElementById('player-surah-name');
        surahNameEl.textContent = translations[state.currentLang].loadingAudio;
        playBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        playBtn.disabled = true;
        document.getElementById('player-progress-bar').style.width = '0%'; document.getElementById('player-current-time').textContent = '0:00'; document.getElementById('player-duration').textContent = '0:00';
        state.audioPlayer.currentSurahNumber = surahNumber;
        const paddedSurahNumber = String(surahNumber).padStart(3, '0');
        const reciterUrlMap = { 'ar.alafasy': 'afs', 'ar.hudhaify': 'hthfi', 'ar.sudais': 'sds' };
        const reciterUrlPath = reciterUrlMap[state.currentReciter] || 'afs';
        const finalAudioUrl = `https://server8.mp3quran.net/${reciterUrlPath}/${paddedSurahNumber}.mp3`;
        
        if (state.audioPlayer.audio) {
            state.audioPlayer.audio.pause();
            state.audioPlayer.audio.src = '';
            state.audioPlayer.audio.load();
        }

        state.audioPlayer.audio = new Audio(finalAudioUrl);
        const audio = state.audioPlayer.audio;

        audio.addEventListener('canplay', () => {
            if (state.audioPlayer.latestRequestedSurah !== surahNumber) {
                audio.src = '';
                audio.load();
                return; 
            }

            audio.play().catch(e => console.error("Full Surah Play Error:", e));
            state.audioPlayer.isPlaying = true;
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            playBtn.disabled = false;
            updatePlayerInfo(surahNumber);
            updateMediaSession(surahNumber, surahData.names[state.currentLang][surahNumber - 1]);
        });
        audio.addEventListener('error', (e) => {
            if (state.audioPlayer.latestRequestedSurah !== surahNumber) return;
            console.error('Audio Loading Error:', e);
            surahNameEl.textContent = translations[state.currentLang].audioLoadError;
            playBtn.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
            playBtn.disabled = true;
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'none';
        });
        audio.addEventListener('timeupdate', updateFullSurahProgress);
        audio.addEventListener('ended', () => {
            if (state.autoClosePlayer) {
                closeFullSurahPlayer();
            } else {
                playNextFullSurah();
            }
        });
    };

    const togglePlayPauseFullSurah = () => {
        const { audio, isPlaying } = state.audioPlayer;
        if (!audio || audio.error) return;
        if (isPlaying) {
            audio.pause();
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'paused';
        } else {
            audio.play();
            if ('mediaSession' in navigator) navigator.mediaSession.playbackState = 'playing';
        }
        state.audioPlayer.isPlaying = !isPlaying;
        document.getElementById('audio-player-play-btn').innerHTML = isPlaying ? '<i class="fas fa-play"></i>' : '<i class="fas fa-pause"></i>';
    };

    const playNextFullSurah = () => { let nextSurah = (state.audioPlayer.currentSurahNumber || 0) + 1; if (nextSurah > 114) nextSurah = 1; playFullSurah(nextSurah); };
    const playPrevFullSurah = () => { let prevSurah = (state.audioPlayer.currentSurahNumber || 2) - 1; if (prevSurah < 1) prevSurah = 114; playFullSurah(prevSurah); };

    const updatePlayerInfo = (surahNumber) => {
        const surahName = surahData.names[state.currentLang][surahNumber - 1];
        document.getElementById('player-surah-name').textContent = `${surahNumber}. ${surahName}`;
        const playlistItems = document.querySelectorAll('#audio-quran-playlist .playlist-item');
        playlistItems.forEach(item => {
            const isActive = parseInt(item.dataset.surahNumber) === surahNumber;
            item.classList.toggle('active', isActive);
            if (isActive) {
                item.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    };
    
    const formatPlayerTime = (seconds) => { if(isNaN(seconds)) return "0:00"; const min = Math.floor(seconds / 60); const sec = Math.floor(seconds % 60).toString().padStart(2, '0'); return `${min}:${sec}`; };
    const updateFullSurahProgress = () => { const { audio } = state.audioPlayer; if (!audio || !audio.duration) return; const progressPercent = (audio.currentTime / audio.duration) * 100; document.getElementById('player-progress-bar').style.width = `${progressPercent}%`; document.getElementById('player-current-time').textContent = formatPlayerTime(audio.currentTime); document.getElementById('player-duration').textContent = formatPlayerTime(audio.duration); };
    const seekFullSurah = (e) => { const { audio } = state.audioPlayer; if (!audio || isNaN(audio.duration)) return; const progressContainer = document.getElementById('player-progress-container'); const width = progressContainer.clientWidth; const clickX = e.offsetX; const duration = audio.duration; audio.currentTime = (clickX / width) * duration; };

    const loadDailyAmalCategories = () => {
        const t = translations[state.currentLang];
        const container = document.getElementById('amal-tab');
        container.innerHTML = `<div style="margin-top:15px;"><h2 style="text-align:center; margin-bottom:1rem; color:var(--primary);">${t.dailyAmalTitle}</h2><div class="card" style="padding:0;"><div class="list-item" data-amal-category="hadiths"><div class="item-number"><i class="fas fa-book-bookmark"></i></div><div class="item-details"><p class="item-name-bn">${t.selectedHadiths}</p></div></div><div class="list-item" data-amal-category="duas"><div class="item-number"><i class="fas fa-praying-hands"></i></div><div class="item-details"><p class="item-name-bn">${t.essentialDuas}</p></div></div><div class="list-item" data-amal-category="asmaulHusna"><div class="item-number"><i class="fas fa-star-of-david"></i></div><div class="item-details"><p class="item-name-bn">${t.asmaulHusna}</p></div></div><div class="list-item" data-amal-category="zakat"><div class="item-number"><i class="fas fa-calculator"></i></div><div class="item-details"><p class="item-name-bn">${t.zakatCalculator}</p></div></div></div></div>`;
        
        // --- START: ব্যাক বাটন পরিবর্তন ---
        container.querySelectorAll('.list-item').forEach(item => {
            item.addEventListener('click', () => {
                const category = item.dataset.amalCategory;
                history.pushState({ tab: 'amal', view: 'amalDetail', data: { category } }, '', `#amal/${category}`);
                loadDailyAmalDetail(category);
            });
        });
        // --- END: ব্যাক বাটন পরিবর্তন ---
    };
    
    const loadDailyAmalDetail = (category) => {
        const container = document.getElementById('amal-tab'); let contentHTML = ''; let title = '';
        const t = translations[state.currentLang];
        if (category === 'hadiths') { title = t.selectedHadiths; contentHTML = dailyAmalData.hadiths.map((hadith, index) => `<div class="content-card"><p style="font-weight:600; color: var(--primary); margin-bottom: 1rem;">${t.hadith} ${index + 1}</p><p class="arabic-text">${hadith.arab}</p><p class="transliteration-text">${hadith.bn_pron}</p><p class="translation-text">${hadith[state.currentLang] || hadith.bn}</p><p class="reference-text">${hadith.ref}</p></div>`).join(''); } 
        else if (category === 'duas') { title = t.essentialDuas; contentHTML = dailyAmalData.duas.map((dua, index) => `<div class="content-card" style="padding-top:1rem;"><h3 style="color:var(--primary); margin-bottom: 1rem;">${index + 1}. ${dua.title[state.currentLang]}</h3><p class="arabic-text" style="font-size: 1.5rem; line-height: 2.5rem;">${dua.arab}</p><p class="transliteration-text">${dua.bn_pron}</p><p class="translation-text">${dua[state.currentLang] || dua.bn}</p></div>`).join(''); } 
        else if (category === 'asmaulHusna') { title = t.asmaulHusna; contentHTML = dailyAmalData.asmaulHusna.map((name, index) => `<div class="list-item" style="cursor: default; padding: 0.8rem 1rem;"><div class="item-number">${index + 1}</div><div class="item-details"><p class="item-name-ar" style="text-align: left; margin-bottom: 2px;">${name.name}</p><p class="transliteration-text" style="text-align: left; margin-top: 4px; font-style: normal;">${name.bn_pron}</p><p class="item-name-bn" style="font-size: calc(0.95rem * var(--font-size-multiplier)); color: var(--text-secondary); margin-top: 4px;">${name.meaning[state.currentLang]}</p></div></div>`).join(''); contentHTML = `<div class="card" style="padding:0;">${contentHTML}</div>`; }
        else if (category === 'zakat') { initZakatCalculator(container); return; }
        container.innerHTML = `<div style="margin-top:15px;"><button id="back-to-amal-categories" class="btn btn-primary" style="margin-bottom:1rem;"><i class="fas fa-arrow-left"></i> ${t.back}</button><h2 style="text-align:center; margin-bottom:1rem; color:var(--primary);">${title}</h2>${contentHTML}</div>`;
        
        // --- START: ব্যাক বাটন পরিবর্তন ---
        document.getElementById('back-to-amal-categories').addEventListener('click', () => {
            history.back();
        });
        // --- END: ব্যাক বাটন পরিবর্তন ---
    };
    
    const initZakatCalculator = (container) => {
        const t = translations[state.currentLang];
        
        const SILVER_PRICE_PER_GRAM = 150; 
        const SILVER_NISAB_GRAMS = 612.36; 
        const ZAKAT_RATE = 0.025;
        
        const silverNisabValue = SILVER_NISAB_GRAMS * SILVER_PRICE_PER_GRAM;
        const numberLocale = state.currentLang === 'bn' ? 'bn-BD' : 'en-US';

        container.innerHTML = `
             <div style="margin-top:15px;">
                <button id="back-to-amal-categories" class="btn btn-primary" style="margin-bottom:1rem; width:100%;">
                    <i class="fas fa-arrow-left"></i> ${t.back}
                </button>
                <h2 style="text-align:center; margin-bottom:1rem; color:var(--primary);">${t.zakatCalculator}</h2>
                
                <div class="card">
                    <div class="info-note" style="margin-bottom: 1rem;">
                       ${t.marketPriceNote} <br>
                       (Nisab approx: <strong>${silverNisabValue.toLocaleString(numberLocale)} Taka</strong>)
                    </div>
                    <div id="zakat-form">
                        <div class="zakat-form-item"><label for="cash">${t.totalCash}</label><input type="number" id="cash" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="gold-value">${t.goldValue}</label><input type="number" id="gold-value" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="silver-value">${t.silverValue}</label><input type="number" id="silver-value" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="business-assets">${t.businessAssets}</label><input type="number" id="business-assets" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="savings">${t.savingsDeposits}</label><input type="number" id="savings" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="property-income">${t.propertyIncome}</label><input type="number" id="property-income" placeholder="0"></div>
                        <div class="zakat-form-item"><label for="liabilities" style="color: var(--danger);">${t.totalLiabilities}</label><input type="number" id="liabilities" placeholder="0"></div>
                        <button id="calculate-zakat-btn" class="btn btn-primary" style="width:100%; margin-top:1rem;">${t.calculateZakat}</button>
                    </div>
                </div>
                <div id="zakat-result-container"></div>
            </div>
        `;

        // --- START: ব্যাক বাটন পরিবর্তন ---
        document.getElementById('back-to-amal-categories').addEventListener('click', () => {
            history.back();
        });
        // --- END: ব্যাক বাটন পরিবর্তন ---

        document.getElementById('calculate-zakat-btn').addEventListener('click', () => {
            const cash = parseFloat(document.getElementById('cash').value) || 0;
            const goldValue = parseFloat(document.getElementById('gold-value').value) || 0;
            const silverValue = parseFloat(document.getElementById('silver-value').value) || 0;
            const businessAssets = parseFloat(document.getElementById('business-assets').value) || 0;
            const savings = parseFloat(document.getElementById('savings').value) || 0;
            const propertyIncome = parseFloat(document.getElementById('property-income').value) || 0;
            const liabilities = parseFloat(document.getElementById('liabilities').value) || 0;
            
            const totalAssets = cash + goldValue + silverValue + businessAssets + savings + propertyIncome;
            const netAssets = totalAssets - liabilities;

            const resultContainer = document.getElementById('zakat-result-container');
            let resultHTML = '';
            
            if (netAssets >= silverNisabValue) {
                const payableZakat = netAssets * ZAKAT_RATE;
                resultHTML = `
                    <div class="card zakat-result-card">
                         <h3>${t.calculationSummary}</h3>
                         <div class="zakat-result-item"><span>${t.totalAssets}</span><span>${totalAssets.toLocaleString(numberLocale)}</span></div>
                         <div class="zakat-result-item"><span>(-) ${t.totalLiabilities}</span><span>${liabilities.toLocaleString(numberLocale)}</span></div>
                          <div class="zakat-result-item" style="font-weight: bold;"><span>${t.netAssets}</span><span>${netAssets.toLocaleString(numberLocale)}</span></div>
                         <div class="zakat-result-item"><span>${t.nisabThreshold}</span><span>${silverNisabValue.toLocaleString(numberLocale)}</span></div>
                         <div class="zakat-result-item payable"><span>${t.payableZakat} (2.5%)</span><span>${payableZakat.toLocaleString(numberLocale)}</span></div>
                    </div>`;
            } else {
                 resultHTML = `
                    <div class="card zakat-result-card">
                         <h3>${t.calculationSummary}</h3>
                          <div class="zakat-result-item"><span>${t.netAssets}</span><span>${netAssets.toLocaleString(numberLocale)}</span></div>
                         <div class="zakat-result-item"><span>${t.nisabThreshold}</span><span>${silverNisabValue.toLocaleString(numberLocale)}</span></div>
                         <div class="info-note" style="margin-top:1rem; background-color: var(--danger); color: white; border-left-color: #fff; text-align: center;">${t.zakatNotApplicable}</div>
                    </div>`;
            }
            resultContainer.innerHTML = resultHTML;
        });
    };

    const initTasbih = () => {
        const container = document.getElementById('tasbih-tab'); const t = translations[state.currentLang]; const dhikrList = { bn: ['সুবহানাল্লাহ', 'আলহামদুলিল্লাহ', 'আল্লাহু আকবার', 'লা ইলাহা ইল্লাল্লাহ', 'আসতাগফিরুল্লাহ', 'সুবহানাল্লাহি ওয়া বিহামদিহি', 'লা হাওলা ওয়ালা কুওয়াতা ইল্লা বিল্লাহ', 'লা ইলাহা ইল্লাল্লাহু মুহাম্মাদুর রাসুলুল্লাহ'], en: ['SubhanAllah', 'Alhamdulillah', 'Allahu Akbar', 'La ilaha illallah', 'Astaghfirullah', 'Subhanallahi wa bihamdihi', 'La hawla wa la quwwata illa billah', 'La ilaha illallahu Muhammadur Rasulullah'], hi: ['सुभानअल्लाह', 'अल्हम्दुलिल्लाह', 'अल्लाहु अकबर', 'ला इलाहा इल्लल्लाह', 'अस्तग़फिरुल्लाह', 'सुब्हानल्लाही वा बिहम्दिही', 'ला हौला वला कुव्वता इल्ला बिल्लाह', 'ला इलाहा इल्लल्लाहु मुहम्मदुर रसूलुल्लाह'], ur: ['سبحان الله', 'الحمد لله', 'الله أكبر', 'لا إله إلا الله', 'أستغفر الله', 'سبحان الله وبحمده', 'لا حول ولا قوة إلا بالله', 'لا إله إلا الله محمد رسول الله'] }; const dhikrListLang = dhikrList[state.currentLang]; let count = 0, dhikrIndex = 0; container.innerHTML = `<div class="tasbih-container" style="margin-top:15px;"><div class="tasbih-display"><svg class="tasbih-progress-ring" width="220" height="220"><circle stroke="${getComputedStyle(document.documentElement).getPropertyValue('--border-color')}" stroke-width="10" fill="transparent" r="100" cx="110" cy="110"/><circle id="tasbih-progress" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--primary')}" stroke-width="10" stroke-linecap="round" fill="transparent" r="100" cx="110" cy="110"/></svg><div class="tasbih-bead"><div id="tasbih-count" class="tasbih-count">0</div></div></div><div style="display: flex; align-items: center; justify-content: center; gap: 1rem; width: 100%; max-width: 320px; margin: 0 auto;"><button id="prev-dhikr-btn" class="tasbih-reset-btn" style="width: 45px; height: 45px; font-size: 1rem; flex-shrink: 0;" title="${t.previous}"><i class="fas fa-chevron-left"></i></button><div id="tasbih-dhikr" class="tasbih-dhikr-text" style="flex-grow: 1;"></div><button id="next-dhikr-btn" class="tasbih-reset-btn" style="width: 45px; height: 45px; font-size: 1rem; flex-shrink: 0;" title="${t.next}"><i class="fas fa-chevron-right"></i></button></div><div class="tasbih-controls"><button id="tasbih-reset" class="tasbih-reset-btn" title="${t.reset}"><i class="fas fa-redo"></i></button></div></div>`; const countEl = document.getElementById('tasbih-count'), beadEl = container.querySelector('.tasbih-bead'), dhikrEl = document.getElementById('tasbih-dhikr'), progressCircle = document.getElementById('tasbih-progress'), radius = progressCircle.r.baseVal.value, circumference = radius * 2 * Math.PI; progressCircle.style.strokeDasharray = `${circumference} ${circumference}`; progressCircle.style.strokeDashoffset = circumference; const setProgress = p => progressCircle.style.strokeDashoffset = circumference - (p / 100) * circumference; const updateTasbih = () => { countEl.textContent = count; dhikrEl.textContent = dhikrListLang[dhikrIndex]; setProgress((count / 33) * 100); }; beadEl.addEventListener('click', () => { count++; if (count > 33) { count = 1; dhikrIndex = (dhikrIndex + 1) % dhikrListLang.length; } updateTasbih(); if (navigator.vibrate) navigator.vibrate(50); }); container.querySelector('#tasbih-reset').addEventListener('click', () => { count = 0; dhikrIndex = 0; updateTasbih(); }); container.querySelector('#prev-dhikr-btn').addEventListener('click', () => { dhikrIndex = (dhikrIndex - 1 + dhikrListLang.length) % dhikrListLang.length; count = 0; updateTasbih(); }); container.querySelector('#next-dhikr-btn').addEventListener('click', () => { dhikrIndex = (dhikrIndex + 1) % dhikrListLang.length; count = 0; updateTasbih(); }); updateTasbih();
    };

    const initHadithTab = (container) => {
        const t = translations[state.currentLang];
        let fullHadithList = [];
        let filteredHadithList = [];
        let currentHadithPage = 1;
        const hadithsPerPage = 20;
        let currentSearchTerm = '';
        
        const isHadithBookmarked = (book, number) => state.hadithBookmarks.some(bm => bm.book === book && bm.number === number);

        const setupHadithBookmarkListeners = (container) => {
            container.querySelectorAll('.hadith-card .bookmark-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const book = icon.dataset.book;
                    const number = parseInt(icon.dataset.hadithNumber, 10);
                    const bookmarkIndex = state.hadithBookmarks.findIndex(bm => bm.book === book && bm.number === number);
                    if (bookmarkIndex > -1) {
                        state.hadithBookmarks.splice(bookmarkIndex, 1);
                        icon.classList.remove('fas', 'bookmarked');
                        icon.classList.add('far');
                    } else {
                        state.hadithBookmarks.push({ book, number });
                        icon.classList.remove('far');
                        icon.classList.add('fas', 'bookmarked');
                    }
                    saveHadithBookmarks();
                });
            });
        };

        const renderBookSelection = () => {
            const bookmarkBtnHTML = state.bookmarkingEnabled ? `<button id="view-hadith-bookmarks-btn" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;"><i class="fas fa-bookmark"></i> ${t.viewHadithBookmarks}</button>` : '';
            const bookCardsHTML = hadithBookData.map(book => `
                <div class="hadith-book-select-card" data-book-key="${book.key}">
                    <i class="fas fa-book-open"></i>
                    <div>
                        <h3>${book.names[state.currentLang] || book.names['en']}</h3>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">${book.subtext}</p>
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div style="margin-top:15px;">
                    <h2 style="text-align:center; color:var(--primary); margin-bottom: 1rem;" data-translate-key="hadithCollectionTitle">${t.hadithCollectionTitle}</h2>
                    ${bookmarkBtnHTML}
                    ${bookCardsHTML}
                </div>
            `;
            
            // --- START: ব্যাক বাটন পরিবর্তন ---
            container.querySelectorAll('.hadith-book-select-card').forEach(card => {
                card.addEventListener('click', () => {
                    const bookKey = card.dataset.bookKey;
                    history.pushState({ tab: 'hadith', view: 'hadithList', data: { bookKey } }, '', `#hadith/${bookKey}`);
                    loadHadithList(bookKey);
                });
            });
            if (state.bookmarkingEnabled) {
                document.getElementById('view-hadith-bookmarks-btn').addEventListener('click', () => {
                     history.pushState({ tab: 'hadith', view: 'hadithBookmarks' }, '', '#hadith/bookmarks');
                     loadHadithBookmarksView();
                });
            }
            // --- END: ব্যাক বাটন পরিবর্তন ---
        };

        const displayHadithPage = (bookTitle, bookKey) => {
            const totalPages = Math.ceil(filteredHadithList.length / hadithsPerPage);
            if (currentHadithPage > totalPages) currentHadithPage = 1;

            const startIndex = (currentHadithPage - 1) * hadithsPerPage;
            const endIndex = startIndex + hadithsPerPage;
            const paginatedHadiths = filteredHadithList.slice(startIndex, endIndex);

            const hadithCardsHTML = paginatedHadiths.map(h => {
                const isBookmarkedVal = isHadithBookmarked(bookKey, h.number);
                const bookmarkedClass = isBookmarkedVal ? 'fas bookmarked' : 'far';
                
                const bookmarkIconHTML = state.bookmarkingEnabled ? `<i class="bookmark-icon ${bookmarkedClass} fa-bookmark" data-book="${bookKey}" data-hadith-number="${h.number}" title="Bookmark"></i>` : '';

                const arabicText = h.arabic.replace(/"/g, '&quot;');
                const translationText = h.translation.replace(/"/g, '&quot;');

                const shareBtnHTML = `<i class="fas fa-share-alt share-btn"
                                         data-type="hadith"
                                         data-book-name="${bookTitle}"
                                         data-hadith-num="${h.number}"
                                         data-arabic-text="${arabicText}"
                                         data-translation-text="${translationText}"
                                         title="Share"></i>`;

                const noteKey = getNoteKey('hadith', bookKey, h.number);
                const noteHTML = `
                    <div class="personal-note-section">
                        <div class="note-display"></div>
                        <button class="toggle-note-btn"><i class="fas fa-pencil-alt"></i> ${t.addEditNote}</button>
                        <div class="note-editor" style="display: none;">
                            <textarea class="note-textarea" data-note-key="${noteKey}" placeholder="${t.notePlaceholder}"></textarea>
                        </div>
                    </div>
                `;

                return `<div class="hadith-card">
                    ${bookmarkIconHTML}
                    ${shareBtnHTML}
                    <p class="reference-text">${t.hadith}: ${h.number}</p>
                    <p class="arabic-text">${h.arabic}</p>
                    <p class="translation-text">${h.translation}</p>
                    ${noteHTML}
                </div>`;
            }).join('');
            
            const paginationHTML = `
                <div class="pagination-controls">
                    <button id="hadith-prev-btn" class="btn btn-primary" ${currentHadithPage <= 1 ? 'disabled' : ''}>
                        <i class="fas fa-arrow-left"></i> ${t.previous}
                    </button>
                    <span class="page-info">${totalPages > 0 ? currentHadithPage : 0} / ${totalPages}</span>
                    <button id="hadith-next-btn" class="btn btn-primary" ${currentHadithPage >= totalPages || totalPages === 0 ? 'disabled' : ''}>
                        ${t.next} <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            `;

            container.innerHTML = `
                <div class="hadith-list-view" style="margin-top: 15px;">
                    <button id="back-to-hadith-books" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-arrow-left"></i> ${t.back}
                    </button>
                     <h2 style="text-align:center; color:var(--primary); margin-bottom: 1rem;">${bookTitle}</h2>
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="search" id="hadith-search-input" placeholder="${t.searchHadithPlaceholder}" value="${currentSearchTerm}">
                    </div>
                    <div id="hadith-list-container">${hadithCardsHTML.length > 0 ? hadithCardsHTML : `<div class="card"><p style="text-align:center;">কোনো ফলাফল পাওয়া যায়নি।</p></div>`}</div>
                    ${paginationHTML}
                </div>
            `;

// --- Auto Scroll Panel for Hadith ---
    // সেইম HTML ব্যবহার করা হচ্ছে
    const scrollControlsHTML = `
        <div id="quran-auto-scroll-panel" class="auto-scroll-panel visible">
            <button class="scroll-btn" id="scroll-speed-down"><i class="fas fa-minus"></i></button>
            <span class="scroll-speed-display" id="scroll-speed-val">1x</span>
            <button class="scroll-btn" id="scroll-speed-up"><i class="fas fa-plus"></i></button>
            <div style="width:1px; height:20px; background:rgba(255,255,255,0.3); margin:0 5px;"></div>
            <button class="scroll-btn main-toggle" id="scroll-toggle-btn">
                <i class="fas fa-play"></i>
            </button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', scrollControlsHTML);

    document.getElementById('scroll-toggle-btn').addEventListener('click', toggleAutoScroll);
    document.getElementById('scroll-speed-up').addEventListener('click', () => changeScrollSpeed(0.5));
    document.getElementById('scroll-speed-down').addEventListener('click', () => changeScrollSpeed(-0.5));
    
    state.autoScroll.speed = 1;
    stopAutoScroll();

    // ব্যাক বাটন ফিক্স
    const backBtn = document.getElementById('back-to-hadith-books');
    const newBackBtn = backBtn.cloneNode(true);
    backBtn.parentNode.replaceChild(newBackBtn, backBtn);

    newBackBtn.addEventListener('click', () => {
        stopAutoScroll();
        history.back();
    });
            
            // --- START: ব্যাক বাটন পরিবর্তন ---
            document.getElementById('back-to-hadith-books').addEventListener('click', () => history.back());
            // --- END: ব্যাক বাটন পরিবর্তন ---
            
            const searchInput = document.getElementById('hadith-search-input');
            searchInput.addEventListener('input', (e) => handleHadithSearch(e, bookTitle, bookKey));
            
            const searchValLength = searchInput.value.length;
            searchInput.focus();
            searchInput.setSelectionRange(searchValLength, searchValLength);

            document.getElementById('hadith-prev-btn').addEventListener('click', () => { if (currentHadithPage > 1) { currentHadithPage--; displayHadithPage(bookTitle, bookKey); } });
            document.getElementById('hadith-next-btn').addEventListener('click', () => { if (currentHadithPage < totalPages) { currentHadithPage++; displayHadithPage(bookTitle, bookKey); } });
            
            if (state.bookmarkingEnabled) {
                setupHadithBookmarkListeners(container);
            }
            setupShareListeners(container);
            setupNoteEventListeners(document.getElementById('hadith-list-container'));
        };

        const handleHadithSearch = (e, bookTitle, bookKey) => {
            currentSearchTerm = e.target.value.toLowerCase().trim();
            if (currentSearchTerm === "") {
                filteredHadithList = [...fullHadithList];
            } else {
                filteredHadithList = fullHadithList.filter(h => 
                    h.translation.toLowerCase().includes(currentSearchTerm) || 
                    String(h.number).includes(currentSearchTerm)
                );
            }
            currentHadithPage = 1;
            displayHadithPage(bookTitle, bookKey);
        };

        async function fetchWithProgress(url, onProgress) {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const reader = response.body.getReader();
            const contentLength = +response.headers.get('Content-Length');
            let receivedLength = 0;
            let chunks = [];
            while(true) {
                const {done, value} = await reader.read();
                if (done) break;
                chunks.push(value);
                receivedLength += value.length;
                if (contentLength) {
                    onProgress(receivedLength / contentLength);
                }
            }
            let chunksAll = new Uint8Array(receivedLength);
            let position = 0;
            for(let chunk of chunks) {
                chunksAll.set(chunk, position);
                position += chunk.length;
            }
            const result = new TextDecoder("utf-8").decode(chunksAll);
            return JSON.parse(result);
        }

        const loadHadithList = async (bookKey) => {
            const benLang = state.currentLang === 'hi' ? 'hin' : (state.currentLang === 'en' ? 'eng' : (state.currentLang === 'ur' ? 'urd' : 'ben'));
            const dbKey = `hadith_${bookKey}_${benLang}`;
            
            const cachedHadiths = await getFromDB('hadith', dbKey);
            if (cachedHadiths) {
                fullHadithList = cachedHadiths.hadiths;
                filteredHadithList = [...fullHadithList];
                currentHadithPage = 1;
                currentSearchTerm = '';
                displayHadithPage(cachedHadiths.bookName, bookKey);
                return;
            }
            
            if (!navigator.onLine) {
                showError(container, t.noInternet);
                return;
            }

            container.innerHTML = `
                <div style="margin-top: 15px; text-align: center; padding: 2rem;">
                    <p>${t.loadingHadiths}</p>
                    <div class="progress-container">
                        <div class="progress-bar" id="hadith-progress-bar"></div>
                    </div>
                    <p class="progress-text" id="hadith-progress-text">0%</p>
                </div>
            `;
            
            const progressBar = document.getElementById('hadith-progress-bar');
            const progressText = document.getElementById('hadith-progress-text');
            
            try {
                const araUrl = `https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/ara-${bookKey}.json`;
                const transUrl = `https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/${benLang}-${bookKey}.json`;
                
                let araProgress = 0, transProgress = 0;
                const updateCombinedProgress = () => {
                    const totalProgress = (araProgress + transProgress) / 2;
                    progressBar.style.width = `${totalProgress * 100}%`;
                    progressText.textContent = `${Math.round(totalProgress * 100)}%`;
                };

                const [araData, transData] = await Promise.all([
                    fetchWithProgress(araUrl, (progress) => { araProgress = progress; updateCombinedProgress(); }),
                    fetchWithProgress(transUrl, (progress) => { transProgress = progress; updateCombinedProgress(); })
                ]);

                fullHadithList = transData.hadiths.map(transHadith => {
                    const araHadith = araData.hadiths.find(h => h.hadithnumber === transHadith.hadithnumber);
                    return {
                        number: transHadith.hadithnumber,
                        arabic: araHadith ? araHadith.text : "N/A",
                        translation: transHadith.text
                    };
                });
                
                const dataToCache = { bookName: transData.metadata.name, hadiths: fullHadithList };
                await saveToDB('hadith', dbKey, dataToCache);

                filteredHadithList = [...fullHadithList];
                currentHadithPage = 1;
                currentSearchTerm = '';
                displayHadithPage(transData.metadata.name, bookKey);

            } catch (error) {
                console.error("Failed to load hadiths:", error);
                showError(container, t.hadithLoadError);
                setTimeout(renderBookSelection, 2000);
            }
        };
        
        const loadHadithBookmarksView = async () => {
            const t = translations[state.currentLang];
            showLoader(container, t.loadingHadithBookmarks);

            if (state.hadithBookmarks.length === 0) {
                container.innerHTML = `<button id="back-to-hadith-books" class="btn btn-primary" style="margin-top:15px; margin-bottom:1rem;"><i class="fas fa-arrow-left"></i> ${t.back}</button><div class="card"><p style="text-align:center;">${t.noHadithBookmarks}</p></div>`;
                document.getElementById('back-to-hadith-books').addEventListener('click', () => history.back());
                return;
            }

            try {
                const bookmarksByBook = state.hadithBookmarks.reduce((acc, bm) => {
                    if (!acc[bm.book]) acc[bm.book] = [];
                    acc[bm.book].push(bm.number);
                    return acc;
                }, {});

                let bookmarksHTML = '';

                for (const bookKey in bookmarksByBook) {
                    const benLang = state.currentLang === 'hi' ? 'hin' : (state.currentLang === 'en' ? 'eng' : (state.currentLang === 'ur' ? 'urd' : 'ben'));
                    const dbKey = `hadith_${bookKey}_${benLang}`;
                    let cachedData = await getFromDB('hadith', dbKey);
                    
                    if (!cachedData && navigator.onLine) {
                        const araUrl = `https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/ara-${bookKey}.json`;
                        const transUrl = `https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1/editions/${benLang}-${bookKey}.json`;
                        const [araData, transData] = await Promise.all([fetch(araUrl).then(res => res.json()), fetch(transUrl).then(res => res.json())]);
                        const hadiths = transData.hadiths.map(transHadith => {
                            const araHadith = araData.hadiths.find(h => h.hadithnumber === transHadith.hadithnumber);
                            return { number: transHadith.hadithnumber, arabic: araHadith ? araHadith.text : "N/A", translation: transHadith.text };
                        });
                        cachedData = { bookName: transData.metadata.name, hadiths: hadiths };
                        await saveToDB('hadith', dbKey, cachedData);
                    }

                    if (cachedData) {
                        const bookName = cachedData.bookName;
                        const bookmarkedNumbers = bookmarksByBook[bookKey];

                        bookmarkedNumbers.forEach(number => {
                            const hadith = cachedData.hadiths.find(h => h.number === number);
                            if (hadith) {
                                bookmarksHTML += `
                                    <div class="bookmark-item">
                                        <p class="bookmark-info">${bookName} : ${number}</p>
                                        <p class="bookmark-text" style="text-align: right; font-family: 'Scheherazade New', serif; font-size: 1.2rem; font-style: normal; margin-bottom: 0.5rem;">${hadith.arabic}</p>
                                        <p class="bookmark-text">"${hadith.translation}"</p>
                                    </div>`;
                            }
                        });
                    }
                }

                container.innerHTML = `
                    <button id="back-to-hadith-books" class="btn btn-primary" style="margin-top:15px; margin-bottom:1rem;"><i class="fas fa-arrow-left"></i> ${t.back}</button>
                    <h2 style="text-align:center; margin-bottom:1rem;">${t.hadithBookmarksTitle}</h2>
                    <div class="card" style="padding:0;">${bookmarksHTML || `<p style="padding: 1rem; text-align: center;">${t.noHadithBookmarks}</p>`}</div>`;
                
                // --- START: ব্যাক বাটন পরিবর্তন ---
                document.getElementById('back-to-hadith-books').addEventListener('click', () => history.back());
                // --- END: ব্যাক বাটন পরিবর্তন ---

            } catch (error) {
                console.error("Error loading hadith bookmarks:", error);
                showError(container, t.error);
            }
        };

        renderBookSelection();
    };

    const initNamazShikkhaTab = (container) => {
        const t = translations[state.currentLang];
        
        const renderNamazShikkhaHome = () => { 
            container.innerHTML = `<div class="gender-selection-container" style="margin-top:15px;"><div class="gender-select-btn" data-gender="male"><i class="fas fa-person"></i><span>${t.mensPrayer}</span></div><div class="gender-select-btn" data-gender="female"><i class="fas fa-person-dress"></i><span>${t.womensPrayer}</span></div></div>`; 
            
            // --- START: ব্যাক বাটন পরিবর্তন ---
            container.querySelectorAll('.gender-select-btn').forEach(btn => { 
                btn.addEventListener('click', () => { 
                    const gender = btn.dataset.gender;
                    history.pushState({ tab: 'namaz-shikkha', view: 'namazSteps', data: { gender } }, '', `#namaz-shikkha/${gender}`);
                    renderNamazSteps(gender); 
                }); 
            }); 
            // --- END: ব্যাক বাটন পরিবর্তন ---
        };

        const renderNamazSteps = (gender) => { 
            const data = namazEducationData[gender][state.currentLang] || namazEducationData[gender]['bn']; 
            const stepsHTML = data.map((step, index) => `<div class="namaz-step-card"><div class="namaz-step-number">${index + 1}</div><div class="namaz-step-details"><h4>${step.title}</h4><p>${step.details}</p></div></div>`).join(''); 
            container.innerHTML = `<div class="namaz-steps-view" style="margin-top:15px;"><button class="btn btn-primary back-to-selection" style="width: 100%; margin-bottom: 1rem;"><i class="fas fa-arrow-left"></i> ${t.back}</button>${stepsHTML}</div>`; 
            
            // --- START: ব্যাক বাটন পরিবর্তন ---
            container.querySelector('.back-to-selection').addEventListener('click', () => history.back()); 
            // --- END: ব্যাক বাটন পরিবর্তন ---
        };
        
        renderNamazShikkhaHome();
    };
    
    const initSettings = () => {
        const t = translations[state.currentLang];
        const container = document.getElementById('settings-tab');
        container.innerHTML = `
            <div style="margin-top:15px;">
                <div class="card dev-info-card">
                    <div class="dev-avatar"><i class="fa-solid fa-user-tie"></i></div>
                    <h3>${t.devNameValue}</h3>
                    <p class="dev-title" data-translate-key="devTitle">${t.devTitle || 'App Developer'}</p>
                    <hr class="dev-divider">
                    <div class="dev-contact-links">
                        <a href="mailto:${t.devEmailValue}"><i class="fa-solid fa-envelope"></i> <span data-translate-key="devEmail">${t.devEmail}</span></a>
                        <a href="https://wa.me/8801989170955" target="_blank"><i class="fa-brands fa-whatsapp"></i> <span data-translate-key="devWhatsApp">${t.devWhatsApp}</span></a>
                    </div>
                </div>
                <div class="card">
                    <h3 data-translate-key="changeCity">${t.changeCity}</h3>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <input type="text" id="city-input-settings" value="${state.currentCity}">
                        <button id="city-save-btn" class="btn btn-primary" data-translate-key="save">${t.save}</button>
                    </div>
                </div>
                 <div class="card">
                    <h3 data-translate-key="language">${t.language}</h3>
                    <div class="settings-item">
                        <select id="language-select">
                            <option value="bn" ${state.currentLang === 'bn' ? 'selected' : ''}>বাংলা</option>
                            <option value="en" ${state.currentLang === 'en' ? 'selected' : ''}>English</option>
                            <option value="hi" ${state.currentLang === 'hi' ? 'selected' : ''}>हिंदी</option>
                            <option value="ur" ${state.currentLang === 'ur' ? 'selected' : ''}>اردو</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <h3 data-translate-key="appAppearance">${t.appAppearance}</h3>
                    <div class="settings-item">
                        <label data-translate-key="darkMode">${t.darkMode}</label>
                        <input type="checkbox" class="custom-checkbox" id="dark-mode-toggle" ${state.isDarkMode ? 'checked' : ''}>
                    </div>
                    <div class="settings-item">
                        <label data-translate-key="textSize">${t.textSize}</label>
                        <div class="font-size-controls">
                            <button class="font-size-btn" id="text-size-decrease">-</button>
                            <span id="text-size-display">${Math.round(state.fontSizeMultiplier * 100)}%</span>
                            <button class="font-size-btn" id="text-size-increase">+</button>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3 data-translate-key="audioSettings">${t.audioSettings}</h3>
                    <div class="settings-item">
                        <label data-translate-key="enableAudio">${t.enableAudio}</label>
                        <input type="checkbox" class="custom-checkbox" id="audio-enable-toggle" ${state.audioEnabled ? 'checked' : ''}>
                    </div>
                    <div class="settings-item">
                        <label data-translate-key="reciter">${t.reciter}</label>
                        <select id="reciter-select">
                            <option value="ar.alafasy" ${state.currentReciter === 'ar.alafasy' ? 'selected' : ''}>Mishary Rashid Alafasy</option>
                            <option value="ar.hudhaify" ${state.currentReciter === 'ar.hudhaify' ? 'selected' : ''}>Ali Abdur-Rahman al-Hudhaify</option>
                            <option value="ar.sudais" ${state.currentReciter === 'ar.sudais' ? 'selected' : ''}>Abdur-Rahman as-Sudais</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label data-translate-key="autoClosePlayerLabel">${t.autoClosePlayerLabel}</label>
                        <input type="checkbox" class="custom-checkbox" id="auto-close-toggle" ${state.autoClosePlayer ? 'checked' : ''}>
                    </div>
                </div>
                 <div class="card">
                    <h3 data-translate-key="permissions">${t.permissions}</h3>
                    <div class="settings-item">
                        <label data-translate-key="enableBookmarking">${t.enableBookmarking}</label>
                        <input type="checkbox" class="custom-checkbox" id="bookmark-permission-toggle" ${state.bookmarkingEnabled ? 'checked' : ''}>
                    </div>
                </div>
                <div class="card donation-card">
                    <h3 data-translate-key="donationTitle">${t.donationTitle}</h3>
                    <p data-translate-key="donationDesc">${t.donationDesc}</p>
                    <div class="donation-logos">
                        <p style="font-size: 1.4rem; font-weight: 700; color: var(--text-primary);">bKash | Nagad | Rocket</p>
                    </div>
                    <div class="donation-number-container">
                        <p id="donation-number" class="donation-number">01989170955</p>
                        <button id="copy-donation-number" class="btn btn-primary" style="font-size: 0.9rem; padding: 8px 15px;">
                            <i class="far fa-copy"></i> <span data-translate-key="copyBtn">${t.copyBtn}</span>
                        </button>
                    </div>
                    <div style='margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1rem;'>
                        <h4 data-translate-key="bankAccountTitle" style='margin-bottom: 0.5rem; color: var(--text-primary);'>${t.bankAccountTitle}</h4>
                        <div style="text-align: left; background-color: var(--bg-main); padding: 10px; border-radius: 8px;">
                            <p style='font-size: 0.9rem; margin-bottom: 5px;'><strong>Bank Name:</strong> BRAC Bank PLC</p>
                            <p style='font-size: 0.9rem;'><strong>Account Name:</strong> MD. AL AMIN SARKAR</p>
                        </div>
                        <div class="donation-number-container" style="margin-top: 0.5rem;">
                            <p id="bank-account-number" class="donation-number" style="font-size: 1.1rem; line-height: 1.2;">1069876160001</p>
                            <button id="copy-bank-account-number" class="btn btn-primary" style="font-size: 0.9rem; padding: 8px 15px; flex-shrink: 0;">
                                <i class="far fa-copy"></i> <span data-translate-key="copyBtn">${t.copyBtn}</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.getElementById('language-select').addEventListener('change', (e) => { const newLang = e.target.value; localStorage.setItem('appLang', newLang); window.location.reload(); });
        document.getElementById('dark-mode-toggle').addEventListener('change', e => { applyTheme(e.target.checked); localStorage.setItem('appTheme', e.target.checked ? 'dark' : 'light'); });
        const textSizeDisplay = document.getElementById('text-size-display');
        document.getElementById('text-size-decrease').addEventListener('click', () => { let currentSize = state.fontSizeMultiplier; if (currentSize > 0.5) { currentSize = Math.max(0.5, currentSize - 0.1); applyFontSize(currentSize); textSizeDisplay.textContent = `${Math.round(currentSize * 100)}%`; localStorage.setItem('appFontSize', currentSize); } });
        document.getElementById('text-size-increase').addEventListener('click', () => { let currentSize = state.fontSizeMultiplier; if (currentSize < 1.5) { currentSize = Math.min(1.5, currentSize + 0.1); applyFontSize(currentSize); textSizeDisplay.textContent = `${Math.round(currentSize * 100)}%`; localStorage.setItem('appFontSize', currentSize); } });
        document.getElementById('city-save-btn').addEventListener('click', () => { const newCity = document.getElementById('city-input-settings').value.trim(); if (newCity) { state.currentCity = newCity; localStorage.setItem('appCity', newCity); getPrayerTimes(); alert(translations[state.currentLang].cityUpdated.replace('%s', newCity)); } });
        document.getElementById('bookmark-permission-toggle').addEventListener('change', e => { state.bookmarkingEnabled = e.target.checked; localStorage.setItem('bookmarkingEnabled', state.bookmarkingEnabled); if (document.getElementById('quran-tab').dataset.loaded) { loadSurahList(); } });
        document.getElementById('audio-enable-toggle').addEventListener('change', e => { state.audioEnabled = e.target.checked; localStorage.setItem('audioEnabled', state.audioEnabled); });
        document.getElementById('reciter-select').addEventListener('change', e => { state.currentReciter = e.target.value; localStorage.setItem('currentReciter', e.target.value); });
        document.getElementById('auto-close-toggle').addEventListener('change', e => { state.autoClosePlayer = e.target.checked; localStorage.setItem('autoClosePlayer', state.autoClosePlayer); });
        document.getElementById('copy-donation-number').addEventListener('click', (e) => { const numberToCopy = document.getElementById('donation-number').textContent; const btn = e.currentTarget; copyToClipboard(numberToCopy, () => { const originalText = btn.querySelector('span').textContent; btn.querySelector('span').textContent = t.copiedBtn; btn.disabled = true; setTimeout(() => { btn.querySelector('span').textContent = originalText; btn.disabled = false; }, 2000); }); });
        document.getElementById('copy-bank-account-number').addEventListener('click', (e) => { const numberToCopy = document.getElementById('bank-account-number').textContent; const btn = e.currentTarget; copyToClipboard(numberToCopy, () => { const originalText = btn.querySelector('span').textContent; btn.querySelector('span').textContent = t.copiedBtn; btn.disabled = true; setTimeout(() => { btn.querySelector('span').textContent = originalText; btn.disabled = false; }, 2000); }); });
    };
    
    const namazEducationData = {
        male: {
            bn: [ { title: "তাকবীরে তাহরিমা", details: "কিবলামুখী হয়ে সোজাভাবে দাঁড়ান। নিয়্যত করার পর 'আল্লাহু আকবার' বলে উভয় হাত কাঁধ বা কান পর্যন্ত উঠান। হাতের তালু কিবলার দিকে থাকবে। এরপর নাভির নিচে ডান হাত বাম হাতের উপর রেখে হাত বাঁধুন।" }, { title: "সানা, তাআউজ ও তাসমিয়া", details: "হাত বাঁধার পর প্রথমে সানা পড়ুন: 'সুবহানাকা আল্লাহুম্মা ওয়া বিহামদিকা...। এরপর তাআউজ 'আ'উযুবিল্লাহি মিনাশ শাইতানির রাজীম' এবং তাসমিয়া 'বিসমিল্লাহির রাহমানির রাহীম' পড়ুন।" }, { title: "সূরা ফাতিহা ও অন্য সূরা", details: "সূরা ফাতিহা পড়ুন। এরপর কুরআনের অন্য যেকোনো একটি ছোট সূরা বা বড় সূরার তিন আয়াত পরিমাণ তিলাওয়াত করুন।" }, { title: "রুকু", details: "'আল্লাহু আকবার' বলে রুকুতে যান। দুই হাতের আঙুল দিয়ে হাঁটুকে আঁকড়ে ধরুন। পিঠ ও মাথা সমান্তরাল থাকবে। রুকুতে কমপক্ষে তিনবার 'সুবহানা রাব্বিয়াল আযীম' বলুন।" }, { title: "ক্বওমা (রুকু থেকে দাঁড়ানো)", details: "রুকু থেকে 'সামি'আল্লাহু লিমান হামিদাহ' বলতে বলতে সোজা হয়ে দাঁড়ান। এরপর বলুন 'রাব্বানা লাকাল হামদ'।" }, { title: "সিজদা", details: "'আল্লাহু আকবার' বলে সিজদায় যান। প্রথমে হাঁটু, তারপর দুই হাত, তারপর নাক এবং শেষে কপাল মাটিতে রাখুন। সিজদায় কমপক্ষে তিনবার 'সুবহানা রাব্বিয়াল আ'লা' বলুন।" }, { title: "জলসা (দুই সিজদার মাঝে বসা)", details: "'আল্লাহু আকবার' বলে সিজদা থেকে উঠে বসুন। বাম পা বিছিয়ে তার উপর বসুন এবং ডান পা খাড়া রাখুন।" }, { title: "দ্বিতীয় সিজদা", details: "'আল্লাহু আকবার' বলে আবার আগের মতো দ্বিতীয় সিজদা করুন এবং 'সুবহানা রাব্বিয়াল আ'লা' তিনবার বলুন।" }, { title: "শেষ বৈঠক (আত্তাহিয়্যাতু)", details: "দুই রাকাত নামাজের ক্ষেত্রে দ্বিতীয় সিজদার পর এবং চার রাকাতের ক্ষেত্রে শেষ রাকাতে বসুন। বসে তাশাহহুদ (আত্তাহিয়্যাতু), দরুদ শরীফ এবং দোয়া মাসুরা পড়ুন।" }, { title: "সালাম", details: "প্রথমে ডান দিকে মুখ ফিরিয়ে বলুন 'আসসালামু আলাইকুম ওয়া রাহমাতুল্লাহ'। এরপর বাম দিকে মুখ ফিরিয়ে একইভাবে সালাম দিন।" } ],
            en: [ { title: "Takbir-e-Tahrima", details: "Face the Qibla and stand straight. After making your intention (niyyah), say 'Allahu Akbar' and raise both hands to your shoulders or ears, with palms facing the Qibla. Then, place your right hand over your left hand below the navel." }, { title: "Thana, Ta'awwuz & Tasmiyah", details: "After placing your hands, recite the Thana: 'Subhanakallahumma wa bihamdika...'. Then recite Ta'awwuz 'A'udhu billahi minash shaitanir rajim' and Tasmiyah 'Bismillahir rahmanir rahim'." }, { title: "Surah Al-Fatihah & another Surah", details: "Recite Surah Al-Fatihah. Then, recite another short Surah or three verses from a longer Surah." }, { title: "Ruku'", details: "Say 'Allahu Akbar' and bow down for Ruku'. Grasp your knees with your fingers. Keep your back and head parallel to the ground. In Ruku', say 'Subhana Rabbiyal 'Azim' at least three times." }, { title: "Qawmah (Standing from Ruku')", details: "Rise from Ruku' while saying 'Sami'allahu liman hamidah'. Then, stand straight and say 'Rabbana lakal-hamd'." }, { title: "Sajdah", details: "Say 'Allahu Akbar' and go into prostration (Sajdah). Your knees, both hands, nose, and forehead should touch the ground. In Sajdah, say 'Subhana Rabbiyal A'la' at least three times." }, { title: "Jalsah (Sitting between two Sajdahs)", details: "Say 'Allahu Akbar' and rise from Sajdah to a sitting position. Sit on your left foot while keeping your right foot upright." }, { title: "Second Sajdah", details: "Say 'Allahu Akbar' and perform the second Sajdah just like the first one, reciting 'Subhana Rabbiyal A'la' three times." }, { title: "Final Sitting (Tashahhud)", details: "After the second Sajdah of the second rak'ah (and the final rak'ah for 3/4 rak'ah prayers), sit for Tashahhud. Recite At-Tahiyyat, Durood Sharif, and Dua Masura." }, { title: "Salam", details: "First, turn your face to the right and say 'Assalamu Alaikum wa Rahmatullah'. Then, turn your face to the left and repeat the salam." } ],
            hi: [ { title: "तकबीर-ए-तहरीमा", details: "क़िबला की ओर मुँह करके सीधे खड़े हों। नियत करने के बाद 'अल्लाहु अकबर' कहें और दोनों हाथों को कंधों या कानों तक उठाएं। हथेलियाँ क़िबला की ओर हों। फिर नाभि के नीचे दाहिना हाथ बाएं हाथ पर रखें।" }, { title: "सना, तअव्वुज़ और तस्मिया", details: "हाथ बांधने के बाद सना पढ़ें: 'सुब्हानकल्लाहुम्मा व बिहम्दिका...'। फिर तअव्वुज़ 'अऊज़ु बिल्लाहि मिनश शैतानिर रजीम' और तस्मिया 'बिस्मिल्लाहिर रहमानिर रहीम' पढ़ें।" }, { title: "सूरह फातिहा और दूसरी सूरह", details: "सूरह फातिहा पढ़ें। फिर कुरान से कोई भी छोटी सूरह या किसी बड़ी सूरह की तीन आयतें पढ़ें।" }, { title: "रुकू", details: "'अल्लाहु अकबर' कहकर रुकू में जाएं। घुटनों को अपनी उंगलियों से पकड़ें। अपनी पीठ और सिर को ज़मीन के समानांतर रखें। रुकू में कम से कम तीन बार 'सुब्हान रब्बियल अज़ीम' कहें।" }, { title: "क़ौमा (रुकू से खड़ा होना)", details: "रुकू से उठते समय 'समि'अल्लाहु लिमन हमिदह' कहें। फिर सीधे खड़े होकर 'रब्बना लकल हम्द' कहें।" }, { title: "सजदा", details: "'अल्लाहु अकबर' कहकर सजदे में जाएं। आपके घुटने, दोनों हाथ, नाक और माथा ज़मीन को छूना चाहिए। सजदे में कम से कम तीन बार 'सुब्हान रब्बियल आला' कहें।" }, { title: "जलसा (दो सजदों के बीच बैठना)", details: "'अल्लाहु अकबर' कहकर सजदे से उठकर बैठें। अपने बाएं पैर पर बैठें और दाहिने पैर को सीधा रखें।" }, { title: "दूसरा सजदा", details: "'अल्लाहु अकबर' कहकर दूसरा सजदा पहले की तरह करें, और तीन बार 'सुब्हान रब्बियल आला' पढ़ें।" }, { title: "अंतिम बैठक (तशह्हुद)", details: "दूसरी रकअत के दूसरे सजदे के बाद (और 3/4 रकअत की नमाज़ में अंतिम रकअत में) तशह्हुद के लिए बैठें। अत्तहिय्यात, दुरूद शरीफ और दुआ मासूरा पढ़ें।" }, { title: "सलाम", details: "पहले अपना चेहरा दाईं ओर करें और 'अस्सलामु अलैकुम व रहमतुल्लाह' कहें। फिर अपना चेहरा बाईं ओर करें और सलाम दोहराएं।" } ],
            ur: [ { title: "تکبیر تحریمہ", details: "قبلہ رخ ہو کر سیدھے کھڑے ہوں۔ نیت کرنے کے بعد 'اللہ اکبر' کہہ کر دونوں ہاتھ کندھوں یا کانوں تک اٹھائیں۔ ہتھیلیاں قبلہ کی طرف ہوں۔ پھر ناف کے نیچے دایاں ہاتھ بائیں ہاتھ پر رکھ کر باندھ لیں۔" }, { title: "ثناء، تعوذ و تسمیہ", details: "ہاتھ باندھنے کے بعد پہلے ثناء پڑھیں: 'سبحانک اللھم وبحمدک...'۔ اس کے بعد تعوذ 'اعوذ باللہ من الشیطان الرجیم' اور تسمیہ 'بسم اللہ الرحمن الرحیم' پڑھیں۔" }, { title: "سورۃ الفاتحہ اور دوسری سورت", details: "سورۃ الفاتحہ پڑھیں۔ اس کے بعد قرآن کی کوئی دوسری چھوٹی سورت یا بڑی سورت کی تین آیات تلاوت کریں۔" }, { title: "رکوع", details: "'اللہ اکبر' کہہ کر رکوع میں جائیں۔ دونوں ہاتھوں کی انگلیوں سے گھٹنوں کو پکڑیں۔ پیٹھ اور سر کو برابر رکھیں۔ رکوع میں کم از کم تین بار 'سبحان ربی العظیم' کہیں۔" }, { title: "قومہ (رکوع سے کھڑا ہونا)", details: "رکوع سے 'سمع اللہ لمن حمدہ' کہتے ہوئے سیدھے کھڑے ہو جائیں۔ پھر کہیں 'ربنا لک الحمد'۔" }, { title: "سجدہ", details: "'اللہ اکبر' کہہ کر سجدے میں جائیں۔ پہلے گھٹنے، پھر دونوں ہاتھ، پھر ناک اور آخر میں پیشانی زمین پر رکھیں۔ سجدے میں کم از کم تین بار 'سبحان ربی الاعلی' کہیں۔" }, { title: "جلسہ (دو سجدوں کے درمیان بیٹھنا)", details: "'اللہ اکبر' کہہ کر سجدے سے اٹھ کر بیٹھیں۔ بایاں پاؤں بچھا کر اس پر بیٹھیں اور دایاں پاؤں کھڑا رکھیں۔" }, { title: "دوسرا سجدہ", details: "'اللہ اکبر' کہہ کر دوبارہ پہلے کی طرح دوسرا سجدہ کریں اور 'سبحان ربی الاعلی' تین بار کہیں۔" }, { title: "آخری نشست (التحیات)", details: "دو رکعت نماز میں دوسرے سجدے کے بعد اور چار رکعت میں آخری رکعت میں بیٹھیں۔ بیٹھ کر تشہد (التحیات)، درود شریف اور دعا ماثورہ پڑھیں۔" }, { title: "سلام", details: "پہلے دائیں طرف منہ پھیر کر 'السلام علیکم ورحمۃ اللہ' کہیں۔ پھر بائیں طرف منہ پھیر کر اسی طرح سلام کہیں۔" } ]
        },
        female: {
            bn: [ { title: "তাকবীরে তাহরিমা", details: "কিবলামুখী হয়ে দাঁড়ান। নিয়্যত করার পর 'আল্লাহু আকবার' বলে উভয় হাত কাঁধ পর্যন্ত উঠান, হাতের তালু কিবলার দিকে থাকবে। এরপর বুকের উপর ডান হাত বাম হাতের উপর রেখে হাত বাঁধুন।" }, { title: "সানা, তাআউজ ও তাসমিয়া", details: "হাত বাঁধার পর প্রথমে সানা পড়ুন: 'সুবহানাকা আল্লাহুম্মা ওয়া বিহামদিকা...। এরপর তাআউজ 'আ'উযুবিল্লাহি মিনাশ শাইতানির রাজীম' এবং তাসমিয়া 'বিসমিল্লাহির রাহমানির রাহীম' পড়ুন।" }, { title: "সূরা ফাতিহা ও অন্য সূরা", details: "সূরা ফাতিহা পড়ুন। এরপর কুরআনের অন্য যেকোনো একটি ছোট সূরা বা বড় সূরার তিন আয়াত পরিমাণ তিলাওয়াত করুন।" }, { title: "রুকু", details: "'আল্লাহু আকবার' বলে রুকুতে যান। সামান্য ঝুঁকে দুই হাত হাঁটুর উপর রাখুন, আঙুলগুলো মেলানো থাকবে। পুরুষদের মতো পিঠ সোজা না করলেও চলবে।" }, { title: "ক্বওমা (রুকু থেকে দাঁড়ানো)", details: "রুকু থেকে 'সামি'আল্লাহু লিমান হামিদাহ' বলতে বলতে সোজা হয়ে দাঁড়ান। এরপর বলুন 'রাব্বানা লাকাল হামদ'।" }, { title: "সিজদা", details: "'আল্লাহু আকবার' বলে সিজদায় যান। অত্যন্ত জড়সড় হয়ে সিজদা করুন। হাত ও পা শরীরের সাথে মিলিয়ে রাখুন এবং পেট উরুর সাথে মিলিয়ে দিন।" }, { title: "জলসা (দুই সিজদার মাঝে বসা)", details: "'আল্লাহু আকবার' বলে সিজদা থেকে উঠে বসুন। উভয় পা ডান দিকে বের করে দিয়ে নিতম্বের উপর বসুন।" }, { title: "দ্বিতীয় সিজদা", details: "'আল্লাহু আকবার' বলে আবার আগের মতো জড়সড় হয়ে দ্বিতীয় সিজদা করুন।" }, { title: "শেষ বৈঠক (আত্তাহিয়্যাতু)", details: "দ্বিতীয় সিজদার পর জলসার মতো বসে তাশাহহুদ (আত্তাহিয়্যাতু), দরুদ শরীফ এবং দোয়া মাসুরা পড়ুন।" }, { title: "সালাম", details: "প্রথমে ডান দিকে মুখ ফিরিয়ে বলুন 'আসসালামু আলাইকুম ওয়া রাহমাতুল্লাহ'। এরপর বাম দিকে মুখ ফিরিয়ে একইভাবে সালাম দিন।" } ],
            en: [ { title: "Takbir-e-Tahrima", details: "Face the Qibla. After making your intention, say 'Allahu Akbar' and raise both hands to your shoulders, palms facing the Qibla. Then, place your right hand over your left hand on your chest." }, { title: "Thana, Ta'awwuz & Tasmiyah", details: "After placing your hands, recite the Thana, Ta'awwuz, and Tasmiyah." }, { title: "Surah Al-Fatihah & another Surah", details: "Recite Surah Al-Fatihah, followed by another short Surah or equivalent." }, { title: "Ruku'", details: "Say 'Allahu Akbar' and bend for Ruku'. Bend slightly, placing hands on the knees with fingers together. It is not necessary to straighten the back completely like men." }, { title: "Qawmah (Standing from Ruku')", details: "Rise from Ruku' while saying 'Sami'allahu liman hamidah'. Then, stand straight and say 'Rabbana lakal-hamd'." }, { title: "Sajdah", details: "Say 'Allahu Akbar' and go into prostration (Sajdah). Prostrate in a compact manner. Keep arms and legs close to the body, with the abdomen touching the thighs." }, { title: "Jalsah (Sitting between two Sajdahs)", details: "Say 'Allahu Akbar' and rise from Sajdah. Sit on your left hip, with both feet pointing to the right side." }, { title: "Second Sajdah", details: "Say 'Allahu Akbar' and perform the second Sajdah in the same compact manner." }, { title: "Final Sitting (Tashahhud)", details: "After the second Sajdah, sit in the same way as in Jalsah. Recite At-Tahiyyat, Durood Sharif, and Dua Masura." }, { title: "Salam", details: "Turn your face to the right and say 'Assalamu Alaikum wa Rahmatullah'. Then, turn to the left and repeat." } ],
            hi: [ { title: "तकबीर-ए-तहरीमा", details: "क़िबला की ओर मुँह करें। नियत करने के बाद 'अल्लाहु अकबर' कहें और दोनों हाथों को कंधों तक उठाएं, हथेलियाँ क़िबला की ओर हों। फिर सीने पर दाहिना हाथ बाएं हाथ पर रखें।" }, { title: "सना, तअव्वुज़ और तस्मिया", details: "हाथ बांधने के बाद सना, तअव्वुज़ और तस्मिया पढ़ें।" }, { title: "सूरह फातिहा और दूसरी सूरह", details: "सूरह फातिहा पढ़ें, फिर कोई और छोटी सूरह पढ़ें।" }, { title: "रुकू", details: "'अल्लाहु अकबर' कहकर रुकू में जाएं। थोड़ा झुकें, हाथों को घुटनों पर रखें, उंगलियां मिली हुई हों। पुरुषों की तरह पीठ को पूरी तरह सीधा करना आवश्यक नहीं है।" }, { title: "क़ौमा (रुकू से खड़ा होना)", details: "रुकू से उठते समय 'समि'अल्लाहु लिमन हमिदह' कहें। फिर सीधे खड़े होकर 'रब्बना लकल हम्द' कहें।" }, { title: "सजदा", details: "'अल्लाहु अकबर' कहकर सजदे में जाएं। शरीर को सिकोड़कर सजदा करें। हाथ और पैर शरीर के करीब रखें, और पेट को जांघों से मिलाएं।" }, { title: "जलसा (दो सजदों के बीच बैठना)", details: "'अल्लाहु अकबर' कहकर सजदे से उठें। अपने दोनों पैरों को दाईं ओर निकालकर बैठें।" }, { title: "दूसरा सजदा", details: "'अल्लाहु अकबर' कहकर दूसरा सजदा भी उसी तरह सिकोड़कर करें।" }, { title: "अंतिम बैठक (तशह्हुद)", details: "दूसरे सजदे के बाद, जलसा की तरह बैठकर अत्तहिय्यात, दुरूद शरीफ और दुआ मासूरा पढ़ें।" }, { title: "सलाम", details: "पहले अपना चेहरा दाईं ओर करें और 'अस्सलामु अलैकुम व रहमतुल्लाह' कहें। फिर बाईं ओर करें और दोहराएं।" } ],
            ur: [ { title: "تکبیر تحریمہ", details: "قبلہ رخ ہوں۔ نیت کرنے کے بعد 'اللہ اکبر' کہہ کر دونوں ہاتھ کندھوں تک اٹھائیں، ہتھیلیاں قبلہ کی طرف ہوں۔ پھر سینے پر دایاں ہاتھ بائیں ہاتھ پر رکھ کر باندھ لیں۔" }, { title: "ثناء، تعوذ و تسمیہ", details: "ہاتھ باندھنے کے بعد ثناء، تعوذ اور تسمیہ پڑھیں۔" }, { title: "سورۃ الفاتحہ اور دوسری سورت", details: "سورۃ الفاتchequer پڑھیں، پھر کوئی اور چھوٹی سورت پڑھیں۔" }, { title: "رکوع", details: "'اللہ اکبر' کہہ کر رکوع میں جائیں۔ تھوڑا جھکیں، ہاتھوں کو گھٹنوں پر رکھیں، انگلیاں ملی ہوئی ہوں۔ مردوں کی طرح پیٹھ کو پوری طرح سیدھا کرنا ضروری نہیں ہے۔" }, { title: "قومہ (رکوع سے کھڑا ہونا)", details: "رکوع سے اٹھتے وقت 'سمع اللہ لمن حمدہ' کہیں۔ پھر سیدھے کھڑے ہو کر 'ربنا لک الحمد' کہیں۔" }, { title: "سجدہ", details: "'اللہ اکبر' کہہ کر سجدے میں جائیں۔ جسم کو سمیٹ کر سجدہ کریں۔ بازو اور ٹانگیں جسم کے قریب رکھیں، اور پیٹ کو رانوں سے ملائیں۔" }, { title: "جلسہ (دو سجدوں کے درمیان بیٹھنا)", details: "'اللہ اکبر' کہہ کر سجدے سے اٹھیں۔ اپنے دونوں پاؤں دائیں طرف نکال کر بیٹھیں۔" }, { title: "دوسرا سجدہ", details: "'اللہ اکبر' کہہ کر دوسرا سجدہ بھی اسی طرح سمیٹ کر کریں۔" }, { title: "آخری نشست (التحیات)", details: "دوسرے سجدے کے بعد، جلسہ کی طرح بیٹھ کر التحیات، درود شریف، اور دعا ماثورہ پڑھیں۔" }, { title: "سلام", details: "पहले अपना चेहरा دائیं ओर करें اور 'السلام علیکم ورحمۃ اللہ' कहें। फिर بائیں طرف کریں اور دہرائیں۔" } ]
        }
    };

    const setLanguage = (lang) => {
        const isRTL = lang === 'ur';
        document.documentElement.lang = lang;
        document.documentElement.dir = isRTL ? 'rtl' : 'ltr';

        const t = translations[lang];
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.dataset.translateKey;
            if (t[key]) {
                if (key === 'userGuideTitle') {
                    el.querySelector('span').textContent = t.guide.title;
                } else {
                    el.textContent = t[key];
                }
            }
        });
        const locale = {bn: 'bn-BD', en: 'en-US', hi: 'hi-IN', ur: 'ur-PK'}[lang];
        DOMElements.currentDate.textContent = new Date().toLocaleDateString(locale, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        document.title = t.appName;
    };

    const initApp = async () => {
        try {
            await openDB(); 
        } catch (error) {
            console.error("Failed to open IndexedDB:", error);
        }

        setLanguage(state.currentLang);
        
        const prayerTabPane = document.getElementById('prayer-tab');
        if (prayerTabPane) {
            const prayerTabFirstCard = prayerTabPane.querySelector('.card');
            if (prayerTabFirstCard) prayerTabFirstCard.style.marginTop = '15px';
        }
        
        createPrayerWidget();
        makePrayerWidgetDraggable();
        createAudioPlayer();

        const prayerWidget = document.getElementById('prayer-widget-container');
        if (prayerWidget) {
            prayerWidget.style.display = 'block';
        }

        getPrayerTimes();
        DOMElements.tabs.forEach(tab => tab.addEventListener('click', () => switchTab(tab.dataset.tab)));
        
        DOMElements.menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const isDisplayed = DOMElements.menuDropdown.style.display === 'block';
            DOMElements.menuDropdown.style.display = isDisplayed ? 'none' : 'block';
        });

        DOMElements.userGuideBtn.addEventListener('click', showUserGuide);

        document.addEventListener('click', (e) => {
            if (DOMElements.menuDropdown && !DOMElements.menuDropdown.contains(e.target) && !DOMElements.menuBtn.contains(e.target)) {
                DOMElements.menuDropdown.style.display = 'none';
            }
        });

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(positionPrayerWidget, 200);
        });
    };


// --- NEW: Auto Scroll Logic Functions ---
    const toggleAutoScroll = () => {
        const btn = document.getElementById('scroll-toggle-btn');
        const icon = btn.querySelector('i');
        if (state.autoScroll.isActive) {
            stopAutoScroll();
            icon.classList.remove('fa-pause');
            icon.classList.add('fa-play');
        } else {
            startAutoScroll();
            icon.classList.remove('fa-play');
            icon.classList.add('fa-pause');
        }
    };

    const startAutoScroll = () => {
        state.autoScroll.isActive = true;
        // ট্যাব কন্টেন্ট যেখানে স্ক্রল হয় সেটি ধরা হচ্ছে
        const scrollContainer = document.querySelector('.tab-content'); 
        
        if (state.autoScroll.interval) clearInterval(state.autoScroll.interval);
        
        state.autoScroll.interval = setInterval(() => {
            // নিচে স্ক্রল করা
            scrollContainer.scrollTop += state.autoScroll.speed;
            
            // একদম নিচে পৌঁছে গেলে বন্ধ হবে
            if(scrollContainer.scrollTop + scrollContainer.clientHeight >= scrollContainer.scrollHeight) {
                stopAutoScroll();
                const btn = document.getElementById('scroll-toggle-btn');
                if(btn) {
                    btn.querySelector('i').classList.remove('fa-pause');
                    btn.querySelector('i').classList.add('fa-play');
                }
            }
        }, 50); // প্রতি ৫০ মিলিসেকেন্ডে আপডেট
    };

    const stopAutoScroll = () => {
        state.autoScroll.isActive = false;
        if (state.autoScroll.interval) {
            clearInterval(state.autoScroll.interval);
            state.autoScroll.interval = null;
        }
    };

    const changeScrollSpeed = (change) => {
        let newSpeed = state.autoScroll.speed + change;
        // স্পিড লিমিট: ০.৫ থেকে ৩ পর্যন্ত
        if (newSpeed >= 0.5 && newSpeed <= 3) {
            state.autoScroll.speed = newSpeed;
            document.getElementById('scroll-speed-val').textContent = newSpeed + 'x';
        }
    };








    
    initApp();
});